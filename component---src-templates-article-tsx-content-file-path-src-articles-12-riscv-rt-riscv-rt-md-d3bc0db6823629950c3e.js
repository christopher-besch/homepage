"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[974],{3021:function(e,t,n){n.r(t),n.d(t,{Head:function(){return x},default:function(){return _}});var l=n(8453),a=n(6540),r=(n.p,n.p,n.p+"static/preemption_model_config-d70c12d90f8d2a8ffc91ad333f423523.png");function i(e){const t=Object.assign({p:"p",code:"code",h1:"h1",a:"a",span:"span",pre:"pre",h2:"h2",h3:"h3",strong:"strong",em:"em",ul:"ul",li:"li"},(0,l.R)(),e.components),{HalfImage:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("HalfImage",!0),a.createElement(a.Fragment,null,a.createElement(t.p,null,"I got access to a StarFive VisionFive 2 and wanted to play around with Real-Time Linux on it.\nThis article goes into excruciating detail on how I set that machine up to with ",a.createElement(t.code,null,"PREEMPT_RT"),"."),"\n",a.createElement(t.p,null,"The first mainline Kernel with PREEMPT_RT is v6.12.\nAt the time of writing v6.15 is the newest kernel and my Debian laptop runs on v6.1.0.\nFor the Debian user that I am v6.12 is pretty new."),"\n",a.createElement(t.p,null,"So, how do we get this single board computer (SBC) to work and run on such a new kernel?\nThere is no StarFive Debian release with a Linux kernel v6.12 or newer.\nSo we need to make due with engineering release 202409 and kernel v6.6.20 and get to v6.12 later.\n(That's still newer than my Debian laptop...)"),"\n",a.createElement(t.h1,{id:"installing-the-initial-image",style:{position:"relative"}},a.createElement(t.a,{href:"#installing-the-initial-image","aria-label":"installing the initial image permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Installing the Initial Image"),"\n",a.createElement(t.p,null,"I just stick to the ",a.createElement(t.a,{href:"https://rvspace.org/en/project/VisionFive2_Debian_User_Guide"},"official installation guide for Debian on the VisionFive 2"),".\nI chose to boot off of an SD card, pop it in my laptop and run:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"bzip2 -d starfive-jh7110-202409-SD-minimal-desktop-wayland.img.bz2\nsudo dd if=starfive-jh7110-202409-SD-minimal-desktop-wayland.img of=/dev/sda conv=fsync bs=4M status=progress\n")),"\n",a.createElement(t.p,null,"Now we can insert the SD card into the SBC and watch it boot for the first time."),"\n",a.createElement(t.h1,{id:"uart",style:{position:"relative"}},a.createElement(t.a,{href:"#uart","aria-label":"uart permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"UART"),"\n",a.createElement(t.p,null,"I have a USB to UART adapter attached to my laptop and the SBC.\nAfter having added myself to the dialout group on my laptop I rebooted (a relogin would have done it as well):"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo usermod -a -G dialout chris\nsudo reboot\n")),"\n",a.createElement(t.p,null,"Now I plug in the adapter to my laptop and check what tty adapter it is on:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo dmesg\n")),"\n",a.createElement(t.p,null,"This should print something including the tty path.\nI use this path to attach a terminal to that adapter."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"screen -U /dev/ttyUSB0 -b 115200\n")),"\n",a.createElement(t.p,null,"Exit with ",a.createElement(t.code,null,"Ctrl+a d"),"."),"\n",a.createElement(t.p,null,"There is this magic of LEDs on a UART adapter blinking as you type."),"\n",a.createElement(t.h1,{id:"setting-up-networking",style:{position:"relative"}},a.createElement(t.a,{href:"#setting-up-networking","aria-label":"setting up networking permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Setting up Networking"),"\n",a.createElement(t.p,null,"Linux is running on the SBC but I'd like to have network access.\nI have my Linux Laptop right here and want to share its network connection with the SBC."),"\n",a.createElement(t.h2,{id:"on-the-laptop",style:{position:"relative"}},a.createElement(t.a,{href:"#on-the-laptop","aria-label":"on the laptop permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"On the Laptop"),"\n",a.createElement(t.p,null,"First we need to know what network cards we're dealing with:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"~ λ ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: wlp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DORMANT group default qlen 1000\n    link/ether 10:6f:d9:1e:4f:e1 brd ff:ff:ff:ff:ff:ff\n3: enx00133bb15f5b: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000\n    link/ether 00:13:3b:b1:5f:5b brd ff:ff:ff:ff:ff:ff```\n")),"\n",a.createElement(t.p,null,"As you can see I have three network cards, the loopback device (i.e. for localhost) my wifi card ",a.createElement(t.code,null,"wlp1s0")," and a usb LAN adapter ",a.createElement(t.code,null,"enx00133bb15f5b"),"."),"\n",a.createElement(t.h3,{id:"nat-setup",style:{position:"relative"}},a.createElement(t.a,{href:"#nat-setup","aria-label":"nat setup permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"NAT Setup"),"\n",a.createElement(t.p,null,"We need to setup NAT to forward packets meant for the SBC with the laptop."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo sysctl -w net.ipv4.ip_forward=1\nsudo iptables -t nat -A POSTROUTING -o wlp1s0 -j MASQUERADE\nsudo iptables -A FORWARD -i enx00133bb15f5b -o wlp1s0 -j ACCEPT\nsudo iptables -A FORWARD -i wlp1s0 -o enx00133bb15f5b -m state --state RELATED,ESTABLISHED -j ACCEPT\n")),"\n",a.createElement(t.h3,{id:"ip-addresses",style:{position:"relative"}},a.createElement(t.a,{href:"#ip-addresses","aria-label":"ip addresses permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"IP Addresses"),"\n",a.createElement(t.p,null,"We want to assign a new IP address for the laptop to the ",a.createElement(t.code,null,"enx00133bb15f5b")," link."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo ip addr add 192.168.10.1/24 dev enx00133bb15f5b\nsudo ip link set enx00133bb15f5b up\n")),"\n",a.createElement(t.p,null,"I check that this worked with:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"~ λ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: wlp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 10:6f:d9:1e:4f:e1 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.65.91/17 brd 172.17.127.255 scope global dynamic noprefixroute wlp1s0\n       valid_lft 1694sec preferred_lft 1694sec\n    inet6 2a00:1398:9:fb03:c786:4d2:ce2e:e30d/64 scope global dynamic noprefixroute\n       valid_lft 2591999sec preferred_lft 604799sec\n    inet6 fe80::cebf:38eb:9589:c3a0/64 scope link noprefixroute\n       valid_lft forever preferred_lft forever\n3: enx00133bb15f5b: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:13:3b:b1:5f:5b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.10.1/24 scope global enx00133bb15f5b\n       valid_lft forever preferred_lft forever\n")),"\n",a.createElement(t.p,null,"The ",a.createElement(t.code,null,"enx00133bb15f5b")," link has a new IP address (192.168.10.1) assigned to it."),"\n",a.createElement(t.h2,{id:"on-the-sbc",style:{position:"relative"}},a.createElement(t.a,{href:"#on-the-sbc","aria-label":"on the sbc permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"On the SBC"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"user@starfive:~$ ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 6c:cf:39:00:49:50 brd ff:ff:ff:ff:ff:ff\n    altname end0\n3: eth1: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000\n    link/ether 6c:cf:39:00:49:51 brd ff:ff:ff:ff:ff:ff\n    altname end1\n4: sit0@NONE: <NOARP> mtu 1480 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/sit 0.0.0.0 brd 0.0.0.0\n")),"\n",a.createElement(t.p,null,"I have attached the LAN cable to the ",a.createElement(t.code,null,"eth0")," network card."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo ip addr add 192.168.10.2/24 dev eth0\nsudo ip link set eth0 up\nsudo ip route add default via 192.168.10.1\n")),"\n",a.createElement(t.p,null,"With this we have added the ip ",a.createElement(t.code,null,"192.168.10.2")," to the SBC's ",a.createElement(t.code,null,"eth0")," interface.\nDHCP would have done that automatically but we didn't setup a DHCP server on the laptop so we have to do this manually."),"\n",a.createElement(t.h3,{id:"dns",style:{position:"relative"}},a.createElement(t.a,{href:"#dns","aria-label":"dns permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"DNS"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo vi /etc/resolv.conf\n")),"\n",a.createElement(t.p,null,"Add this line (we all like Google, don't we?):"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,"nameserver 8.8.8.8\n")),"\n",a.createElement(t.p,null,"We don't need the NetworkManager for this, btw.\nFeel free to disable it:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo systemctl disable --now NetworkManager\n")),"\n",a.createElement(t.h3,{id:"lets-test-this",style:{position:"relative"}},a.createElement(t.a,{href:"#lets-test-this","aria-label":"lets test this permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Let's Test this"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"# ping the laptop\n# this tests the link works\nping 192.168.10.1\n# ping google infrastructure without the DNS\n# this tests the NAT works\nping 8.8.8.8\n# ping google with DNS\n# this tests that the DNS works\nping google.com\n")),"\n",a.createElement(t.p,null,"This setup works most of the time.\nSometimes it's a bit flaky.\nI presume that's because the NetworkManager on my laptop interferes but I'm not sure and can't turn it off there.\nI often have to run the commands multiple times until they stick."),"\n",a.createElement(t.h3,{id:"ssh",style:{position:"relative"}},a.createElement(t.a,{href:"#ssh","aria-label":"ssh permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"SSH"),"\n",a.createElement(t.p,null,"There already is an SSH server installed and running on the SBC.\nAll I have to do is connect to it from the host:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"ssh user@192.168.10.2\n")),"\n",a.createElement(t.p,null,"So much faster than UART, damn!\nNo blinking lights, though ",a.createElement(t.code,null,":<")),"\n",a.createElement(t.h1,{id:"building-the-kernel",style:{position:"relative"}},a.createElement(t.a,{href:"#building-the-kernel","aria-label":"building the kernel permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Building the Kernel"),"\n",a.createElement(t.p,null,"Again we refer to the ",a.createElement(t.a,{href:"https://rvspace.org/en/project/VisionFive2_Debian_User_Guide#h-46-compiling-and-updating-linux-kernel"},"VisionFive 2 docs"),"."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo apt-get -y install build-essential linux-source bc kmod cpio flex libncurses5-dev libelf-dev libssl-dev dwarves bison git debhelper\ngit clone --depth 1 --single-branch --branch JH7110_VisionFive2_6.12.y_devel https://github.com/starfive-tech/linux\ncd linux\ncp arch/riscv/configs/starfive_visionfive2_defconfig .config\nmake ARCH=riscv olddefconfig\n")),"\n",a.createElement(t.p,null,"Now we need to configure PREEMPT_RT:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"make ARCH=riscv menuconfig\n")),"\n",a.createElement(n,{src:r}),"\n",a.createElement(t.p,null,"In this menu screen we select ",a.createElement(t.strong,null,"Scheduler controlled preemption model")," mode under ",a.createElement(t.strong,null,"General setup")," then ",a.createElement(t.strong,null,"Preemption Model"),".\nIn my case I also had to set this in the ",a.createElement(t.code,null,".config")," file in order to differentiate this kernel from a ",a.createElement(t.code,null,"PREEMPT_DYNAMIC")," build I also created."),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,'CONFIG_LOCALVERSION="preempt-rt"\n')),"\n",a.createElement(t.p,null,"Back to the documentation and we start the compilation:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"make ARCH=riscv -j$(nproc) bindeb-pkg\n# for me the .deb files ended up being in the $HOME directory\ncd ..\nsudo dpkg -i \\\n    linux-headers-6.12.5*_riscv64.deb \\\n    linux-image-6.12.5*_riscv64.deb \\\n    linux-libc-dev_6.12.5*_riscv64.deb\n")),"\n",a.createElement(t.p,null,"When doing so more than once, I had to uninstall an old kernel; probably because there isn't enough space for the rgx firmware on initrd but I'm really not sure."),"\n",a.createElement(t.p,null,"This takes a while — some time to do the toilet, nice.\nStill not done?\nThen I have some time to write this article, also nice.\nMaybe I should've crosscompiled on my laptop.\nCompiling the Linux kernel on a computer that doesn't even have a heat-sink is something...\nThat took roughly an hour."),"\n",a.createElement(t.p,null,"Some notes:\nThe documentation warns about the dtbs not being synced but for me they were, so I left that as is and rebooted.\nInstalling ",a.createElement(t.code,null,"debhelper")," was missing in the documentation."),"\n",a.createElement(t.h2,{id:"dealing-with-multiple-kernels",style:{position:"relative"}},a.createElement(t.a,{href:"#dealing-with-multiple-kernels","aria-label":"dealing with multiple kernels permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Dealing with Multiple Kernels"),"\n",a.createElement(t.p,null,"I ended up having two v6.12.5 kernels installed: a ",a.createElement(t.code,null,"PREEMPT_RT")," and a ",a.createElement(t.code,null,"PREEMPT_DYNAMIC")," one.\nTo choose which one to boot I edited ",a.createElement(t.code,null,"/boot/extlinux/extlinux.conf"),".\nIt has such a nice warning not to edit it.\nHere I just renamed the ",a.createElement(t.code,null,"l0")," and ",a.createElement(t.code,null,"l0r")," labels to ",a.createElement(t.code,null,"l1")," and ",a.createElement(t.code,null,"l1r")," and the other way around.\nI also rearranged the labels to be a little nicer; I have no idea if that was needed."),"\n",a.createElement(t.p,null,"I did try using a ",a.createElement(t.em,null,"proper")," method of changing the kernel to boot but this was the only thing I came up with and it works.\nI left the ",a.createElement(t.code,null,"l2")," and ",a.createElement(t.code,null,"l2r")," labels in case I screwed something up."),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo vi /boot/extlinux/extlinux.conf\n")),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,"## /extlinux/extlinux.conf\n##\n## IMPORTANT WARNING\n##\n## The configuration of this file is generated automatically.\n## Do not edit this file manually, use: u-boot-update\n\ndefault l0\nmenu title U-Boot menu\nprompt 0\ntimeout 50\n\n\nlabel l0\n        menu label Debian GNU/Linux trixie/sid 6.12.5preempt-rt+\n        linux /vmlinuz-6.12.5preempt-rt+\n        initrd /initrd.img-6.12.5preempt-rt+\n        fdtdir /dtbs/6.12.5preempt-rt+\n\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0\n\nlabel l0r\n        menu label Debian GNU/Linux trixie/sid 6.12.5preempt-rt+ (rescue target)\n        linux /vmlinuz-6.12.5preempt-rt+\n        initrd /initrd.img-6.12.5preempt-rt+\n        fdtdir /dtbs/6.12.5preempt-rt+\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single\n\n\nlabel l1\n        menu label Debian GNU/Linux trixie/sid 6.12.5+\n        linux /vmlinuz-6.12.5+\n        initrd /initrd.img-6.12.5+\n        fdtdir /dtbs/6.12.5+\n\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0\n\nlabel l1r\n        menu label Debian GNU/Linux trixie/sid 6.12.5+ (rescue target)\n        linux /vmlinuz-6.12.5+\n        initrd /initrd.img-6.12.5+\n        fdtdir /dtbs/6.12.5+\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single\n\n\nlabel l2\n        menu label Debian GNU/Linux trixie/sid 6.6.20-starfive\n        linux /vmlinuz-6.6.20-starfive\n        initrd /initrd.img-6.6.20-starfive\n        fdtdir /dtbs/6.6.20-starfive\n\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0\n\nlabel l2r\n        menu label Debian GNU/Linux trixie/sid 6.6.20-starfive (rescue target)\n        linux /vmlinuz-6.6.20-starfive\n        initrd /initrd.img-6.6.20-starfive\n        fdtdir /dtbs/6.6.20-starfive\n        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single\n")),"\n",a.createElement(t.h1,{id:"testing",style:{position:"relative"}},a.createElement(t.a,{href:"#testing","aria-label":"testing permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Testing"),"\n",a.createElement(t.p,null,"Now we can do some testing of our real-time performance with cyclictest:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"sudo apt install rt-tests stress-ng\nsudo echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor\n# cpu\nstress-ng --matrix 4\n# mem\nstress-ng --vm 4\nsudo cyclictest --mlockall --smp --priority=99 --interval=200 --quiet --duration=10m --histofall=200 > out.txt\n")),"\n",a.createElement(t.h1,{id:"some-ideas-for-further-investigation",style:{position:"relative"}},a.createElement(t.a,{href:"#some-ideas-for-further-investigation","aria-label":"some ideas for further investigation permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Some Ideas for Further Investigation"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"disable ",a.createElement(t.code,null,"CONFIG_NO_HZ_IDLE")),"\n",a.createElement(t.li,null,"use ",a.createElement(t.code,null,"CONFIG_HZ_1000")," instead of ",a.createElement(t.code,null,"CONFIG_HZ_100")),"\n"),"\n",a.createElement(t.h1,{id:"other-things",style:{position:"relative"}},a.createElement(t.a,{href:"#other-things","aria-label":"other things permalink",className:"anchor before"},a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Other Things"),"\n",a.createElement(t.p,null,"To get my custom configs to work I had to edit my ",a.createElement(t.code,null,".bash_profile"),": ",a.createElement(t.a,{href:"https://unix.stackexchange.com/questions/94490/bash-doesnt-read-bashrc-unless-manually-started"},"unix.stackexchange.com/questions/94490/bash-doesnt-read-bashrc-unless-manually-started")))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.R)(),e.components);return t?a.createElement(t,e,a.createElement(i,e)):i(e)};var s=n(5365),c=n(2224),d=n(9121),h=n(4241),m=n(4810),u=n(1244),p=n(5071),f=n(9105),v=n(6897),g=n(7629),b=n(8029),E=n(1042),w=n(5526),S=n(5969);const k={AutoPlayVideo:p.A,HalfImage:f.A,Spacer:v.A,Quote:g.A,Iframe:b.A,CompareView:u.A,pre:e=>{let{children:t}=e;return a.createElement("div",{className:"code-container"}," ",a.createElement("pre",null,t))},code:e=>{let{children:t,className:n}=e;return n?a.createElement(w.A,{className:n},t):a.createElement("code",{className:"language-text"},t)},a:S.A},y=e=>{var t,n,r,i,o,u,p,f,v,g,b,E,w,S;let{data:y,children:_}=e;const x=null===(t=y.mdx)||void 0===t||null===(n=t.frontmatter)||void 0===n?void 0:n.version,N=null===(r=y.mdx)||void 0===r||null===(i=r.frontmatter)||void 0===i?void 0:i.title,I=/^0\./.test(x)?`Draft v${x}`:void 0,T=null===(o=y.mdx)||void 0===o||null===(u=o.frontmatter)||void 0===u?void 0:u.date,H=null!=(null===(p=y.mdx)||void 0===p||null===(f=p.frontmatter)||void 0===f?void 0:f.title_banner),A={"--banner-image-horizontal-position":null===(v=y.mdx)||void 0===v||null===(g=v.frontmatter)||void 0===g?void 0:g.title_banner_horizontal_position,"--banner-image-vertical-position":null===(b=y.mdx)||void 0===b||null===(E=b.frontmatter)||void 0===E?void 0:E.title_banner_vertical_position};return a.createElement(s.A,{heading:N,sub_heading:I,banner_image:H?null===(w=y.mdx)||void 0===w||null===(S=w.frontmatter)||void 0===S?void 0:S.title_banner:void 0,banner_image_style:A,small_banner:!0,banner_content:a.createElement("div",{className:`${c.yu} ${H?c.Lx:void 0}`},a.createElement("span",{className:c.cy},"Written by Christopher Besch, published on "),T)},a.createElement("div",{className:d.xo},a.createElement(l.x,{components:k},_)),a.createElement(m.N_,{className:`${h.om} ${h.nf}`,to:"/articles"},"More Articles"))};function _(e){return a.createElement(y,e,a.createElement(o,e))}const x=e=>{var t,n,l,r,i,o;let{data:s}=e;const c=null===(t=s.mdx)||void 0===t||null===(n=t.frontmatter)||void 0===n?void 0:n.title,d=null===(l=s.mdx)||void 0===l||null===(r=l.frontmatter)||void 0===r?void 0:r.description,h=null===(i=s.mdx)||void 0===i||null===(o=i.frontmatter)||void 0===o?void 0:o.banner,m=h&&"undefined"!=h?h:void 0;return a.createElement(E.A,{heading:c,description:d,banner:m})}}}]);
//# sourceMappingURL=component---src-templates-article-tsx-content-file-path-src-articles-12-riscv-rt-riscv-rt-md-d3bc0db6823629950c3e.js.map