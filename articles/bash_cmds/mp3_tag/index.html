<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Bodging MP3 Names in Bash</title><meta name="description" content=" Why do it complicated when a Bash one-liner does it too? "/><link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/></head><body><div class="layout_navbar"><a class="layout_navbar_left" href="/"><h1>Christopher Besch</h1><h2>Developer•Writer•Photographer</h2></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></div><div class="layout_transient_space"><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div><p>This is a transient space.</p></div><div class="layout_content_container"><div class="layout_content"><div class="title_in_text"><h1>Bodging MP3 Names in Bash</h1><hr/><h2>Wednesday, 12th October, 2022</h2></div><div class="article_page_markdown"><div class="markdown_body"><pre><code class="language-bash">find <span class="pl-c1">.</span> -name <span class="pl-s"><span class="pl-pds">&#x27;</span>*.mp3<span class="pl-pds">&#x27;</span></span> \
    -printf <span class="pl-s"><span class="pl-pds">&#x27;</span>echo $(exiftool -json &quot;%p&quot; | jq -r .[0].Track | python3 -c &quot;print(str(int(input())).rjust(3, \\&quot;0\\&quot;))&quot;) &quot;-&quot; <span class="pl-pds">&#x27;</span></span> \
    -printf <span class="pl-s"><span class="pl-pds">&#x27;</span>$(exiftool -json &quot;%p&quot; | jq -r .[0].Title) | <span class="pl-pds">&#x27;</span></span> \
    -printf <span class="pl-s"><span class="pl-pds">&#x27;</span>mv &quot;%p&quot; &quot;%h/$(tee).mp3&quot; &amp;&amp; <span class="pl-pds">&#x27;</span></span> \
    -printf <span class="pl-s"><span class="pl-pds">&#x27;</span>echo &quot;%p&quot; \n<span class="pl-pds">&#x27;</span></span> <span class="pl-k">|</span> \
        sh
</code></pre>
<p>Ok, let me break this down for you:</p>
<pre><code class="language-bash">find <span class="pl-c1">.</span> -name <span class="pl-s"><span class="pl-pds">&#x27;</span>*.mp3<span class="pl-pds">&#x27;</span></span> -printf <span class="pl-s"><span class="pl-pds">&#x27;</span>%p<span class="pl-pds">&#x27;</span></span>
</code></pre>
<p>get&#x27;s all files ending with <code>.mp3</code> (and directories too but I didn&#x27;t bother adding <code>-type f</code> to exclude them).
Then it prints something for each file (without adding newlines between the files).
<code>%p</code> gets replaced by the file&#x27;s path.</p>
<p>Instead of just printing the file name we print multiple commands that get piped into sh.
Each one consists of two parts plus a cherry on top.</p>
<h2 id="the-first-part"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#the-first-part"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The First Part</h2>
<p>Bash replaces <code>$(some_cmd)</code> with the output of <code>some_cmd</code>.
Therefore</p>
<pre><code class="language-bash"><span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">$(</span>exiftool -json <span class="pl-pds">&quot;</span>%p<span class="pl-pds">&quot;</span> <span class="pl-k">|</span> jq -r .[0].Track <span class="pl-k">|</span> python3 -c <span class="pl-pds">&quot;</span>print(str(int(input())).rjust(3, <span class="pl-cce">\\</span><span class="pl-pds">&quot;</span>0<span class="pl-cce">\\</span><span class="pl-pds">&quot;</span>))<span class="pl-pds">&quot;)</span></span> <span class="pl-s"><span class="pl-pds">&quot;</span>-<span class="pl-pds">&quot;</span></span>
</code></pre>
<p>expands to the output of that big concoction plus the little dash after the last brace.
In bash pipes, denoted by <code>|</code>, take the output of the left-hand command and input it into the right-hand one.
This is used to get all the metadata of our MP3 file in JSON format (<code>exiftool -json &quot;%p&quot;</code>) and extract the track number with <code>jq -r .[0].Track</code>.</p>
<p>But we want to pad that number to always have three digits (<code>007</code> instead of <code>7</code>).
There are thousands of different ways to do that but I didn&#x27;t bother looking them up and settled for probably the most complicated one:
We&#x27;re going to use Python!</p>
<pre><code class="language-bash">python3 -c <span class="pl-s"><span class="pl-pds">&#x27;</span>print(&quot;Hello World&quot;)<span class="pl-pds">&#x27;`</span></span>
</code></pre>
<p>runs</p>
<pre><code class="language-python"><span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Hello World<span class="pl-pds">&quot;</span></span>)
</code></pre>
<p>So</p>
<pre><code class="language-bash">python3 -c <span class="pl-s"><span class="pl-pds">&quot;</span>print(str(int(input())).rjust(3, <span class="pl-cce">\&quot;</span>0<span class="pl-cce">\&quot;</span>))<span class="pl-pds">&quot;</span></span>
</code></pre>
<p>runs (<code>\&quot;</code> gets escaped to <code>&quot;</code>)</p>
<pre><code class="language-python"><span class="pl-c1">print</span>(<span class="pl-c1">str</span>(<span class="pl-c1">int</span>(<span class="pl-c1">input</span>())).rjust(<span class="pl-c1">3</span>, <span class="pl-s"><span class="pl-pds">&quot;</span>0<span class="pl-pds">&quot;</span></span>))
</code></pre>
<p>which does the padding in a very, very bad way.
But we&#x27;re not here to do clean stuff, we&#x27;re here to bodge.
To make this run in the <code>-printf</code> flag, we have to escape the <code>\</code> (which we used to escape the <code>&quot;</code>) with another <code>\</code>.</p>
<h3 id="the-first-part-part-two"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#the-first-part-part-two"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The First Part, Part Two</h3>
<pre><code class="language-bash">-printf <span class="pl-s"><span class="pl-pds">&#x27;</span>$(exiftool -json &quot;%p&quot; | jq -r .[0].Title) | <span class="pl-pds">&#x27;</span></span> \
</code></pre>
<p>Does the same as what we&#x27;ve just seen but with the song title, which doesn&#x27;t require our Python <s>bodge</s> magic.</p>
<p>So the entire first part prints out <code>007 - song name</code>.</p>
<h2 id="the-second-part"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#the-second-part"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Second Part</h2>
<p>Now we want to use this to name our MP3 file.
Therefore we pipe the first part&#x27;s output into mv.
But mv doesn&#x27;t support pipes like that so we have to spill some tee.
I&#x27;m terribly sorry, I mean <code>$(tee)</code>.
The tee command does a lot of stuff but for all intents and purposes it just prints out whatever is piped into it.</p>
<p>So</p>
<pre><code class="language-bash">-printf <span class="pl-s"><span class="pl-pds">&#x27;</span>mv &quot;%p&quot; &quot;%h/$(tee).mp3&quot;<span class="pl-pds">&#x27;</span></span>
</code></pre>
<p>first replaces <code>%p</code> with the file&#x27;s original path and <code>%h</code> with the path to the directory the file is located in.
Then <code>$(tee).mp3</code> get&#x27;s replaced with the output of our echo command plus the file extension.
So it changes the name to <code>007 - song name.mp3</code>.</p>
<h2 id="the-cherry-on-top"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#the-cherry-on-top"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Cherry on Top</h2>
<p>Once all that has been done,</p>
<pre><code class="language-bash">-printf <span class="pl-s"><span class="pl-pds">&#x27;</span>echo &quot;%p&quot; \n<span class="pl-pds">&#x27;</span></span>
</code></pre>
<p>ensures that after mv did it&#x27;s business, the file path get&#x27;s printed to the console, so that the user knows something is happening.
And it also adds a linebreak in the end so that sh executes one command at a time.</p>
<h1 id="to-put-it-in-a-nutshell"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#to-put-it-in-a-nutshell"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To Put it in a Nutshell</h1>
<p>sh executes a list of commands that got printf-ed by find.
In the end these commands change the name of a file to something else.
And that something else got created by echo, which is printing a string that bash expands to the track number, a <code>-</code> and a string that bash expands to the song title.
Bash does that by cleaning up the output of exiftool.
This cleaning up is in turn being partially performed by python3, which runs a tiny Python script.</p>
<p>Pretty easy, isn&#x27;t it?
Getting this one-liner to work with files that include <code>&#x27;</code> and/or <code>&quot;</code> is left as an exercise to the reader.</p>
<p>Oh and it might also delete files without a track number, maybe try fixing that too.</p><div class="markdown_spacer"></div></div></div><div class="title_in_text"><h1>Other Articles</h1><hr/></div><div class="articles_list"><a class="articles_list_card" href="/articles/ctemsoft"><picture class="image_picture"><img srcSet="/images/c5fde5a326c6a0b5e07c470ffda1eb59_400_200.webp 400w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_800_400.webp 800w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_1200_600.webp 1200w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #e2e2e2, transparent),radial-gradient(67% 67% at 50% 25%, #e1e1e1, transparent),radial-gradient(67% 67% at 75% 25%, #e3e3e3, transparent),radial-gradient(67% 67% at 25% 50%, #e4e4e4, transparent),radial-gradient(67% 67% at 50% 50%, #d7d7d7, transparent),radial-gradient(67% 67% at 75% 50%, #c0c0c0, transparent),radial-gradient(67% 67% at 25% 75%, #f9f9f9, transparent),radial-gradient(67% 67% at 50% 75%, #d9d9d9, transparent),radial-gradient(67% 67% at 75% 75%, #c1c1c1, transparent),linear-gradient(#dddddd);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Docker: Breathing Life into Decades old Fortran</h1><h2>Sunday, 6th April, 2025</h2><hr/><p> Bringing decades old Fortran code to life with Docker and animating it with Python.
Now you get to see Fig.3.5. from &quot;Introduction to Conventional Transmission Electron Microscopy&quot; by Prof. Marc De Graef at 30 frames a second. </p></a><a class="articles_list_card" href="/articles/mc_missile"><picture class="image_picture"><img srcSet="/images/e504095a9b565988179fa2df918ae18c_400_200.webp 400w,/images/e504095a9b565988179fa2df918ae18c_800_400.webp 800w,/images/e504095a9b565988179fa2df918ae18c_1200_600.webp 1200w,/images/e504095a9b565988179fa2df918ae18c_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #310e0d, transparent),radial-gradient(67% 67% at 50% 25%, #2a0e0d, transparent),radial-gradient(67% 67% at 75% 25%, #200a0a, transparent),radial-gradient(67% 67% at 25% 50%, #664842, transparent),radial-gradient(67% 67% at 50% 50%, #552c22, transparent),radial-gradient(67% 67% at 75% 50%, #1d0404, transparent),radial-gradient(67% 67% at 25% 75%, #7e3c1f, transparent),radial-gradient(67% 67% at 50% 75%, #813412, transparent),radial-gradient(67% 67% at 75% 75%, #3f1308, transparent),linear-gradient(#481f15);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Guided Missiles in Minecraft</h1><h2>Friday, 6th June, 2025</h2><hr/><p> I&#x27;m having a stab at designing an enitity seeking missile in Minecraft with the mc_missile mod.
Or: How I blew up my brother. </p></a><a class="articles_list_card" href="/articles/riscv_rt"><picture class="image_picture"><img srcSet="/images/e85afd024262b6186553d361a5908877_400_200.webp 400w,/images/e85afd024262b6186553d361a5908877_800_400.webp 800w,/images/e85afd024262b6186553d361a5908877_1200_600.webp 1200w,/images/e85afd024262b6186553d361a5908877_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #cfcfd0, transparent),radial-gradient(67% 67% at 50% 25%, #c6cace, transparent),radial-gradient(67% 67% at 75% 25%, #cecdcd, transparent),radial-gradient(67% 67% at 25% 50%, #c4c7ca, transparent),radial-gradient(67% 67% at 50% 50%, #c1c2c4, transparent),radial-gradient(67% 67% at 75% 50%, #c7c9cb, transparent),radial-gradient(67% 67% at 25% 75%, #afc2d2, transparent),radial-gradient(67% 67% at 50% 75%, #a5bbd0, transparent),radial-gradient(67% 67% at 75% 75%, #b6c6d3, transparent),linear-gradient(#c0c8cf);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Real-Time Linux on RISC-V</h1><h2>Friday, 27th June, 2025</h2><hr/><p> Setting up Linux v6.12 on a StarFive VisionFive 2 with PREEMPT_RT.
Also: How to setup your Linux laptop as a simple NAT router. </p></a><a class="articles_list_card" href="/articles/github_pages_hack"><picture class="image_picture"><img srcSet="/images/2429205e42d7ecf6646d20aea86a90ce_400_200.webp 400w,/images/2429205e42d7ecf6646d20aea86a90ce_800_400.webp 800w,/images/2429205e42d7ecf6646d20aea86a90ce_1200_600.webp 1200w,/images/2429205e42d7ecf6646d20aea86a90ce_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #e6e8ed, transparent),radial-gradient(67% 67% at 50% 25%, #f5f5f7, transparent),radial-gradient(67% 67% at 75% 25%, #f8f8f8, transparent),radial-gradient(67% 67% at 25% 50%, #eef2f2, transparent),radial-gradient(67% 67% at 50% 50%, #f8f9f9, transparent),radial-gradient(67% 67% at 75% 50%, #fbfafa, transparent),radial-gradient(67% 67% at 25% 75%, #edf0f1, transparent),radial-gradient(67% 67% at 50% 75%, #f7f7f7, transparent),radial-gradient(67% 67% at 75% 75%, #f6f8f9, transparent),linear-gradient(#f4f5f6);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>How my GitHub Pages got Hacked</h1><h2>Saturday, 18th October, 2025</h2><hr/><p> A DNS forward is an expression of trust. GitHub broke my trust and someone else received control over my domain. </p></a></div><a href="/articles" class="button">Furthermore Articles</a></div></div><div class="layout_footer"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/articles/privacy">Privacy</a><div>© 2025 | All rights reserved</div></div></body></html>