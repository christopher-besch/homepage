<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>The History of Forgejo&#x27;s Pub-Sub Pattern</title><meta name="description" content=" I created a tool to visualize Forgejo&#x27;s Pub-Sub pattern. Why not run that tool on all 24 thousand commits in Forgejo&#x27;s history? What could possibly go wrong? "/><link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/></head><body><div class="layout_navbar"><a class="layout_navbar_left" href="/"><h1>Christopher Besch</h1><h2>Developer•Writer•Photographer</h2></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></div><div class="layout_transient_space"><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div><p>This is a transient space.</p></div><div class="layout_content_container"><div class="layout_hero" style="--layout-object-fit-h:50%;--layout-object-fit-v:30%;--layout-hero-fraction:0.7"><picture class="image_picture"><source srcSet="/images/a49b867af75de4071675ccda6f2730ce_400_225.webp 400w,/images/a49b867af75de4071675ccda6f2730ce_800_450.webp 800w,/images/a49b867af75de4071675ccda6f2730ce_1200_675.webp 1200w,/images/a49b867af75de4071675ccda6f2730ce_1600_900.webp 1600w" type="image/webp" width="400" height="225" media="(orientation: landscape)"/><source srcSet="/images/a49b867af75de4071675ccda6f2730ce_50_400_533.webp 400w,/images/a49b867af75de4071675ccda6f2730ce_50_600_800.webp 600w" type="image/webp" width="400" height="533" media="(orientation: portrait) and (max-width: 500px)"/><img srcSet="/images/a49b867af75de4071675ccda6f2730ce_400_225.webp 400w,/images/a49b867af75de4071675ccda6f2730ce_800_450.webp 800w,/images/a49b867af75de4071675ccda6f2730ce_1200_675.webp 1200w,/images/a49b867af75de4071675ccda6f2730ce_1600_900.webp 1600w" width="400" height="225" style="background-image:radial-gradient(67% 67% at 25% 25%, #7e807e, transparent),radial-gradient(67% 67% at 50% 25%, #a5a7aa, transparent),radial-gradient(67% 67% at 75% 25%, #d2d3da, transparent),radial-gradient(67% 67% at 25% 50%, #1e1f0a, transparent),radial-gradient(67% 67% at 50% 50%, #494a3f, transparent),radial-gradient(67% 67% at 75% 50%, #999fa9, transparent),radial-gradient(67% 67% at 25% 75%, #636a73, transparent),radial-gradient(67% 67% at 50% 75%, #7c838f, transparent),radial-gradient(67% 67% at 75% 75%, #798291, transparent),linear-gradient(#7c8185);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="eager"/></picture><div class="layout_hero_children"><div class="title_in_hero"><h1>The History of Forgejo&#x27;s Pub-Sub Pattern</h1><hr/><h2>Thursday, 30th October, 2025</h2></div></div></div><div class="layout_content"><div class="article_page_markdown"><div class="markdown_body"><p>I stood before a well and wondered how deep it would go.
All I could see was blackness.
Well, I didn&#x27;t actually leave my cellar and instead stood before Forgejo&#x27;s git history.
But still, with the 24 thousand commits Forgejo&#x27;s history felt just as opaque.<br/>
Forgejo is a code forge like GitHub or GitLab.
Forgejo is a place to (collaboratively) develop software and is itself fully Open-Source, so of course I love it!
I&#x27;ve already explained at length <a href="/articles/open_source">why we benefit greatly from Open-Source</a>.
What I&#x27;m interested in is Forgejo&#x27;s <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">publish-subscribe pattern</a>.
It allows packages to publish messages grouped by topics.
Other packages subscribe to those topics and get called when a message for a topic of interest arrives.
<code>forgejo.org/services/notify.Notify</code> is the broker, which facilitating all this.
I&#x27;ve created a visualization of this pub-sub pattern.
Packages are Forgejo-orange and topics Codeberg-blue.
Every arrow goes in the direction messages flow; from sender to receiver.
Please use a device with a large screen like a laptop; it doesn&#x27;t work on a smartphone.</p>
<div><div class="half_element_full_element"><div class="markdown_iframe_wrapper"><iframe allowFullScreen="" src="https://christopher-besch.github.io/go_observer_pattern_visualizer/viewer"></iframe></div></div><div class="half_element_spacer"></div></div>
<p>The list on the right shows all commits in Forgejo&#x27;s history that change something about the pub-sub pattern.
Select a commit see how Forgejo looked like back then.
Once you&#x27;ve selected a commit you can use the arrow keys, too.</p>
<h2 id="go-ast-a-lot-of-bash-and-d3js"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#go-ast-a-lot-of-bash-and-d3js"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Go AST, a lot of Bash and D3.js</h2>
<p>How did I create this visualization?
Firstly, let&#x27;s take a look at how Forgejo&#x27;s pub-sub pattern works.
Every participating package defines a notifier struct and uses the broker like this:</p>
<pre><code class="language-go"><span class="pl-c">// Define the notifier.</span>
<span class="pl-k">type</span> actionsNotifier <span class="pl-k">struct</span> {
	notify_service.<span class="pl-smi">NullNotifier</span>
}

<span class="pl-c">// Ensure that this struct fulfills the Notifier interface.</span>
<span class="pl-k">var</span> <span class="pl-smi">_</span> notify_service.<span class="pl-smi">Notifier</span> = &amp;actionsNotifier{}

<span class="pl-c">// Declare functions for all topics the package is interested in.</span>
<span class="pl-k">func</span> (<span class="pl-v">n</span> *<span class="pl-v">actionsNotifier</span>) <span class="pl-v">NewIssue</span>(<span class="pl-c">/* --snip-- */</span>) {
<span class="pl-c">// --snip--</span>

<span class="pl-c">// Tell the broker there&#x27;s a new notifier to be notified.</span>
notify_service.<span class="pl-c1">RegisterNotifier</span>(&amp;actionsNotifier{})

<span class="pl-c">// send a message to some topic</span>
notify_service.<span class="pl-c1">PullReviewDismiss</span>(ctx, doer, review, comment)
</code></pre>
<p>So what I had to do was find these places in Forgejo&#x27;s source code and compile that data into a usable format.
I thought about doing this with grep and simple string matching but figured something more robust wouldn&#x27;t hurt.
Therefore, I used Go&#x27;s <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">abstract syntax tree (AST)</a> directly.
The AST is an intermediate state in the Go compiler; the compiler generates the AST from the source code and then the machine instructions from the AST.
To my delight, there is the <code>go/ast</code> package to walk through the AST and <code>go/types</code> for type checking.
There even is the convenient <code>golang.org/x/tools/go/packages</code> package to tie it all together.
Take a look at my <a href="https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/parser/main.go">parser main.go</a> if you&#x27;re interested in some details.
This script spits out a single JSON.
For the pretty visualization I used <a href="https://d3js.org">D3.js</a>&#x27;s force simulation.
It simulates repelling forces between all nodes and attracting forces between connected ones.
Take a look at the <a href="https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/viewer">viewer source code</a> for more on that.</p>
<h2 id="the-well-and-the-light"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#the-well-and-the-light"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Well and the Light</h2>
<p>Now that I had a way to extract this data for one state of Forgejo&#x27;s code base, a bigger idea came to me.
Why not do this for every commit in Forgejo&#x27;s history?
How difficult could it be?
As you can see above, that did work out but not without hiccups.
So, I invite you to come on a little journey down Forgejo&#x27;s history:
Let&#x27;s throw a light down that well!</p>
<h3 id="0000m-2025-10-27-346f87d"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#0000m-2025-10-27-346f87d"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>0,000m</em> 2025-10-27 (<a href="https://codeberg.org/forgejo/forgejo/commit/346f87d7a26d7c3678867961c74487e5b759cbf0">346f87d</a>)</h3>
<p>I started in front of the well:
A few days ago I created <a href="https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/auto_parser.sh">a Bash script</a> that runs the parser script, checks out the next-older commit and repeats the process.
This script ran for days creating thousands of JSON files.
I created another <a href="https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/post_process/main.go">Go script</a> to clean up this mess e.g. by deleting duplicates.<br/>
At <a href="https://codeberg.org/forgejo/forgejo/commit/346f87d7a26d7c3678867961c74487e5b759cbf0">346f87d</a> I let my script run and fall into the darkness below.
I didn&#x27;t know what it would uncover and if it would encounter some hurdles.
Let&#x27;s say I started at ground level and every commit I go down is another meter below the surface.</p>
<h3 id="0780m-2025-06-17-16dbc0e"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#0780m-2025-06-17-16dbc0e"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>0,780m</em> 2025-06-17 (<a href="https://codeberg.org/forgejo/forgejo/commit/16dbc0efd350cdc15760c2e40346c1e9fbb0bd01">16dbc0e</a>)</h3>
<p>This was my first hiccup; my Go script crashed.
Apparently this commit removed a type of token that my script didn&#x27;t expect (a SelectorExpr with a Selector that doesn&#x27;t map to any object).
So, all commits older than this one crash my script.
I added a nil check and dropped it back in the well.</p>
<pre><code class="language-go">pkg.<span class="pl-smi">TypesInfo</span>.<span class="pl-smi">Uses</span>[f.<span class="pl-smi">Sel</span>] != <span class="pl-c1">nil</span>
</code></pre>
<h3 id="1225m-2025-03-27-2457f5f"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#1225m-2025-03-27-2457f5f"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>1,225m</em> 2025-03-27 (<a href="https://codeberg.org/forgejo/forgejo/commit/2457f5ff2293f69e6de5cc7d608dd210f6b8e27a">2457f5f</a>)</h3>
<p>And I encountered another hiccup; in March Forgejo changed the Go module path from <code>code.gitea.io/gitea</code> to <code>forgejo.org</code>.
After all, Forgejo is a fork of Gitea.
I adjusted my Go script and made the viewer remove the <code>forgejo.org</code> and <code>code.gitea.io/gitea</code> prefixes.</p>
<h3 id="7568m-2023-09-05-540bf9f"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#7568m-2023-09-05-540bf9f"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>7,568m</em> 2023-09-05 (<a href="https://codeberg.org/forgejo/forgejo/commit/540bf9fa6d0d86297c9d575640798b718767bd9f">540bf9f</a>)</h3>
<p>And whush, I just dropped through to before the Forgejo fork.
Here the Gitea developers changed the pub-sub broker package from <code>code.gitea.io/gitea/modules/notification/base.Notifier</code> to <code>code.gitea.io/gitea/services/notify.Notifier</code>.
I adjust the script and continued.</p>
<h3 id="10956m-2022-03-16-ed1d95c"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#10956m-2022-03-16-ed1d95c"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>10,956m</em> 2022-03-16 (<a href="https://codeberg.org/forgejo/forgejo/commit/ed1d95c55dfa91d1c9a486bfb8e00375d4038e29">ed1d95c</a>)</h3>
<p>My script crashed just below this commit, which upgrades from <code>go1.17</code> to <code>go1.18</code>.
Apparently <code>golang.org/x/tools/go/packages</code> requires <code>go mod tidy</code> to run on a <code>go1.17</code> project.
I added <code>go mod tidy</code> to my script and let it run for the night.
When I woke up the next morning I noticed that my Nextcloud instance was down.
After quickly logging into my server I realized it entirely ran out of disk space, whups.
The <code>~/go</code> directory grew so large with Forgejo&#x27;s many old dependencies it completely crippled my server.
Running my script in a Docker container didn&#x27;t help here.
Now my script auto-deletes the <code>~/go</code> dir when it gets too large.</p>
<h3 id="12264m-2021-06-23-17030ce"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#12264m-2021-06-23-17030ce"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>12,264m</em> 2021-06-23 (<a href="https://codeberg.org/forgejo/forgejo/commit/17030ced75059ec21f6fb1945a751c3ebef29a32">17030ce</a>)</h3>
<p>Here a problem occurred when I re-ran my script with older versions of Go (more info on that below).
Somehow <code>go1.14</code> failed to <code>go1.14 mod tidy</code> below this commit.
Though, my up-to-date <code>go1.25.3</code> did work so now my script uses the new Go version whenever the old one fails.
It&#x27;s a hack, but it works.</p>
<h3 id="15946m-2019-09-12-3f5cdfe"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#15946m-2019-09-12-3f5cdfe"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>15,946m</em> 2019-09-12 (<a href="https://codeberg.org/forgejo/forgejo/commit/3f5cdfe35905730ced41397c6ccd50df3804b5ec">3f5cdfe</a>)</h3>
<p>My script crashed again, this time for a most peculiar reason; <code>go mod tidy</code> failed.
I had been using the current <code>go1.25.3</code> tools.
Now that I got so far down, so far back to when Forgejo used <code>go1.12</code> that <code>go1.25.3</code> had no idea what to make of the old project.
Therefore, I had to adjust my script to look for the version of Go Forgejo used at that time, install and use that instead.</p>
<p>I find this so very fascinating.
Say you&#x27;re writing a script that parses some questionnaires filled out by a lot of people.
Then every person&#x27;s questionnaire will have the same structure.
Apart from a few outliers, who spilled their coffee over the questionnaire, you implement one parser for the entire data-set and all is well.
But here, with history, every assumption you make based on the newest version doesn&#x27;t have to hold for all older versions.
Like in this case where I expected the source code to have changed from commit to commit.
But I didn&#x27;t expect the Go tooling to have changed, too.</p>
<p>Btw, I forgot what commit this problem occurred on but did remember that it happened with the switch from <code>go1.12</code> to <code>go1.13</code>.
What commit is the first that uses <code>go1.13</code>?
<code>git bisect</code> is a great tool to answer questions like these.
You simply give it one commit that is definitely old (i.e., uses <code>go1.12</code> or older) and one commit that is definitely new (i.e., uses <code>go1.13</code> or newer).
Then <code>git bisect</code> spits you out at a commit somewhere in the middle and asks you, &quot;Is this commit old or new?&quot;
You tell it <code>git bisect old</code> or <code>git bisect new</code> and it spits you out in a new place.
You perform a binary search that lets you come through thousands of commits in a breeze.
If you&#x27;re working on a code base you don&#x27;t know the authors of, this is a great tool for figuring out what explanations the authors left in their commit messages.
Especially when you have a question <code>git blame</code> can&#x27;t simply answer, <code>git bisect</code> is a great tool.</p>
<pre><code class="language-bash">git bisect start
git bisect old d77176912bccf1dc0ad93366df55f00fee23b498
git bisect new forgejo
cat go.mod <span class="pl-k">|</span> grep -P <span class="pl-s"><span class="pl-pds">&#x27;</span>^go <span class="pl-pds">&#x27;</span></span> <span class="pl-k">|</span> cut -d <span class="pl-s"><span class="pl-pds">&#x27;</span> <span class="pl-pds">&#x27;</span></span> -f2
<span class="pl-c"># 1.20</span>
git bisect new
<span class="pl-c"># --snip--</span>
</code></pre>
<h3 id="16625m-2019-03-27-d578b71"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#16625m-2019-03-27-d578b71"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>16,625m</em> 2019-03-27 (<a href="https://codeberg.org/forgejo/forgejo/commit/d578b71d61ee8131e8abf7f538b93d8c6cc6fe6d">d578b71</a>)</h3>
<p>This commit moves the code base from <code>code.gitea.io/git</code> to <code>code.gitea.io/gitea</code>.
Uff, okay, I added another rename option.</p>
<h3 id="16940m-2019-01-13-beab2df"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#16940m-2019-01-13-beab2df"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>16,940m</em> 2019-01-13 (<a href="https://codeberg.org/forgejo/forgejo/commit/beab2df1227f9b7e556aa5716d94feb3a3e2088e">beab2df</a>)</h3>
<p>And another rename.
This commit moves the broker struct from <code>modules/notification/base/base.go</code> to <code>modules/notification/base/notifier.go</code>.</p>
<h3 id="16141m-2019-07-25-5efd363"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#16141m-2019-07-25-5efd363"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>16,141m</em> 2019-07-25 (<a href="https://codeberg.org/forgejo/forgejo/commit/5efd3630bc21d4b0ba6ff492d16d4c7e2814dd1f">5efd363</a>)</h3>
<p>There are a lot of problems down here at 16km below the surface.
Now there&#x27;s a problem with the xorm dependency.
This commit updates to xorm <code>v0.7.4</code> but the old <code>v0.7.3-0.20190620151208-f1b4f8368459</code> fails with <code>go mod tidy</code>.
I don&#x27;t know why but my fix is as hacky as it is simple:</p>
<pre><code class="language-bash">sed -i <span class="pl-s"><span class="pl-pds">&#x27;</span>s#github.com/go-xorm/xorm v0.7.3-0.20190620151208-f1b4f8368459#github.com/go-xorm/xorm v0.7.3#<span class="pl-pds">&#x27;</span></span> go.mod
</code></pre>
<p>Btw, this is the old xorm repo on GitHub before it got moved to a Gitea server.
I&#x27;m glad the old repo is only archived and not deleted.
Otherwise, I&#x27;d have to do more work here.<br/>
Come to think of it, there are a lot of old dependency versions we rarely care about.
If they are lost, we won&#x27;t be able to build old versions of our software.
That might be real trouble if we want to reproduce some problem with outdated software.</p>
<h3 id="16624m-2019-03-27-d771769"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#16624m-2019-03-27-d771769"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>16,624m</em> 2019-03-27 (<a href="https://codeberg.org/forgejo/forgejo/commit/d77176912bccf1dc0ad93366df55f00fee23b498">d771769</a>)</h3>
<p>We are so far below the surface we don&#x27;t even have a <code>go.mod</code> file anymore.
Gitea used <code>Gopkg.lock</code> before this commit.
Now my script creates its own <code>go.mod</code> if required.</p>
<pre><code class="language-bash"><span class="pl-k">if</span> [ <span class="pl-k">!</span> <span class="pl-k">-f</span> go.mod ]<span class="pl-k">;</span> <span class="pl-k">then</span>
    go mod init
<span class="pl-k">fi</span>
</code></pre>
<h3 id="17177m-2018-10-18-ea619b3"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#17177m-2018-10-18-ea619b3"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>17,177m</em> 2018-10-18 (<a href="https://codeberg.org/forgejo/forgejo/commit/ea619b39b2f2a3c1fb5ad28ebd4a269b2f822111">ea619b3</a>)</h3>
<p>Here, my script threw its final error: Empty output.<br/>
There&#x27;s no more pub-sub pattern to look for below this.
This commit is where the pub-sub pattern was created.
This commit is the bottom of the well our light just hit and thus the end of our pub-sub journey.
Alas, we could still check how much more rock there is below the well.</p>
<h3 id="23913m-2014-02-11-475e347"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#23913m-2014-02-11-475e347"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>23,913m</em> 2014-02-11 (<a href="https://codeberg.org/forgejo/forgejo/commit/475e3471b4e8da8776fe7e66a3390c8a30c19f08">475e347</a>)</h3>
<p>And this is it, the very first commit in Forgejo&#x27;s history.
We are so far back, the project isn&#x27;t named Forgejo or even Gitea anylonger; down here the project goes by the name Gogs.
Now there really isn&#x27;t any deeper to go.</p>
<h2 id="what-the-visualization-shows"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#what-the-visualization-shows"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What the Visualization Shows</h2>
<p>Let&#x27;s climb back out of the well and recollect what we&#x27;ve encountered.
Firstly, there used to be a topic no package ever sent a message to, <code>NotifyPullRevieweDismiss</code>.
It was removed <a href="https://codeberg.org/forgejo/forgejo/commit/9524b8c3702e204d9f942090acb39a3549c80ca8">in June</a> and we can see that in the visualization.<br/>
Then there&#x27;s my own contribution to Forgejo: the <code>ActionRunNowDone</code> topic.
The visualization shows how I implemented the topic without any receiving packages at first.
In a second commit I attached the <code>services/mailer</code> and in a third the <code>services/webhook</code> package.<br/>
Oh and I found some very strange behaviour from December 2022 to September 2023:
<a href="https://codeberg.org/forgejo/forgejo/commit/c53f802778c1951e0804507eec995bca37f1b09b">c53f802</a> removed the <code>Notify</code> prefix from all topics.
On the very next day, however, <a href="https://codeberg.org/forgejo/forgejo/commit/a89b399faa275c28d0ffe9759d492636f67d6da0">a89b399</a> reverted that.
This goes back and forth a lot, which explains the jarring visualization around this time.
In the end <a href="https://codeberg.org/forgejo/forgejo/commit/540bf9fa6d0d86297c9d575640798b718767bd9f">540bf9f</a> removed the <code>Notify</code> prefix for the last time.
Maybe this is a broken bit in the Forgejo git history?
I colored these commits red in the visualization.<br/>
Finally, as of <a href="https://codeberg.org/forgejo/forgejo/commit/9524b8c3702e204d9f942090acb39a3549c80ca8">9524b8c</a> there&#x27;s still some dead code:
The <code>Run</code> topic is never sent a message to and no one listens to the <code>DeleteIssue</code> topic.
Maybe those topics should be removed.
One could automate a check like this, maybe in CI.</p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#conclusion"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>This really felt like diving into the abyss.
I never knew what lies below and when my script would fail for the next time.
It gave me chills, working code every day that has such history.
There is so much knowledge we stand upon.
And there are few general things I learned:</p>
<ul>
<li>Nothing stays the same given enough time.
All my assumptions broke at some point, Forgejo used different tooling, different paths, different directory structures.</li>
<li>Go is surprisingly good for scripting.
Usually I would have done something like this with Python but I hate it&#x27;s lack of type safety.
Though I don&#x27;t fancy Go&#x27;s lack of null-safety, it is a lot quicker to write than something like Rust.
I think I&#x27;ll use it more often.</li>
<li>I ran my script unattended using tmux on a server; tmux is pretty amazing for these kinds of things.
Though, I really shouldn&#x27;t have used my production server and got separate hardware.</li>
</ul>
<h2 id="ps"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#ps"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>P.S.</h2>
<p>I created this visualization for my <a href="/articles/forgejo_actions_notification">Forgejo Actions Notification Development</a> article and <a href="https://present.chris-besch.com/2025_11_21_ibm_forgejo/">Forgejo Architecture Deep Dive</a> talk.</p>
<h2 id="pps"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#pps"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>P.P.S.</h2>
<p>I used these commands to generate the <em>&quot;depth&quot;</em> and date for each commit:</p>
<pre><code class="language-bash">TZ=UTC0 git show --no-patch --date=local <span class="pl-s"><span class="pl-pds">&#x27;</span>--format=%ci<span class="pl-pds">&#x27;</span></span> 16dbc0efd350cdc15760c2e40346c1e9fbb0bd01
git rev-list --count 16dbc0efd350cdc15760c2e40346c1e9fbb0bd01..346f87d7a26d7c3678867961c74487e5b759cbf0
</code></pre><div class="markdown_spacer"></div></div></div><div class="title_in_text"><h1>Other Articles</h1><hr/></div><div class="cards_list"><a class="cards_list_card" href="/articles/forgejo_actions_notification"><picture class="image_picture"><img srcSet="/images/75e7dd6865f7b8d52489a1f1368ebbef_400_200.webp 400w,/images/75e7dd6865f7b8d52489a1f1368ebbef_800_400.webp 800w,/images/75e7dd6865f7b8d52489a1f1368ebbef_1200_600.webp 1200w,/images/75e7dd6865f7b8d52489a1f1368ebbef_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #ededef, transparent),radial-gradient(67% 67% at 50% 25%, #ebeae9, transparent),radial-gradient(67% 67% at 75% 25%, #d7d0d0, transparent),radial-gradient(67% 67% at 25% 50%, #f1f2f3, transparent),radial-gradient(67% 67% at 50% 50%, #ececec, transparent),radial-gradient(67% 67% at 75% 50%, #d8e1e3, transparent),radial-gradient(67% 67% at 25% 75%, #efedf0, transparent),radial-gradient(67% 67% at 50% 75%, #cfdfdf, transparent),radial-gradient(67% 67% at 75% 75%, #bbdac0, transparent),linear-gradient(#e0e5e4);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Forgejo Actions Notification Development</h1><h2>Thursday, 20th November, 2025</h2><hr/><p> Some stories of how I work on Forgejo. How is a Go project structured? What&#x27;s the point of Forgejo&#x27;s layered architecture and what&#x27;s that pub-sub pattern? Additionally, I exhaustively explain how to setup a development environment for Forgejo. </p></a><a class="cards_list_card" href="/articles/technical_compromises"><picture class="image_picture"><img srcSet="/images/3548ef292f5ade7df6bc737602d59bd8_400_200.webp 400w,/images/3548ef292f5ade7df6bc737602d59bd8_800_400.webp 800w,/images/3548ef292f5ade7df6bc737602d59bd8_1200_600.webp 1200w,/images/3548ef292f5ade7df6bc737602d59bd8_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #475764, transparent),radial-gradient(67% 67% at 50% 25%, #4a5b68, transparent),radial-gradient(67% 67% at 75% 25%, #4a5c68, transparent),radial-gradient(67% 67% at 25% 50%, #2b3c4d, transparent),radial-gradient(67% 67% at 50% 50%, #46505b, transparent),radial-gradient(67% 67% at 75% 50%, #847b70, transparent),radial-gradient(67% 67% at 25% 75%, #1d242a, transparent),radial-gradient(67% 67% at 50% 75%, #55483e, transparent),radial-gradient(67% 67% at 75% 75%, #665648, transparent),linear-gradient(#4b5155);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>The Bitter Feeling of Technical Compromises</h1><h2>Thursday, 25th September, 2025</h2><hr/><p> My very personal troubles dealing with compromises, explained at an example of docker_cron with Renovate.
Sometimes you really don&#x27;t have to worry as much and trust your previous, careful considerations. </p></a><a class="cards_list_card" href="/articles/bash_cmds/mp3_tag"><picture class="image_picture"><img srcSet="/images/5c491b010e8b22c6ffd20605f69d322f_400_200.webp 400w,/images/5c491b010e8b22c6ffd20605f69d322f_800_400.webp 800w,/images/5c491b010e8b22c6ffd20605f69d322f_1200_600.webp 1200w,/images/5c491b010e8b22c6ffd20605f69d322f_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #132011, transparent),radial-gradient(67% 67% at 50% 25%, #182416, transparent),radial-gradient(67% 67% at 75% 25%, #1b1c1b, transparent),radial-gradient(67% 67% at 25% 50%, #1b191b, transparent),radial-gradient(67% 67% at 50% 50%, #1c1a1c, transparent),radial-gradient(67% 67% at 75% 50%, #181818, transparent),radial-gradient(67% 67% at 25% 75%, #1f1f1f, transparent),radial-gradient(67% 67% at 50% 75%, #1e1e1e, transparent),radial-gradient(67% 67% at 75% 75%, #111111, transparent),linear-gradient(#191c19);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Bodging MP3 Names in Bash</h1><h2>Wednesday, 12th October, 2022</h2><hr/><p> Why do it complicated when a Bash one-liner does it too? </p></a><a class="cards_list_card" href="/articles/svg_fonts_with_sed"><picture class="image_picture"><img srcSet="/images/f59a7f43e2f2a641d46f9fd994b5589c_400_200.webp 400w,/images/f59a7f43e2f2a641d46f9fd994b5589c_800_400.webp 800w,/images/f59a7f43e2f2a641d46f9fd994b5589c_1200_600.webp 1200w,/images/f59a7f43e2f2a641d46f9fd994b5589c_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #f5f6f6, transparent),radial-gradient(67% 67% at 50% 25%, #d6dbdf, transparent),radial-gradient(67% 67% at 75% 25%, #dadfe4, transparent),radial-gradient(67% 67% at 25% 50%, #b6b8ae, transparent),radial-gradient(67% 67% at 50% 50%, #614349, transparent),radial-gradient(67% 67% at 75% 50%, #604c4d, transparent),radial-gradient(67% 67% at 25% 75%, #d3d6c9, transparent),radial-gradient(67% 67% at 50% 75%, #bca298, transparent),radial-gradient(67% 67% at 75% 75%, #8b756c, transparent),linear-gradient(#b4aca9);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Inject Fonts into Web SVGs with sed</h1><h2>Monday, 10th February, 2025</h2><hr/><p> Add font-loading CSS to SVGs with a sed script. </p></a></div><a href="/articles" class="button">Furthermore Articles</a></div></div><div class="layout_footer"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/articles/privacy">Privacy</a><div>© 2025 | All rights reserved</div></div></body></html>