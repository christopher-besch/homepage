<!DOCTYPE html><html lang="en"><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Real-Time Linux on RISC-V</title><link rel="canonical" href="https://chris-besch.com/articles/riscv_rt"/><meta property="og:title" content="Real-Time Linux on RISC-V"/><meta property="twitter:title" content="Real-Time Linux on RISC-V"/><meta name="description" content="Setting up Linux v6.12 on a StarFive VisionFive 2 with PREEMPT_RT.
Also: How to setup your Linux laptop as a simple NAT router."/><meta property="og:description" content="Setting up Linux v6.12 on a StarFive VisionFive 2 with PREEMPT_RT.
Also: How to setup your Linux laptop as a simple NAT router."/><meta property="twitter:description" content="Setting up Linux v6.12 on a StarFive VisionFive 2 with PREEMPT_RT.
Also: How to setup your Linux laptop as a simple NAT router."/><meta property="og:type" content="article"/><meta property="og:url" content="https://chris-besch.com/articles/riscv_rt"/><meta property="og:site_name" content="Chris&#x27; Place"/><meta property="og:image" content="https://chris-besch.com/images/e85afd024262b6186553d361a5908877_1200_600.webp"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content=""/><meta property="og:image" content="https://chris-besch.com/images/e85afd024262b6186553d361a5908877_800_400.webp"/><meta property="og:image:width" content="800"/><meta property="og:image:height" content="400"/><meta property="og:image:alt" content=""/><meta property="og:image" content="https://chris-besch.com/images/e85afd024262b6186553d361a5908877_400_200.webp"/><meta property="og:image:width" content="400"/><meta property="og:image:height" content="200"/><meta property="og:image:alt" content=""/><meta property="twitter:image" content="https://chris-besch.com/images/e85afd024262b6186553d361a5908877_1200_600.webp"/><meta name="twitter:card" content="summary_large_image"/><meta name="og:article:published_time" content="2025-06-27T00:00:00.000Z"/><meta name="og:article:author" content="Christopher Besch"/><meta name="twitter:site" content="@besch_chris"/><meta name="twitter:creator" content="@besch_chris"/><meta name="author" content="Christopher Besch"/><link rel="preload" href="/styles/fonts/LiberationSans-Regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous"/><link rel="preload" href="/styles/fonts/LiberationMono-Regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous"/><meta name="color-scheme" content="light dark"/><link rel="me" href="https://mastodon.social/@christopher_besch"/><meta name="fediverse:creator" content="@christopher_besch@mastodon.social"/><link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/></head><body><nav class="layout_navbar" role="navigation"><a class="layout_navbar_left" href="/"><h1>Christopher Besch</h1><h2>Developer•Writer•Photographer</h2></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></nav><div class="layout_transient_space"><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div><p>This is a transient space.</p></div><main class="layout_content_container" role="main"><div class="layout_hero" style="--layout-object-fit-h:20%;--layout-object-fit-v:40%;--layout-hero-fraction:0.7"><picture class="image_picture"><source srcSet="/images/88614c35096baae868e5bee70286469f_400_225.webp 400w,/images/88614c35096baae868e5bee70286469f_800_450.webp 800w,/images/88614c35096baae868e5bee70286469f_1200_675.webp 1200w,/images/88614c35096baae868e5bee70286469f_1600_900.webp 1600w" type="image/webp" width="400" height="225" media="(orientation: landscape)"/><source srcSet="/images/88614c35096baae868e5bee70286469f_20_400_533.webp 400w,/images/88614c35096baae868e5bee70286469f_20_600_800.webp 600w" type="image/webp" width="400" height="533" media="(orientation: portrait) and (max-width: 500px)"/><img srcSet="/images/88614c35096baae868e5bee70286469f_400_225.webp 400w,/images/88614c35096baae868e5bee70286469f_800_450.webp 800w,/images/88614c35096baae868e5bee70286469f_1200_675.webp 1200w,/images/88614c35096baae868e5bee70286469f_1600_900.webp 1600w" width="400" height="225" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #a3aab6, transparent),radial-gradient(67% 67% at 50% 25%, #afb6c2, transparent),radial-gradient(67% 67% at 75% 25%, #9fa7b3, transparent),radial-gradient(67% 67% at 25% 50%, #808384, transparent),radial-gradient(67% 67% at 50% 50%, #93938f, transparent),radial-gradient(67% 67% at 75% 50%, #8e8c86, transparent),radial-gradient(67% 67% at 25% 75%, #8b7042, transparent),radial-gradient(67% 67% at 50% 75%, #a68754, transparent),radial-gradient(67% 67% at 75% 75%, #a2834f, transparent),linear-gradient(#9b9385);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="eager" fetchPriority="high"/></picture><div class="layout_hero_children"><div class="title_in_hero"><h1>Real-Time Linux on RISC-V</h1><hr/><h2>Friday, 27th June, 2025</h2></div></div></div><div class="layout_content"><div class="article_page_markdown"><div class="markdown_body"><p>I got access to a StarFive VisionFive 2 and wanted to play around with Real-Time Linux on it.
This article goes into excruciating detail on how I set that machine up to with <code>PREEMPT_RT</code>.</p>
<p>The first mainline Kernel with PREEMPT_RT is v6.12.
At the time of writing v6.15 is the newest kernel and my Debian laptop runs on v6.1.0.
For the Debian user that I am v6.12 is pretty new.</p>
<p>So, how do we get this single board computer (SBC) to work and run on such a new kernel?
There is no StarFive Debian release with a Linux kernel v6.12 or newer.
So we need to make due with engineering release 202409 and kernel v6.6.20 and get to v6.12 later.
(That&#x27;s still newer than my Debian laptop...)</p>
<h1 id="installing-the-initial-image"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#installing-the-initial-image"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing the Initial Image</h1>
<p>I just stick to the <a href="https://rvspace.org/en/project/VisionFive2_Debian_User_Guide">official installation guide for Debian on the VisionFive 2</a>.
I chose to boot off of an SD card, pop it in my laptop and run:</p>
<pre><code class="language-bash">bzip2 -d starfive-jh7110-202409-SD-minimal-desktop-wayland.img.bz2
sudo dd if=starfive-jh7110-202409-SD-minimal-desktop-wayland.img of=/dev/sda conv=fsync bs=4M status=progress
</code></pre>
<p>Now we can insert the SD card into the SBC and watch it boot for the first time.</p>
<h1 id="uart"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#uart"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UART</h1>
<p>I have a USB to UART adapter attached to my laptop and the SBC.
After having added myself to the dialout group on my laptop I rebooted (a relogin would have done it as well):</p>
<pre><code class="language-bash">sudo usermod -a -G dialout chris
sudo reboot
</code></pre>
<p>Now I plug in the adapter to my laptop and check what tty adapter it is on:</p>
<pre><code class="language-bash">sudo dmesg
</code></pre>
<p>This should print something including the tty path.
I use this path to attach a terminal to that adapter.</p>
<pre><code class="language-bash">screen -U /dev/ttyUSB0 -b 115200
</code></pre>
<p>Exit with <code>Ctrl+a d</code>.</p>
<p>There is this magic of LEDs on a UART adapter blinking as you type.</p>
<h1 id="setting-up-networking"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#setting-up-networking"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up Networking</h1>
<p>Linux is running on the SBC but I&#x27;d like to have network access.
I have my Linux Laptop right here and want to share its network connection with the SBC.</p>
<h2 id="on-the-laptop"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#on-the-laptop"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>On the Laptop</h2>
<p>First we need to know what network cards we&#x27;re dealing with:</p>
<pre><code class="language-bash"><span class="pl-k">~</span> λ ip link
1: lo: <span class="pl-k">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: wlp1s0: <span class="pl-k">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 1500 qdisc noqueue state UP mode DORMANT group default qlen 1000
    link/ether 10:6f:d9:1e:4f:e1 brd ff:ff:ff:ff:ff:ff
3: enx00133bb15f5b: <span class="pl-k">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 00:13:3b:b1:5f:5b brd ff:ff:ff:ff:ff:ff<span class="pl-s"><span class="pl-pds">```</span></span>
</code></pre>
<p>As you can see I have three network cards, the loopback device (i.e. for localhost) my wifi card <code>wlp1s0</code> and a usb LAN adapter <code>enx00133bb15f5b</code>.</p>
<h3 id="nat-setup"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#nat-setup"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NAT Setup</h3>
<p>We need to setup NAT to forward packets meant for the SBC with the laptop.</p>
<pre><code class="language-bash">sudo sysctl -w net.ipv4.ip_forward=1
sudo iptables -t nat -A POSTROUTING -o wlp1s0 -j MASQUERADE
sudo iptables -A FORWARD -i enx00133bb15f5b -o wlp1s0 -j ACCEPT
sudo iptables -A FORWARD -i wlp1s0 -o enx00133bb15f5b -m state --state RELATED,ESTABLISHED -j ACCEPT
</code></pre>
<h3 id="ip-addresses"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#ip-addresses"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IP Addresses</h3>
<p>We want to assign a new IP address for the laptop to the <code>enx00133bb15f5b</code> link.</p>
<pre><code class="language-bash">sudo ip addr add 192.168.10.1/24 dev enx00133bb15f5b
sudo ip link <span class="pl-c1">set</span> enx00133bb15f5b up
</code></pre>
<p>I check that this worked with:</p>
<pre><code class="language-bash"><span class="pl-k">~</span> λ ip addr
1: lo: <span class="pl-k">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: wlp1s0: <span class="pl-k">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 10:6f:d9:1e:4f:e1 brd ff:ff:ff:ff:ff:ff
    inet 172.17.65.91/17 brd 172.17.127.255 scope global dynamic noprefixroute wlp1s0
       valid_lft 1694sec preferred_lft 1694sec
    inet6 2a00:1398:9:fb03:c786:4d2:ce2e:e30d/64 scope global dynamic noprefixroute
       valid_lft 2591999sec preferred_lft 604799sec
    inet6 fe80::cebf:38eb:9589:c3a0/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: enx00133bb15f5b: <span class="pl-k">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:13:3b:b1:5f:5b brd ff:ff:ff:ff:ff:ff
    inet 192.168.10.1/24 scope global enx00133bb15f5b
       valid_lft forever preferred_lft forever
</code></pre>
<p>The <code>enx00133bb15f5b</code> link has a new IP address (192.168.10.1) assigned to it.</p>
<h2 id="on-the-sbc"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#on-the-sbc"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>On the SBC</h2>
<pre><code class="language-bash">user@starfive:<span class="pl-k">~</span>$ ip link
1: lo: <span class="pl-k">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <span class="pl-k">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="pl-k">&gt;</span> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 6c:cf:39:00:49:50 brd ff:ff:ff:ff:ff:ff
    altname end0
3: eth1: <span class="pl-k">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="pl-k">&gt;</span> mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
    link/ether 6c:cf:39:00:49:51 brd ff:ff:ff:ff:ff:ff
    altname end1
4: sit0@NONE: <span class="pl-k">&lt;</span>NOARP<span class="pl-k">&gt;</span> mtu 1480 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/sit 0.0.0.0 brd 0.0.0.0
</code></pre>
<p>I have attached the LAN cable to the <code>eth0</code> network card.</p>
<pre><code class="language-bash">sudo ip addr add 192.168.10.2/24 dev eth0
sudo ip link <span class="pl-c1">set</span> eth0 up
sudo ip route add default via 192.168.10.1
</code></pre>
<p>With this we have added the ip <code>192.168.10.2</code> to the SBC&#x27;s <code>eth0</code> interface.
DHCP would have done that automatically but we didn&#x27;t setup a DHCP server on the laptop so we have to do this manually.</p>
<h3 id="dns"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#dns"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DNS</h3>
<pre><code class="language-bash">sudo vi /etc/resolv.conf
</code></pre>
<p>Add this line (we all like Google, don&#x27;t we?):</p>
<pre><code>nameserver 8.8.8.8
</code></pre>
<p>We don&#x27;t need the NetworkManager for this, btw.
Feel free to disable it:</p>
<pre><code class="language-bash">sudo systemctl disable --now NetworkManager
</code></pre>
<h3 id="lets-test-this"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#lets-test-this"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Let&#x27;s Test this</h3>
<pre><code class="language-bash"><span class="pl-c"># ping the laptop</span>
<span class="pl-c"># this tests the link works</span>
ping 192.168.10.1
<span class="pl-c"># ping google infrastructure without the DNS</span>
<span class="pl-c"># this tests the NAT works</span>
ping 8.8.8.8
<span class="pl-c"># ping google with DNS</span>
<span class="pl-c"># this tests that the DNS works</span>
ping google.com
</code></pre>
<p>This setup works most of the time.
Sometimes it&#x27;s a bit flaky.
I presume that&#x27;s because the NetworkManager on my laptop interferes but I&#x27;m not sure and can&#x27;t turn it off there.
I often have to run the commands multiple times until they stick.</p>
<h3 id="ssh"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#ssh"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SSH</h3>
<p>There already is an SSH server installed and running on the SBC.
All I have to do is connect to it from the host:</p>
<pre><code class="language-bash">ssh user@192.168.10.2
</code></pre>
<p>So much faster than UART, damn!
No blinking lights, though <code>:&lt;</code></p>
<h1 id="building-the-kernel"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#building-the-kernel"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building the Kernel</h1>
<p>Again we refer to the <a href="https://rvspace.org/en/project/VisionFive2_Debian_User_Guide#h-46-compiling-and-updating-linux-kernel">VisionFive 2 docs</a>.</p>
<pre><code class="language-bash">sudo apt-get -y install build-essential linux-source bc kmod cpio flex libncurses5-dev libelf-dev libssl-dev dwarves bison git debhelper
git clone --depth 1 --single-branch --branch JH7110_VisionFive2_6.12.y_devel https://github.com/starfive-tech/linux
<span class="pl-c1">cd</span> linux
cp arch/riscv/configs/starfive_visionfive2_defconfig .config
make ARCH=riscv olddefconfig
</code></pre>
<p>Now we need to configure PREEMPT_RT:</p>
<pre><code class="language-bash">make ARCH=riscv menuconfig
</code></pre>
<div class="half_image_image"><div class="half_element_wrapper"><div class="half_element_before"></div><div class="half_element_element"><picture class="image_picture"><img srcSet="/images/40cb935b352cfe11fd4bd766efb72599_400_217.webp 400w,/images/40cb935b352cfe11fd4bd766efb72599_800_434.webp 800w,/images/40cb935b352cfe11fd4bd766efb72599_1200_651.webp 1200w,/images/40cb935b352cfe11fd4bd766efb72599_1600_868.webp 1600w" width="400" height="217" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #7ca7cb, transparent),radial-gradient(67% 67% at 50% 25%, #9fb4c8, transparent),radial-gradient(67% 67% at 75% 25%, #78a0c4, transparent),radial-gradient(67% 67% at 25% 50%, #b1c5d6, transparent),radial-gradient(67% 67% at 50% 50%, #d7d6d4, transparent),radial-gradient(67% 67% at 75% 50%, #afbcc9, transparent),radial-gradient(67% 67% at 25% 75%, #759cbf, transparent),radial-gradient(67% 67% at 50% 75%, #91a5b8, transparent),radial-gradient(67% 67% at 75% 75%, #7394b1, transparent),linear-gradient(#84a7c4);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture></div><div class="half_element_after"></div></div></div>
<p>In this menu screen we select <strong>Scheduler controlled preemption model</strong> mode under <strong>General setup</strong> then <strong>Preemption Model</strong>.
In my case I also had to set this in the <code>.config</code> file in order to differentiate this kernel from a <code>PREEMPT_DYNAMIC</code> build I also created.</p>
<pre><code>CONFIG_LOCALVERSION=&quot;preempt-rt&quot;
</code></pre>
<p>Back to the documentation and we start the compilation:</p>
<pre><code class="language-bash">make ARCH=riscv -j<span class="pl-s"><span class="pl-pds">$(</span>nproc<span class="pl-pds">)</span></span> bindeb-pkg
<span class="pl-c"># for me the .deb files ended up being in the $HOME directory</span>
<span class="pl-c1">cd</span> ..
sudo dpkg -i \
    linux-headers-6.12.5<span class="pl-k">*</span>_riscv64.deb \
    linux-image-6.12.5<span class="pl-k">*</span>_riscv64.deb \
    linux-libc-dev_6.12.5<span class="pl-k">*</span>_riscv64.deb
</code></pre>
<p>When doing so more than once, I had to uninstall an old kernel; probably because there isn&#x27;t enough space for the rgx firmware on initrd but I&#x27;m really not sure.</p>
<p>This takes a while — some time to do the toilet, nice.
Still not done?
Then I have some time to write this article, also nice.
Maybe I should&#x27;ve crosscompiled on my laptop.
Compiling the Linux kernel on a computer that doesn&#x27;t even have a heat-sink is something...
That took roughly an hour.</p>
<p>Some notes:
The documentation warns about the dtbs not being synced but for me they were, so I left that as is and rebooted.
Installing <code>debhelper</code> was missing in the documentation.</p>
<h2 id="dealing-with-multiple-kernels"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#dealing-with-multiple-kernels"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dealing with Multiple Kernels</h2>
<p>I ended up having two v6.12.5 kernels installed: a <code>PREEMPT_RT</code> and a <code>PREEMPT_DYNAMIC</code> one.
To choose which one to boot I edited <code>/boot/extlinux/extlinux.conf</code>.
It has such a nice warning not to edit it.
Here I just renamed the <code>l0</code> and <code>l0r</code> labels to <code>l1</code> and <code>l1r</code> and the other way around.
I also rearranged the labels to be a little nicer; I have no idea if that was needed.</p>
<p>I did try using a <em>proper</em> method of changing the kernel to boot but this was the only thing I came up with and it works.
I left the <code>l2</code> and <code>l2r</code> labels in case I screwed something up.</p>
<pre><code class="language-bash">sudo vi /boot/extlinux/extlinux.conf
</code></pre>
<pre><code>## /extlinux/extlinux.conf
##
## IMPORTANT WARNING
##
## The configuration of this file is generated automatically.
## Do not edit this file manually, use: u-boot-update

default l0
menu title U-Boot menu
prompt 0
timeout 50

label l0
        menu label Debian GNU/Linux trixie/sid 6.12.5preempt-rt+
        linux /vmlinuz-6.12.5preempt-rt+
        initrd /initrd.img-6.12.5preempt-rt+
        fdtdir /dtbs/6.12.5preempt-rt+

        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0

label l0r
        menu label Debian GNU/Linux trixie/sid 6.12.5preempt-rt+ (rescue target)
        linux /vmlinuz-6.12.5preempt-rt+
        initrd /initrd.img-6.12.5preempt-rt+
        fdtdir /dtbs/6.12.5preempt-rt+
        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single

label l1
        menu label Debian GNU/Linux trixie/sid 6.12.5+
        linux /vmlinuz-6.12.5+
        initrd /initrd.img-6.12.5+
        fdtdir /dtbs/6.12.5+

        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0

label l1r
        menu label Debian GNU/Linux trixie/sid 6.12.5+ (rescue target)
        linux /vmlinuz-6.12.5+
        initrd /initrd.img-6.12.5+
        fdtdir /dtbs/6.12.5+
        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single

label l2
        menu label Debian GNU/Linux trixie/sid 6.6.20-starfive
        linux /vmlinuz-6.6.20-starfive
        initrd /initrd.img-6.6.20-starfive
        fdtdir /dtbs/6.6.20-starfive

        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0

label l2r
        menu label Debian GNU/Linux trixie/sid 6.6.20-starfive (rescue target)
        linux /vmlinuz-6.6.20-starfive
        initrd /initrd.img-6.6.20-starfive
        fdtdir /dtbs/6.6.20-starfive
        append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single
</code></pre>
<h1 id="testing"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#testing"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h1>
<p>Now we can do some testing of our real-time performance with cyclictest:</p>
<pre><code class="language-bash">sudo apt install rt-tests stress-ng
sudo <span class="pl-c1">echo</span> performance <span class="pl-k">&gt;</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
<span class="pl-c"># cpu</span>
stress-ng --matrix 4
<span class="pl-c"># mem</span>
stress-ng --vm 4
sudo cyclictest --mlockall --smp --priority=99 --interval=200 --quiet --duration=10m --histofall=200 <span class="pl-k">&gt;</span> out.txt
</code></pre>
<h1 id="some-ideas-for-further-investigation"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#some-ideas-for-further-investigation"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Some Ideas for Further Investigation</h1>
<ul>
<li>disable <code>CONFIG_NO_HZ_IDLE</code></li>
<li>use <code>CONFIG_HZ_1000</code> instead of <code>CONFIG_HZ_100</code></li>
</ul>
<h1 id="other-things"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#other-things"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other Things</h1>
<p>To get my custom configs to work I had to edit my <code>.bash_profile</code>: <a href="https://unix.stackexchange.com/questions/94490/bash-doesnt-read-bashrc-unless-manually-started">unix.stackexchange.com/questions/94490/bash-doesnt-read-bashrc-unless-manually-started</a></p><div class="markdown_spacer"></div></div></div><div class="title_in_text"><h1>Other Articles</h1><hr/></div><div class="cards_list"><a class="cards_list_card" href="/articles/grub_install_removable"><picture class="image_picture"><img srcSet="/images/5c5afcd8efd6183c56c8c807a694a48f_400_200.webp 400w,/images/5c5afcd8efd6183c56c8c807a694a48f_800_400.webp 800w,/images/5c5afcd8efd6183c56c8c807a694a48f_1200_600.webp 1200w,/images/5c5afcd8efd6183c56c8c807a694a48f_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #1312a8, transparent),radial-gradient(67% 67% at 50% 25%, #5d5ca4, transparent),radial-gradient(67% 67% at 75% 25%, #1514a8, transparent),radial-gradient(67% 67% at 25% 50%, #423d9a, transparent),radial-gradient(67% 67% at 50% 50%, #bdb294, transparent),radial-gradient(67% 67% at 75% 50%, #453f9c, transparent),radial-gradient(67% 67% at 25% 75%, #1111a5, transparent),radial-gradient(67% 67% at 50% 75%, #575497, transparent),radial-gradient(67% 67% at 75% 75%, #1413a5, transparent),linear-gradient(#3c39a1);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>grub-install --removable for buggy UEFI</h1><h2>Friday, 8th November, 2024</h2><hr/><p>Install Debian on a device with a broken NVRAM.</p></a><a class="cards_list_card" href="/articles/installing_gentoo"><picture class="image_picture"><img srcSet="/images/dd509c81379268c048ef45318173ad70_400_200.webp 400w,/images/dd509c81379268c048ef45318173ad70_800_400.webp 800w,/images/dd509c81379268c048ef45318173ad70_1200_600.webp 1200w,/images/dd509c81379268c048ef45318173ad70_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #231d24, transparent),radial-gradient(67% 67% at 50% 25%, #040604, transparent),radial-gradient(67% 67% at 75% 25%, #0c1d0a, transparent),radial-gradient(67% 67% at 25% 50%, #191518, transparent),radial-gradient(67% 67% at 50% 50%, #0c100d, transparent),radial-gradient(67% 67% at 75% 50%, #0a1b08, transparent),radial-gradient(67% 67% at 25% 75%, #010101, transparent),radial-gradient(67% 67% at 50% 75%, #020601, transparent),radial-gradient(67% 67% at 75% 75%, #0d1f0b, transparent),linear-gradient(#0e130d);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>Installing Gentoo To My Liking</h1><h2>Tuesday, 26th April, 2022</h2><hr/><p>Gentoo is a Linux distribution that offers as many options as possible. This article leads you through the decisions I took to end up with a system that best suits my needs.</p></a><a class="cards_list_card" href="/articles/revealjs"><picture class="image_picture"><img srcSet="/images/90f1af0c0e4970e8cf923a375c719169_400_200.webp 400w,/images/90f1af0c0e4970e8cf923a375c719169_800_400.webp 800w,/images/90f1af0c0e4970e8cf923a375c719169_1200_600.webp 1200w,/images/90f1af0c0e4970e8cf923a375c719169_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #313131, transparent),radial-gradient(67% 67% at 50% 25%, #2d2d2d, transparent),radial-gradient(67% 67% at 75% 25%, #323232, transparent),radial-gradient(67% 67% at 25% 50%, #4a4a4a, transparent),radial-gradient(67% 67% at 50% 50%, #686868, transparent),radial-gradient(67% 67% at 75% 50%, #4d4d4c, transparent),radial-gradient(67% 67% at 25% 75%, #2e2e2e, transparent),radial-gradient(67% 67% at 50% 75%, #2e2e2e, transparent),radial-gradient(67% 67% at 75% 75%, #343434, transparent),linear-gradient(#3b3b3b);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>reveal.js your Presentation</h1><h2>Friday, 24th June, 2022</h2><hr/><p>reveal.js is a PowerPoint alternative. With it you programmatically define your presentation via HTML.
This article shows how you can use reveal.js for your own presentation.</p></a><a class="cards_list_card" href="/articles/bash_cmds/mp3_tag"><picture class="image_picture"><img srcSet="/images/5c491b010e8b22c6ffd20605f69d322f_400_200.webp 400w,/images/5c491b010e8b22c6ffd20605f69d322f_800_400.webp 800w,/images/5c491b010e8b22c6ffd20605f69d322f_1200_600.webp 1200w,/images/5c491b010e8b22c6ffd20605f69d322f_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #132011, transparent),radial-gradient(67% 67% at 50% 25%, #182416, transparent),radial-gradient(67% 67% at 75% 25%, #1b1c1b, transparent),radial-gradient(67% 67% at 25% 50%, #1b191b, transparent),radial-gradient(67% 67% at 50% 50%, #1c1a1c, transparent),radial-gradient(67% 67% at 75% 50%, #181818, transparent),radial-gradient(67% 67% at 25% 75%, #1f1f1f, transparent),radial-gradient(67% 67% at 50% 75%, #1e1e1e, transparent),radial-gradient(67% 67% at 75% 75%, #111111, transparent),linear-gradient(#191c19);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>Bodging MP3 Names in Bash</h1><h2>Wednesday, 12th October, 2022</h2><hr/><p>Why do it complicated when a Bash one-liner does it too?</p></a></div><a href="/articles" class="button">Furthermore Articles</a></div></main><footer class="layout_footer" role="contentinfo"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/articles/privacy">Privacy</a><div>© 2025 | All rights reserved</div></footer></body></html>