<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>grub-install --removable for buggy UEFI</title><meta name="description" content=" Install Debian on a device with a broken NVRAM. "/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/></head><body><div class="layout_navbar"><a class="layout_navbar_left" href="/"><h1>Christopher Besch</h1><h2>Developer•Writer•Photographer</h2></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></div><div class="layout_transient_space"><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div><p>This is a transient space.</p></div><div class="layout_content_container"><div class="layout_content"><div class="markdown_body"><p>On my quest of ridding my family from Windows I was faced with a particularly interesting Debian 12 installation.
What&#x27;s so <em>interesting</em> about this one?</p>
<p>Apart from the dog slow HDD the Debian installer chugs along just fine—until...<code>grub-install dummy</code>.
It doesn&#x27;t fail, it just hangs.</p>
<p>Maybe get some cake and check on it afterwards...
No, still hanging there.
Battery-disconnect it is—click.</p>
<p>Reboot, hit up the live-USB&#x27;s shell and see what the hell happened.
Let&#x27;s chroot into the broken install:</p>
<pre><code class="language-bash"><span class="pl-c"># from: https://unix.stackexchange.com/questions/541489/grub-fails-to-install-during-debian-10-installer-re-uefi-supermicro-motherboa</span>
mkdir /target
mount /dev/sdX2 /target
mount /dev/sdX1 /target/boot/efi
mount -o rbind /dev /target/dev 
mount -t proc proc /target/proc 
mount -t sysfs sys /target/sys 
mount -t efivarfs efivarfs /target/sys/firmware/efi/efivars 
chroot /target/ 
</code></pre>
<p>Everything looks fine so let&#x27;s fix that GRUB2 installation.</p>
<pre><code class="language-bash">grub-install --verbose /dev/sdX
</code></pre>
<p>And...drum roll...it hangs—at trying to <code>modprobe efivars</code>.
Huh, why&#x27;s that?</p>
<p>Let&#x27;s try something:</p>
<pre><code>grub-install --verbose --no-nvram /dev/sdX
</code></pre>
<p>And...it works—in that it finishes without errors.
But now the laptop fails to find the new Debian installation and only let&#x27;s me boot back into the live-USB.</p>
<p>With the <code>--no-nvram</code> option we at least get through the GRUB2 installation.
It appears the cheapo laptop&#x27;s UEFI is bugged causing Linux trouble with editing the motherboard&#x27;s NVRAM.
Cool, why is that bad?</p>
<p><code>grub-install</code> wants to make the UEFI aware of the new bootloader.
It does so by storing the bootloader&#x27;s location in non-volatile RAM of the motherboard.
Then your shiny-new bootloader appears in the UEFI boot options and you can boot.</p>
<p>That doesn&#x27;t work here, so what now?</p>
<h2 id="--removable-to-the-rescue"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#--removable-to-the-rescue"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>--removable</code> to the Rescue</h2>
<p>Thing is, not all installation can rely on the NVRAM—for example a live-USB.
When plugging in a live-USB the UEFI needs to be able to boot from it even though it has never seen it before.
That&#x27;s what the fallback bootloader path (<code>EFI/boot/bootx64.efi</code>) is for.
The UEFI doesn&#x27;t just look in it&#x27;s NVRAM for bootloaders but also checks that path on all attached drives.</p>
<p>So let&#x27;s do that instead:</p>
<pre><code class="language-bash">grub-install --removable /dev/sdX
grub-update
</code></pre>
<p>And after a reboot we&#x27;re greeted with the GRUB2 shell.
Whoho!
Progress!
The GRUB2 shell is nice, but we need more.
Apparently GRUB2 is missing something so let&#x27;s again check with the live-USB.
Reboot, chroot and run:</p>
<pre><code class="language-bash">apt-get install grub-efi-amd64
</code></pre>
<p>So the installation was interrupted—makes sense I did disconnect the battery.
Let&#x27;s fix that:</p>
<pre><code class="language-bash"><span class="pl-c"># from: https://askubuntu.com/questions/425502/how-do-i-continue-configuration-if-apt-get-was-interrupted</span>
apt-get clean
apt-get -f install
dpkg-reconfigure -a
</code></pre>
<p>Now GRUB2 installs correctly and appears to remember my wish to use <code>--removable</code>.
Reboot and we actually boot into the new Debian installation.
We just can&#x27;t login yet because there&#x27;s something missing still.</p>
<h2 id="finishing-the-installation"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#finishing-the-installation"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finishing the Installation</h2>
<p>As we interrupted the Debian installer there&#x27;s one step left to do, the &quot;Finish the installation&quot; step.
It appears the user is created by this step so skipping it leaves us without a user to login with.
Fix that with:</p>
<pre><code class="language-bash">useradd my_user
useradd sudo my_user
useradd netdev my_user
</code></pre>
<p>I also had to <a href="https://askubuntu.com/questions/71159/network-manager-says-device-not-managed">set the network to managed</a> and remove the live-USB package repository from <code>/etc/apt/sources.list</code>.</p>
<p>If I had to do this again, I&#x27;d use the expert install mode and simply skip the automated GRUB2 installation step.
That should allow me to run the original &quot;Finish the installation&quot; step before installing GRUB2 manually.</p>
<p>PS: The cheapo laptop was an Acer Aspire es 17 (aspire es1-732).</p><div class="markdown_spacer"></div></div></div></div><div class="layout_footer"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/privacy">Privacy</a><div>© 2025 | All rights reserved</div></div></body></html>