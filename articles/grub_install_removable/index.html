<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>grub-install --removable for buggy UEFI</title><meta name="description" content=" Install Debian on a device with a broken NVRAM. "/><link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/></head><body><div class="layout_navbar"><a class="layout_navbar_left" href="/"><h1>Christopher Besch</h1><h2>Developer•Writer•Photographer</h2></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></div><div class="layout_transient_space"><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div><p>This is a transient space.</p></div><div class="layout_content_container"><div class="layout_hero" style="--layout-object-fit-h:40%;--layout-object-fit-v:60%;--layout-hero-fraction:0.7"><picture class="image_picture"><source srcSet="/images/1b10ddadbd8493dd34ecb82578bb460f_400_266.webp 400w,/images/1b10ddadbd8493dd34ecb82578bb460f_800_533.webp 800w,/images/1b10ddadbd8493dd34ecb82578bb460f_1200_800.webp 1200w,/images/1b10ddadbd8493dd34ecb82578bb460f_1600_1066.webp 1600w" type="image/webp" width="400" height="266" media="(orientation: landscape)"/><source srcSet="/images/1b10ddadbd8493dd34ecb82578bb460f_40_400_533.webp 400w,/images/1b10ddadbd8493dd34ecb82578bb460f_40_600_800.webp 600w" type="image/webp" width="400" height="533" media="(orientation: portrait) and (max-width: 500px)"/><img srcSet="/images/1b10ddadbd8493dd34ecb82578bb460f_400_266.webp 400w,/images/1b10ddadbd8493dd34ecb82578bb460f_800_533.webp 800w,/images/1b10ddadbd8493dd34ecb82578bb460f_1200_800.webp 1200w,/images/1b10ddadbd8493dd34ecb82578bb460f_1600_1066.webp 1600w" width="400" height="266" style="background-image:radial-gradient(67% 67% at 25% 25%, #9fb7ca, transparent),radial-gradient(67% 67% at 50% 25%, #90a2ae, transparent),radial-gradient(67% 67% at 75% 25%, #8a979e, transparent),radial-gradient(67% 67% at 25% 50%, #92918e, transparent),radial-gradient(67% 67% at 50% 50%, #8e8983, transparent),radial-gradient(67% 67% at 75% 50%, #857c71, transparent),radial-gradient(67% 67% at 25% 75%, #75674a, transparent),radial-gradient(67% 67% at 50% 75%, #7d6e51, transparent),radial-gradient(67% 67% at 75% 75%, #7a6a4e, transparent),linear-gradient(#898981);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="eager"/></picture><div class="layout_hero_children"><div class="title_in_hero"><h1>grub-install --removable for buggy UEFI</h1><hr/><h2>Friday, 8th November, 2024</h2></div></div></div><div class="layout_content"><div class="article_page_markdown"><div class="markdown_body"><p>On my quest of ridding my family from Windows I was faced with a particularly interesting Debian 12 installation.
What&#x27;s so <em>interesting</em> about this one?</p>
<p>Apart from the dog slow HDD the Debian installer chugs along just fine—until...<code>grub-install dummy</code>.
It doesn&#x27;t fail, it just hangs.</p>
<p>Maybe get some cake and check on it afterwards...
No, still hanging there.
Battery-disconnect it is—click.</p>
<p>Reboot, hit up the live-USB&#x27;s shell and see what the hell happened.
Let&#x27;s chroot into the broken install:</p>
<pre><code class="language-bash"><span class="pl-c"># from: https://unix.stackexchange.com/questions/541489/grub-fails-to-install-during-debian-10-installer-re-uefi-supermicro-motherboa</span>
mkdir /target
mount /dev/sdX2 /target
mount /dev/sdX1 /target/boot/efi
mount -o rbind /dev /target/dev 
mount -t proc proc /target/proc 
mount -t sysfs sys /target/sys 
mount -t efivarfs efivarfs /target/sys/firmware/efi/efivars 
chroot /target/ 
</code></pre>
<p>Everything looks fine so let&#x27;s fix that GRUB2 installation.</p>
<pre><code class="language-bash">grub-install --verbose /dev/sdX
</code></pre>
<p>And...drum roll...it hangs—at trying to <code>modprobe efivars</code>.
Huh, why&#x27;s that?</p>
<p>Let&#x27;s try something:</p>
<pre><code>grub-install --verbose --no-nvram /dev/sdX
</code></pre>
<p>And...it works—in that it finishes without errors.
But now the laptop fails to find the new Debian installation and only let&#x27;s me boot back into the live-USB.</p>
<p>With the <code>--no-nvram</code> option we at least get through the GRUB2 installation.
It appears the cheapo laptop&#x27;s UEFI is bugged causing Linux trouble with editing the motherboard&#x27;s NVRAM.
Cool, why is that bad?</p>
<p><code>grub-install</code> wants to make the UEFI aware of the new bootloader.
It does so by storing the bootloader&#x27;s location in non-volatile RAM of the motherboard.
Then your shiny-new bootloader appears in the UEFI boot options and you can boot.</p>
<p>That doesn&#x27;t work here, so what now?</p>
<h2 id="--removable-to-the-rescue"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#--removable-to-the-rescue"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>--removable</code> to the Rescue</h2>
<p>Thing is, not all installation can rely on the NVRAM—for example a live-USB.
When plugging in a live-USB the UEFI needs to be able to boot from it even though it has never seen it before.
That&#x27;s what the fallback bootloader path (<code>EFI/boot/bootx64.efi</code>) is for.
The UEFI doesn&#x27;t just look in it&#x27;s NVRAM for bootloaders but also checks that path on all attached drives.</p>
<p>So let&#x27;s do that instead:</p>
<pre><code class="language-bash">grub-install --removable /dev/sdX
grub-update
</code></pre>
<p>And after a reboot we&#x27;re greeted with the GRUB2 shell.
Whoho!
Progress!
The GRUB2 shell is nice, but we need more.
Apparently GRUB2 is missing something so let&#x27;s again check with the live-USB.
Reboot, chroot and run:</p>
<pre><code class="language-bash">apt-get install grub-efi-amd64
</code></pre>
<p>So the installation was interrupted—makes sense I did disconnect the battery.
Let&#x27;s fix that:</p>
<pre><code class="language-bash"><span class="pl-c"># from: https://askubuntu.com/questions/425502/how-do-i-continue-configuration-if-apt-get-was-interrupted</span>
apt-get clean
apt-get -f install
dpkg-reconfigure -a
</code></pre>
<p>Now GRUB2 installs correctly and appears to remember my wish to use <code>--removable</code>.
Reboot and we actually boot into the new Debian installation.
We just can&#x27;t login yet because there&#x27;s something missing still.</p>
<h2 id="finishing-the-installation"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#finishing-the-installation"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finishing the Installation</h2>
<p>As we interrupted the Debian installer there&#x27;s one step left to do, the &quot;Finish the installation&quot; step.
It appears the user is created by this step so skipping it leaves us without a user to login with.
Fix that with:</p>
<pre><code class="language-bash">useradd my_user
useradd sudo my_user
useradd netdev my_user
</code></pre>
<p>I also had to <a href="https://askubuntu.com/questions/71159/network-manager-says-device-not-managed">set the network to managed</a> and remove the live-USB package repository from <code>/etc/apt/sources.list</code>.</p>
<p>If I had to do this again, I&#x27;d use the expert install mode and simply skip the automated GRUB2 installation step.
That should allow me to run the original &quot;Finish the installation&quot; step before installing GRUB2 manually.</p>
<p>PS: The cheapo laptop was an Acer Aspire es 17 (aspire es1-732).</p><div class="markdown_spacer"></div></div></div><div class="title_in_text"><h1>Other Articles</h1><hr/></div><div class="articles_list"><a class="articles_list_card" href="/articles/riscv_rt"><picture class="image_picture"><img srcSet="/images/e85afd024262b6186553d361a5908877_400_200.webp 400w,/images/e85afd024262b6186553d361a5908877_800_400.webp 800w,/images/e85afd024262b6186553d361a5908877_1200_600.webp 1200w,/images/e85afd024262b6186553d361a5908877_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #cfcfd0, transparent),radial-gradient(67% 67% at 50% 25%, #c6cace, transparent),radial-gradient(67% 67% at 75% 25%, #cecdcd, transparent),radial-gradient(67% 67% at 25% 50%, #c4c7ca, transparent),radial-gradient(67% 67% at 50% 50%, #c1c2c4, transparent),radial-gradient(67% 67% at 75% 50%, #c7c9cb, transparent),radial-gradient(67% 67% at 25% 75%, #afc2d2, transparent),radial-gradient(67% 67% at 50% 75%, #a5bbd0, transparent),radial-gradient(67% 67% at 75% 75%, #b6c6d3, transparent),linear-gradient(#c0c8cf);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Real-Time Linux on RISC-V</h1><h2>Friday, 27th June, 2025</h2><hr/><p> Setting up Linux v6.12 on a StarFive VisionFive 2 with PREEMPT_RT.
Also: How to setup your Linux laptop as a simple NAT router. </p></a><a class="articles_list_card" href="/articles/installing_gentoo"><picture class="image_picture"><img srcSet="/images/dd509c81379268c048ef45318173ad70_400_200.webp 400w,/images/dd509c81379268c048ef45318173ad70_800_400.webp 800w,/images/dd509c81379268c048ef45318173ad70_1200_600.webp 1200w,/images/dd509c81379268c048ef45318173ad70_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #231d24, transparent),radial-gradient(67% 67% at 50% 25%, #040604, transparent),radial-gradient(67% 67% at 75% 25%, #0c1d0a, transparent),radial-gradient(67% 67% at 25% 50%, #191518, transparent),radial-gradient(67% 67% at 50% 50%, #0c100d, transparent),radial-gradient(67% 67% at 75% 50%, #0a1b08, transparent),radial-gradient(67% 67% at 25% 75%, #010101, transparent),radial-gradient(67% 67% at 50% 75%, #020601, transparent),radial-gradient(67% 67% at 75% 75%, #0d1f0b, transparent),linear-gradient(#0e130d);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Installing Gentoo To My Liking</h1><h2>Tuesday, 26th April, 2022</h2><hr/><p> Gentoo is a Linux distribution that offers as many options as possible. This article leads you through the decisions I took to end up with a system that best suits my needs. </p></a><a class="articles_list_card" href="/articles/bash_cmds/mp3_tag"><picture class="image_picture"><img srcSet="/images/5c491b010e8b22c6ffd20605f69d322f_400_200.webp 400w,/images/5c491b010e8b22c6ffd20605f69d322f_800_400.webp 800w,/images/5c491b010e8b22c6ffd20605f69d322f_1200_600.webp 1200w,/images/5c491b010e8b22c6ffd20605f69d322f_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #132011, transparent),radial-gradient(67% 67% at 50% 25%, #182416, transparent),radial-gradient(67% 67% at 75% 25%, #1b1c1b, transparent),radial-gradient(67% 67% at 25% 50%, #1b191b, transparent),radial-gradient(67% 67% at 50% 50%, #1c1a1c, transparent),radial-gradient(67% 67% at 75% 50%, #181818, transparent),radial-gradient(67% 67% at 25% 75%, #1f1f1f, transparent),radial-gradient(67% 67% at 50% 75%, #1e1e1e, transparent),radial-gradient(67% 67% at 75% 75%, #111111, transparent),linear-gradient(#191c19);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Bodging MP3 Names in Bash</h1><h2>Wednesday, 12th October, 2022</h2><hr/><p> Why do it complicated when a Bash one-liner does it too? </p></a><a class="articles_list_card" href="/articles/svg_fonts_with_sed"><picture class="image_picture"><img srcSet="/images/f59a7f43e2f2a641d46f9fd994b5589c_400_200.webp 400w,/images/f59a7f43e2f2a641d46f9fd994b5589c_800_400.webp 800w,/images/f59a7f43e2f2a641d46f9fd994b5589c_1200_600.webp 1200w,/images/f59a7f43e2f2a641d46f9fd994b5589c_1280_640.webp 1280w" width="400" height="200" style="background-image:radial-gradient(67% 67% at 25% 25%, #f5f6f6, transparent),radial-gradient(67% 67% at 50% 25%, #d6dbdf, transparent),radial-gradient(67% 67% at 75% 25%, #dadfe4, transparent),radial-gradient(67% 67% at 25% 50%, #b6b8ae, transparent),radial-gradient(67% 67% at 50% 50%, #614349, transparent),radial-gradient(67% 67% at 75% 50%, #604c4d, transparent),radial-gradient(67% 67% at 25% 75%, #d3d6c9, transparent),radial-gradient(67% 67% at 50% 75%, #bca298, transparent),radial-gradient(67% 67% at 75% 75%, #8b756c, transparent),linear-gradient(#b4aca9);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat"/></picture><h1>Inject Fonts into Web SVGs with sed</h1><h2>Monday, 10th February, 2025</h2><hr/><p> Add font-loading CSS to SVGs with a sed script. </p></a></div><a href="/articles" class="button">Furthermore Articles</a></div></div><div class="layout_footer"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/articles/privacy">Privacy</a><div>© 2025 | All rights reserved</div></div></body></html>