<!DOCTYPE html><html lang="en"><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Forgejo Actions Notification Development</title><link rel="canonical" href="https://chris-besch.com/articles/forgejo_actions_notification"/><meta property="og:title" content="Forgejo Actions Notification Development"/><meta property="twitter:title" content="Forgejo Actions Notification Development"/><meta name="description" content="Some stories of how I work on Forgejo. How is a Go project structured? What&#x27;s the point of Forgejo&#x27;s layered architecture and what&#x27;s that pub-sub pattern? Additionally, I exhaustively explain how to setup a development environment for Forgejo."/><meta property="og:description" content="Some stories of how I work on Forgejo. How is a Go project structured? What&#x27;s the point of Forgejo&#x27;s layered architecture and what&#x27;s that pub-sub pattern? Additionally, I exhaustively explain how to setup a development environment for Forgejo."/><meta property="twitter:description" content="Some stories of how I work on Forgejo. How is a Go project structured? What&#x27;s the point of Forgejo&#x27;s layered architecture and what&#x27;s that pub-sub pattern? Additionally, I exhaustively explain how to setup a development environment for Forgejo."/><meta property="og:type" content="article"/><meta property="og:url" content="https://chris-besch.com/articles/forgejo_actions_notification"/><meta property="og:site_name" content="Chris&#x27; Place"/><meta property="og:image" content="https://chris-besch.com/images/75e7dd6865f7b8d52489a1f1368ebbef_1200_600.webp"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content=""/><meta property="og:image" content="https://chris-besch.com/images/75e7dd6865f7b8d52489a1f1368ebbef_800_400.webp"/><meta property="og:image:width" content="800"/><meta property="og:image:height" content="400"/><meta property="og:image:alt" content=""/><meta property="og:image" content="https://chris-besch.com/images/75e7dd6865f7b8d52489a1f1368ebbef_400_200.webp"/><meta property="og:image:width" content="400"/><meta property="og:image:height" content="200"/><meta property="og:image:alt" content=""/><meta property="twitter:image" content="https://chris-besch.com/images/75e7dd6865f7b8d52489a1f1368ebbef_1200_600.webp"/><meta name="twitter:card" content="summary_large_image"/><meta name="og:article:published_time" content="2025-11-20T00:00:00.000Z"/><meta name="og:article:author" content="Christopher Besch"/><meta name="twitter:site" content="@besch_chris"/><meta name="twitter:creator" content="@besch_chris"/><meta name="author" content="Christopher Besch"/><link rel="preload" href="/styles/fonts/LiberationSans-Regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous"/><link rel="preload" href="/styles/fonts/LiberationMono-Regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous"/><meta name="color-scheme" content="light dark"/><link rel="me" href="https://mastodon.social/@christopher_besch"/><meta name="fediverse:creator" content="@christopher_besch@mastodon.social"/><link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"/><link rel="stylesheet" type="text/css" href="/styles/always.css"/><link rel="stylesheet" type="text/css" href="/styles/article.css"/><script defer="" src="https://analytics.chris-besch.com/script.js" data-website-id="0774a88d-dde9-4972-8559-84538b09a044"></script></head><body><nav class="layout_navbar" role="navigation"><a class="layout_navbar_left" href="/"><div><h1>Christopher Besch</h1><h2>Developer•Photographer</h2></div><picture class="image_picture"><img srcSet="/images/d806fbc6a3c117ec3cde9f83e2894a00_400_188.webp 400w,/images/d806fbc6a3c117ec3cde9f83e2894a00_699_329.webp 699w" width="400" height="188" alt="" loading="eager" fetchPriority="high"/></picture></a><div class="layout_navbar_right"><input id="layout_navbar_toggle" type="checkbox"/><label for="layout_navbar_toggle" class="layout_navbar_hamburger"><div></div><div></div><div></div></label><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div></nav><div class="layout_transient_space"><a href="/"><picture class="image_picture"><img srcSet="/images/d806fbc6a3c117ec3cde9f83e2894a00_400_188.webp 400w,/images/d806fbc6a3c117ec3cde9f83e2894a00_699_329.webp 699w" width="400" height="188" alt="" loading="eager" fetchPriority="high"/></picture></a><div class="layout_nav_links"><a href="/articles">Articles</a><a href="/photography">Photos</a><a href="/projects">Projects</a><a href="/talks">Talks</a><a href="/articles/bookmarks">Bookmarks</a><a href="/about">About</a></div></div><main class="layout_content_container" role="main"><div class="layout_hero" style="--layout-object-fit-h:85%;--layout-object-fit-v:60%;--layout-hero-fraction:0.7"><picture class="image_picture"><source srcSet="/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_400_266.webp 400w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_800_533.webp 800w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_1200_800.webp 1200w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_1600_1067.webp 1600w" type="image/webp" width="400" height="266" media="(orientation: landscape)"/><source srcSet="/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_85_400_533.webp 400w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_85_600_800.webp 600w" type="image/webp" width="400" height="533" media="(orientation: portrait) and (max-width: 500px)"/><img srcSet="/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_400_266.webp 400w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_800_533.webp 800w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_1200_800.webp 1200w,/images/a9a8c9fc0f076c43fdaed1d7ea3a47c6_1600_1067.webp 1600w" width="400" height="266" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #b88c4f, transparent),radial-gradient(67% 67% at 50% 25%, #c5995c, transparent),radial-gradient(67% 67% at 75% 25%, #dfad6d, transparent),radial-gradient(67% 67% at 25% 50%, #895e26, transparent),radial-gradient(67% 67% at 50% 50%, #bd7d30, transparent),radial-gradient(67% 67% at 75% 50%, #cc8739, transparent),radial-gradient(67% 67% at 25% 75%, #1b140d, transparent),radial-gradient(67% 67% at 50% 75%, #523d25, transparent),radial-gradient(67% 67% at 75% 75%, #503b23, transparent),linear-gradient(#926b39);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="eager" fetchPriority="high"/></picture><div class="layout_hero_children"><div class="title_in_hero"><h1>Forgejo Actions Notification Development</h1><hr/><h2>Thursday, 20th November, 2025<span> <!-- -->17min<!-- --> <a href="/tag/software_development" target="_self">#<!-- -->software_development</a> <a href="/tag/forgejo" target="_self">#<!-- -->forgejo</a> <a href="/tag/go" target="_self">#<!-- -->go</a> <a href="/tag/web" target="_self">#<!-- -->web</a></span></h2></div></div></div><div class="layout_content"><div><div class="markdown_body"><p>This article is about Forgejo, a code forge:
Just like GitHub or GitLab it&#x27;s a place to (collaboratively) develop software.
I&#x27;ve already explained at length <a href="/articles/open_source">why we benefit greatly from Open-Source</a>.
Motivated by that concept, Forgejo&#x27;s amazing community and perhaps because it&#x27;s incredibly easy to set up, you select it for your private code forge.
With your Forgejo instance up and running you might, however, miss a few features.
I, for example, needed to receive email notifications and webhooks when a CI Workflow failed.
Forgejo didn&#x27;t offer that feature so I started contributing.
You might find yourself in those shoes, too.
In this article I want to help you on that journey and give my experience contributing to Forgejo.
The parts that took the most effort where</p>
<ul>
<li><a href="#development-setup">setting up a development environment</a>,</li>
<li>understanding <a href="#forgejos-layered-architecture">Forgejo&#x27;s layered architecture</a> and <a href="#forgejos-pub-sub-pattern">pub-sub pattern</a>,</li>
<li><a href="#my-contribution">actually implementing the features</a> and</li>
<li>writing exhaustive tests.</li>
</ul>
<p>Be aware that I&#x27;m describing all of this as of commit <code>b2c4fc9f94</code> from 21st July 2025.
Some of this information may be outdated by the time you read it.</p>
<h2 id="any-go-projects-directory-structure"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#any-go-projects-directory-structure"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Any Go Project&#x27;s Directory Structure</h2>
<p>Firstly we need to take a look behind Forgejo&#x27;s pretty curtain:
Forgejo uses Go for its backend.
I&#x27;ve always found Go&#x27;s module system illusive, especially its use of domains as module paths.
Also, Go does a lot of things implicitly, for example:
How do you tell Go that some function is a unit test?
You place it in a file with the <code>_test.go</code> suffix.
Or another one:
How do you declare a symbol to be exported or not-exported (analogous to public or private in other languages)?
There&#x27;s no keyword for that.
Instead, symbols with a leading capital letter are implicitly exported, otherwise not.
Those things are hard to figure out if you haven&#x27;t inhaled the Go docs and for the first time read through a project.
Therefore, I want to quickly explain how Go handles dependencies.
There also is an <a href="https://go.dev/doc/modules/managing-dependencies">official generic explanation</a> if you prefer that.</p>
<p>Okay, so, you find Forgejo&#x27;s source code on <a href="https://codeberg.org/forgejo/forgejo">codeberg.org/forgejo/forgejo</a>.
In this section we&#x27;ll concern ourself with this subsection of Forgejo&#x27;s files:</p>
<pre><code>/
├── go.mod
├── main.go
├── cmd
│   └─ main.go
└── modules
    └─ log
       └─ init.go
</code></pre>
<p>Firstly, there are modules.
A Go library is a module, a Go executable too.
Typically one git repo houses a single Go module.
Forgejo is a binary Go module with the module path <code>forgejo.org</code>.
We can figure that out by looking at its <a href="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/go.mod"><code>go.mod</code></a> file.</p>
<pre><code class="language-go"><span class="pl-c">// /go.mod</span>
module forgejo.<span class="pl-smi">org</span>
<span class="pl-c">// --snip--</span>
<span class="pl-c1">require</span> (
    <span class="pl-c">// --snip--</span>
    github.<span class="pl-smi">com</span>/hashicorp/<span class="pl-k">go</span>-version v1<span class="pl-c1">.7.0</span>
<span class="pl-c">// --snip--</span>
replace github.<span class="pl-smi">com</span>/hashicorp/<span class="pl-k">go</span>-version =&gt; github.<span class="pl-smi">com</span>/<span class="pl-c1">6543</span>/<span class="pl-k">go</span>-version v1<span class="pl-c1">.3.1</span>
<span class="pl-c">// --snip--</span>
</code></pre>
<p>We notice that Forgejo uses the <code>github.com/hashicorp/go-version</code> Go module.
That&#x27;s a dependency, which the Go tools will download directly from GitHub.
We notice that Go uses a decentralized system for publishing modules:
There isn&#x27;t some central package index like NPM, crates.io or PyPI.
Because Go identifies a module with these URL-like paths, you also need to use statements like <code>import github.com/hashicorp/go-version</code> to import the dependency.
Consequently, Forgejo&#x27;s code is full of domains where dependencies should be pulled from.
And that really annoyed me at first.
Do you really have to touch possibly hundreds of files only when the dependency&#x27;s git repo changes?
While I&#x27;m still not entirely onboard, I&#x27;m slowly warming up to this decentralized system; mainly because of the <code>replace</code> statement above.
It states that while the Forgejo&#x27;s Go source code will <code>import github.com/hashicorp/go-version</code>, the go tooling should download it from <code>github.com/6543/go-version</code>, instead.
In this case Forgejo uses <code>replace</code> to switch to a fork.</p>
<p>As we&#x27;ve seen, Go code is grouped in modules but there&#x27;s another level of granularity: packages.
Go uses packages to isolate code into neat, contained, well, packages.
Every Go file declares what package they are in.
Go code can use exported and not-exported symbols inside its own package (i.e., functions, values, etc.).
To use symbols in other packages, however, they must be exported and you need to import that other package.<br/>
The package <code>main</code> is special, that&#x27;s where the entrypoint is.
Take a look at Forgejo&#x27;s <a href="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/main.go"><code>main.go</code></a>:</p>
<pre><code class="language-go"><span class="pl-c">// /main.go</span>
<span class="pl-c">// --snip--</span>
<span class="pl-k">package</span> main
<span class="pl-k">import</span> (
    <span class="pl-c">// [standard library imports]</span>
    <span class="pl-s"><span class="pl-pds">&quot;</span>os<span class="pl-pds">&quot;</span></span>
    <span class="pl-s"><span class="pl-pds">&quot;</span>runtime<span class="pl-pds">&quot;</span></span>
    <span class="pl-c">// --snip--</span>

    <span class="pl-c">// [import some other package from the Forgejo source code repo]</span>
    <span class="pl-s"><span class="pl-pds">&quot;</span>forgejo.org/cmd<span class="pl-pds">&quot;</span></span>
<span class="pl-c">// --snip--</span>
)
<span class="pl-c">// --snip--</span>
<span class="pl-k">func</span> <span class="pl-en">main</span>() {
    <span class="pl-c">// --snip--</span>
</code></pre>
<p>Now, this is what really confused me at first:
<code>forgejo.org</code> is a domain you can visit with your browser but that&#x27;s more or less just a coincidence.
Go only uses it to identify Forgejo&#x27;s main package&#x27;s path.
Therefore, <code>forgejo.org/cmd</code> is not a web endpoint at all, even though it might look like one.
Instead, it refers to the package <code>cmd</code> located in the <a href="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/cmd"><code>/cmd</code> directory</a>.</p>
<pre><code class="language-go"><span class="pl-c">// /cmd/main.go</span>
<span class="pl-c">// --snip--</span>
<span class="pl-k">package</span> cmd

<span class="pl-k">import</span> (
    <span class="pl-c">// --snip--</span>
    <span class="pl-s"><span class="pl-pds">&quot;</span>forgejo.org/modules/log<span class="pl-pds">&quot;</span></span>
    <span class="pl-c">// --snip--</span>
    <span class="pl-s"><span class="pl-pds">&quot;</span>github.com/urfave/cli/v3<span class="pl-pds">&quot;</span></span>
<span class="pl-c">// --snip--</span>
</code></pre>
<p>And the <code>forgejo.org/cmd</code> package imports some more packages.
When you read this, be aware of the to-be-imported package&#x27;s location in the directory structure.
The package lies in the <a href="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/modules/log"><code>/modules/log</code></a> directory of the <code>forgejo.org</code> module, thus <code>forgejo.org/modules/log</code> refers to it.
<code>github.com/urfave/cli/v3</code>, however, refers to a dependency Go will download from GitHub during a build.
The imports look so similar but one is resolved locally and the other from the internet.<br/>
Notice that the Go files in the <code>forgejo.org/modules/log</code> package declare their package without its full path:</p>
<pre><code class="language-go"><span class="pl-c">// /modules/log/init.go</span>
<span class="pl-c">// --snip--</span>
<span class="pl-k">package</span> log
<span class="pl-c">// --snip--</span>
</code></pre>
<p>It only says <code>log</code> but the full package path required to import the package is <code>forgejo.org/modules/log</code>.
Remember how the code&#x27;s directory influences the package&#x27;s path.</p>
<h2 id="forgejos-layered-architecture"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#forgejos-layered-architecture"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Forgejo&#x27;s Layered Architecture</h2>
<p>We have seen that packages can import each other.
They import the functionality of those other packages but also their complexity.
It is much easier to reason about a package that is as self-contained as possible, that doesn&#x27;t import as many other packages.
If every package imports every other package, the code-base turns into soup.
Forgejo tackle this issue by introducing a layered <a href="https://forgejo.org/docs/next/contributor/architecture">architecture</a>.
It groups packages into layers and forbids packages from importing code in higher layers.
I&#x27;ve drawn an overview over this structure:</p>
<div class="half_image_image"><div><div class="half_element_full_element"><img src="/images/30ca8795417abcd2f086abd8cd8ddf53.svg" loading="lazy" alt=""/></div><div class="half_element_spacer"></div></div></div>
<p><code>/routers</code>, <code>/services</code>, <code>/models</code> and <code>/modules</code> are some of the <em>main directories</em> where most of Forgejo&#x27;s Go code lives.
As we can see, there are three layers.
Firstly, all code may access packages inside their respective main directory.
The code in the bottom layer, however, doesn&#x27;t have access to besides that.
So for example, code in <code>/modules</code> may not access the Forgejo-specific database models defined in <code>/models</code>.
(The Go compiler doesn&#x27;t enforce this, code reviewers do.)
This code in <code>/modules</code> could theoretically be used as a library outside of Forgejo and is, thus, highly encapsulated.<br/>
Thirdly, code in <code>/services</code> may access other code in <code>/services</code> and both the below <code>/models</code> and <code>/modules</code> but not the <code>/routers</code> above.
The <code>/services</code> directory we find Forgejo&#x27;s <em>logic</em>.
It describes what should happen when something else happens.<br/>
Finally, the <code>/routers</code> code may use everything below it.
Here reside Forgejo&#x27;s input/output to the outside world, its API and web UI.</p>
<p>Naturally, we want as little code as possible in the upper layers because it is more difficult to reason about.
After all it has access to so much stuff with so many effects and side-effects.
This will become important when I talk about the refactoring my feature required.</p>
<h2 id="forgejos-pub-sub-pattern"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#forgejos-pub-sub-pattern"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Forgejo&#x27;s Pub-Sub Pattern</h2>
<p>We&#x27;ve seen how Go packages may import other Go packages.
Now take a look at this situation where simple imports don&#x27;t work:<br/>
<code>forgejo.org/services/automerge</code> imports <code>forgejo.org/services/pull</code> to check if a pull request is mergeable.
But when there has been a pull request review, <code>forgejo.org/services/automerge</code> needs to realize that.
Who knows there has been a pull request review?
<code>forgejo.org/services/pull</code> of course.
So one package needs the other and the other needs the one; a cyclical dependency.
Simply importing the respective package doesn&#x27;t work because Go forbids cyclical imports.
What does work is importing a third package, <code>forgejo.org/services/notify</code>.
<code>forgejo.org/services/notify</code> is a broker and relays messages grouped into topics to interested code.
An example topic is <code>PullRequestReview</code>.
<code>forgejo.org/services/pull</code> sends a message to that topic whenever there is a new review for a pull request.
Because <code>forgejo.org/services/automerge</code> is interested in such messages, it creates a struct abiding by the <code>Notifier</code> interface.
The notifier implements the <code>PullRequestReview</code> function and registers itself with the broker.
Therefore the broker doesn&#x27;t have to import the <code>forgejo.org/services/automerge</code> package.
This is called dependency injection and resolves the cyclic dependency.
Here is some example code:</p>
<pre><code class="language-go"><span class="pl-c">// in /services/automerge</span>
<span class="pl-k">import</span> notify_service <span class="pl-s"><span class="pl-pds">&quot;</span>forgejo.org/services/notify<span class="pl-pds">&quot;</span></span>

<span class="pl-c">// Define the notifier.</span>
<span class="pl-k">type</span> automergeNotifier <span class="pl-k">struct</span> {
	notify_service.<span class="pl-smi">NullNotifier</span>
}

<span class="pl-c">// Ensure that this struct fulfills the Notifier interface.</span>
<span class="pl-k">var</span> <span class="pl-smi">_</span> notify_service.<span class="pl-smi">Notifier</span> = &amp;automergeNotifier{}

<span class="pl-c">// Declare functions for all topics the package is interested in.</span>
<span class="pl-k">func</span> (<span class="pl-v">n</span> *<span class="pl-v">automergeNotifier</span>) <span class="pl-v">PullRequestReview</span>(<span class="pl-c">/* --snip-- */</span>) {
<span class="pl-c">// --snip--</span>

<span class="pl-c">// Tell the broker there&#x27;s a new notifier to be notified.</span>
notify_service.<span class="pl-c1">RegisterNotifier</span>(&amp;automergeNotifier{})
</code></pre>
<pre><code class="language-go"><span class="pl-c">// in /services/pull</span>

<span class="pl-c">// send a message to some topic</span>
notify_service.<span class="pl-c1">PullRequestReview</span>(<span class="pl-c">/* --snip-- */</span>)
</code></pre>
<p>Because code can publish messages and subscribe to topics, this pattern is called the pub-sub pattern.
I find this pub-sub pattern pretty intuitive because topics and messages are a concept we&#x27;re confronted with in our everyday lives.
Additionally, it allows you to get a quick overview over what code is interested in what change.
For example, if you give this interactive visualization a brief look, you can figure out that the code related to Forgejo packages is quite separate from everything else.</p>
<div><div class="half_element_full_element"><div class="markdown_iframe_wrapper"><iframe allowFullScreen="" src="https://christopher-besch.github.io/go_observer_pattern_visualizer/viewer"></iframe></div></div><div class="half_element_spacer"></div></div>
<p>If you&#x27;re interested in this visualization and what the commit history on the right has to do with it, take a look at my new article: <a href="/articles/forgejo_pub_sub_pattern_history">The History of Forgejo&#x27;s Pub-Sub Pattern</a>.</p>
<h2 id="my-contribution"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#my-contribution"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>My Contribution</h2>
<p>Forgejo features Actions, enabling continuous integrations.
One can configure an Action to compile or test code e.g., whenever there is a new commit or pull request.
A failed Action Run indicates a problem with the just introduced code.
Thus, the developer must change her code in this situation.
But how does she notice something went amiss?
Before my Contribution the only option was Forgejo&#x27;s web UI.
This is a <em>pull notification</em> because the developer must open the UI and <em>pull</em> the notification from the server.
I desired <em>push notifications</em> in the form of email and webhooks.
With email notifications the developer receives a friendly notice mail that her Action Run failed and a webhook sends a machine readable web request to some automated system.
I wanted to develop those features.
But where do you even start?
Firstly, it makes sense to add a new topic to the pub-sub pattern, <code>ActionRunNowDone</code>.
<code>forgejo.org/services/mailer</code> and <code>forgejo.org/services/webhook</code> are responsible for sending mails and webhooks so they should listen to that new topic.
We only need something to send a message to that topic whenever an Action Run completes.
<code>forgejo.org/models/actions</code> provides the database abstraction for Action Runs.
It&#x27;s <code>UpdateRunJob</code> function performs all changes including those indicating a completed Action Run.
Therefore, that function should send the message.
However, there&#x27;s a problem:
When we think back to Forgejo&#x27;s layered architecture we realize that
<code>forgejo.org/models/actions</code> is not allowed to import <code>forgejo.org/services/notify</code>, because it lies in a lower layer.</p>
<p>At this point I already compiled everything I figured out and planned to do into issue <a href="https://codeberg.org/forgejo/forgejo/issues/3719">#3719</a>.
That gave Forgejo&#x27;s maintainers the option to share their opinion.
After all, perhaps I didn&#x27;t understand Forgejo&#x27;s structure well enough.
It&#x27;s better to find that out before spending hours implementing something no one needs.</p>
<h3 id="pr-7510-refactoring"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#pr-7510-refactoring"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PR <a href="https://codeberg.org/forgejo/forgejo/pulls/7510">#7510</a>: Refactoring</h3>
<p>This is where my first pull request comes in.
I had to move some code from <code>forgejo.org/models/actions</code> up a layer into <code>forgejo.org/services/actions</code>.
That&#x27;s where Actions-related code lives that needs to import more things.
In order to make my PR as easy to review (and approve) as possible, I tried to move as little code as was absolutely necessary.
Of course, I had to move <code>UpdateRunJob</code> but e.g., <code>CleanRepoScheduleTasks</code> calls <code>UpdateRunJob</code>.
If I had only moved <code>UpdateRunJob</code>, <code>CleanRepoScheduleTasks</code> would require an import of <code>forgejo.org/services/actions</code>.
But that is, again, not possible because of the layered architecture.
Therefore, I also had to move all the function transitively changing the Actions Run&#x27;s status.</p>
<h3 id="pr-7491-actionrunnowdone-topic"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#pr-7491-actionrunnowdone-topic"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PR <a href="https://codeberg.org/forgejo/forgejo/pulls/7491">#7491</a>: <code>ActionRunNowDone</code> Topic</h3>
<p>Now <code>UpdateRunJob</code> calls the <code>sendActionRunNowDoneNotificationIfNeeded</code> function, which I just implemented.
It sends a message to the new <code>ActionRunNowDone</code> topic whenever an Action Run is now done.
Finally, I added a bunch of tests ensuring that in all cases the <code>ActionRunNowDone</code> topic is used.</p>
<h3 id="pr-7509-actions-done-mail"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#pr-7509-actions-done-mail"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PR <a href="https://codeberg.org/forgejo/forgejo/pulls/7509">#7509</a>: Actions Done Mail</h3>
<p><code>forgejo.org/services/mailer</code>&#x27;s notifier received interest in the <code>ActionRunNowDone</code> topic in this PR.
I made it send out a mail whenever a Run failed or recovered (i.e., succeeded after a prior failure).
Again, I added many tests ensuring whenever an <code>ActionRunNowDone</code> message requires it, a mail is sent.</p>
<h3 id="7508-actions-done-webhook"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#7508-actions-done-webhook"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://codeberg.org/forgejo/forgejo/pulls/7508">#7508</a>: Actions Done Webhook</h3>
<div class="half_image_image"><div class="half_element_wrapper"><div class="half_element_before"></div><div class="half_element_element"><picture class="image_picture"><img srcSet="/images/b4e166780a33bdeacf27d6d863d98a41_400_372.webp 400w,/images/b4e166780a33bdeacf27d6d863d98a41_800_744.webp 800w,/images/b4e166780a33bdeacf27d6d863d98a41_972_905.webp 972w" width="400" height="372" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #f3f4f5, transparent),radial-gradient(67% 67% at 50% 25%, #f9f9fa, transparent),radial-gradient(67% 67% at 75% 25%, #f9f9fa, transparent),radial-gradient(67% 67% at 25% 50%, #f9f9f9, transparent),radial-gradient(67% 67% at 50% 50%, #fdfdfd, transparent),radial-gradient(67% 67% at 75% 50%, #fdfdfd, transparent),radial-gradient(67% 67% at 25% 75%, #f8f8f8, transparent),radial-gradient(67% 67% at 50% 75%, #fafafb, transparent),radial-gradient(67% 67% at 75% 75%, #f9fafa, transparent),linear-gradient(#f9fafa);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture></div><div class="half_element_after"></div></div></div>
<p>In this PR <code>forgejo.org/services/webhook</code> got interested in the <code>ActionRunNowDone</code> topic, too.
It sends out HTTP requests to the webhooks configured in the new settings.<br/>
For this I had to introduce the <code>ActionRun</code> struct, which allows serialising an action to be sent to the webhook.
Of course, I added tests ensuring whenever an <code>ActionRunNowDone</code> message requires it, a webhook is sent.</p>
<div class="markdown_spacer"></div>
<h3 id="repoactionrun-and-actionrun-structs"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#repoactionrun-and-actionrun-structs"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>RepoActionRun</code> and <code>ActionRun</code> Structs</h3>
<p>While I got <a href="https://codeberg.org/forgejo/forgejo/pulls/7508">#7508</a> merged, <a href="https://codeberg.org/klausfyhn">klausfyhn</a>&#x27;s <a href="https://codeberg.org/forgejo/forgejo/pulls/7699">#7699</a> extended Forgejo&#x27;s API.
The new API endpoints allow for retrieving Action Runs programmatically, which, of course, needed an <code>ActionRun</code> struct for serialisation.
So his and my PR introduced the same struct at the same time and broke the main <code>forgejo</code> branch, ups.
<a href="https://codeberg.org/earl-warren">Earl Warren</a> quickly resolved the merge conflict in <a href="https://codeberg.org/forgejo/forgejo/pulls/8066">#8066</a> by renaming <a href="https://codeberg.org/forgejo/forgejo/pulls/7699">#7699</a>&#x27;s struct to <code>RepoActionRun</code>.
Then, because having two structs for the same purpose is bad, he removed the <code>RepoActionRun</code>, leaving only <code>ActionRun</code> in <a href="https://codeberg.org/forgejo/forgejo/pulls/8250">#8250</a>.
Both the webhook and the API use the same struct now.</p>
<h3 id="other-prs"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#other-prs"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other PRs</h3>
<div class="half_image_image"><div class="half_element_wrapper"><div class="half_element_before"></div><div class="half_element_element"><picture class="image_picture"><img srcSet="/images/8eab88a8e6da12ab55525111fb758fef_400_210.webp 400w,/images/8eab88a8e6da12ab55525111fb758fef_800_421.webp 800w,/images/8eab88a8e6da12ab55525111fb758fef_1200_632.webp 1200w,/images/8eab88a8e6da12ab55525111fb758fef_1536_810.webp 1536w" width="400" height="210" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #e8e8ea, transparent),radial-gradient(67% 67% at 50% 25%, #f2f2f3, transparent),radial-gradient(67% 67% at 75% 25%, #ffffff, transparent),radial-gradient(67% 67% at 25% 50%, #efeff0, transparent),radial-gradient(67% 67% at 50% 50%, #f1f2f3, transparent),radial-gradient(67% 67% at 75% 50%, #fcfcfc, transparent),radial-gradient(67% 67% at 25% 75%, #f0f2f3, transparent),radial-gradient(67% 67% at 50% 75%, #f6f6f7, transparent),radial-gradient(67% 67% at 75% 75%, #fefefe, transparent),linear-gradient(#f5f6f6);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture></div><div class="half_element_after"></div></div></div>
<p>A few more PRs accompanied this feature, which I won&#x27;t get into detail:</p>
<ul>
<li><a href="https://codeberg.org/forgejo/forgejo/pulls/7697">#7697</a>: After the Fact Cleanup</li>
<li><a href="https://codeberg.org/forgejo/forgejo/pulls/8227">#8227</a>: (Earl Warren) Only single user receives mail</li>
<li><a href="https://codeberg.org/forgejo/forgejo/pulls/8242">#8242</a>: (Earl Warren) actions mail opt-in</li>
</ul>
<p>With all that work done, Action notification got into the v12.0 release of Forgejo!
You can go back up to the visualization and see if you can find my PRs.
And because I got my features upstreamed into Forgejo, Forgejo&#x27;s maintainers take care of it now.
I don&#x27;t have to maintain my own custom fork.
Having your features upstreamed really is the best thing that could happen to you.</p>
<div class="markdown_spacer"></div>
<h2 id="development-setup"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#development-setup"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development Setup</h2>
<p>Here I want to give an in-depth technical explanation of my development setup.
After all, I quickly got into the situation where I changed some of Forgejo&#x27;s code and wanted to test it.
For this I don&#x27;t just need the Forgejo executable.
No, I also need an action runner, a mail server and some place to send webhooks to.</p>
<h3 id="forgejo-itself"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#forgejo-itself"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Forgejo itself</h3>
<p>Let&#x27;s start with just getting a Forgejo test instance up and running.</p>
<ol>
<li>I use Debian but this setup should work on all Linux distros (and maybe macOS and BSD?).</li>
<li><a href="https://github.com/nvm-sh/nvm?tab=readme-ov-file#install--update-script">Install node and npm</a>.</li>
<li><a href="https://go.dev/doc/install">Install go</a>.</li>
<li>Install <a href="https://github.com/gotestyourself/gotestsum">gotestsum</a>.
This is entirely optional.
If you don&#x27;t install gotestsum, ignore all the <code>USE_GOTESTSUM=yes</code> statements below.</li>
<li>Download the <a href="https://codeberg.org/forgejo/forgejo">Forgejo repo</a> with <code>git clone https://codeberg.org/forgejo/forgejo ~/forgejo &amp;&amp; cd ~/forgejo</code>.</li>
<li>Build an executable with <code>STRIP=&quot;0&quot; EXTRA_GOFLAGS=&#x27;-gcflags=&quot;all=-N -l&quot;&#x27; TAGS=&quot;sqlite sqlite_unlock_notify&quot; make build</code>.
It took me a while to realize that <code>go build</code> enables optimization by default but keeps all debug symbols present.
We change that with the <code>gsflags</code> by neither optimizing or inlining.
Furthermore, Forgejo&#x27;s Makefile strips the debug symbols so we disable that with the <code>STRIP</code> environment variable.</li>
<li>Run <code>./gitea</code>.
Yes, the executable is still called that.</li>
<li>Open a webbrowser and navigate to <code>http://localhost:3000</code>.</li>
<li>Choose SQLite, create an admin account and keep everything else default.
Your config is in <code>~/forgejo/custom/conf/app.ini</code>.</li>
<li>Create the <code>test_repo</code> repository and add the file <code>.forgejo/workflows/main.yml</code>:<!-- -->
<pre><code class="language-yaml"><span class="pl-ent">enable-email-notifications</span>: <span class="pl-c1">true</span>
<span class="pl-ent">on</span>:
  <span class="pl-ent">workflow_dispatch</span>:

<span class="pl-ent">jobs</span>:
  <span class="pl-ent">test</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">self-hosted</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">name</span>: <span class="pl-s">Echo</span>
        <span class="pl-ent">run</span>: <span class="pl-s">|</span>
<span class="pl-s">          echo Hello World!</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Fail</span>
        <span class="pl-ent">run</span>: <span class="pl-s">|</span>
<span class="pl-s">          <span class="pl-c1">false</span></span>
</code></pre>
<!-- -->You can make your life a little easier by cloning the repo: <code>git clone http://localhost:3000/chris_admin/test_repo.git ~forgejo_test_repo</code>.
You&#x27;ll have to follow the prompts and configure your <code>user.email</code> and <code>user.name</code>.
I&#x27;m using password login, btw.</li>
</ol>
<h3 id="forgejo-runner"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#forgejo-runner"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Forgejo Runner</h3>
<p>To test a workflow I need a runner.</p>
<ol>
<li>Download the <a href="https://code.forgejo.org/forgejo/runner/releases">Forgejo runner binary</a> into <code>~/forgejo_runner</code>.</li>
<li>Register the runner with <code>./forgejo-runner-11.1.2-linux-amd64 register</code>, give the instance URL <code>http://localhost:3000</code>, the runner token you get from the repo settings in the web interface, choose a name like <code>test-runner</code> and select the label <code>self-hosted:host</code>.</li>
<li>Run <code>./forgejo-runner-11.1.2-linux-amd64 daemon</code> and click the workflow trigger button in the web interface.
You should see your workflow run now.</li>
</ol>
<h3 id="mail-server"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#mail-server"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mail Server</h3>
<p>Okay, that works fine but we also want to test sending emails.
I use <a href="https://github.com/maildev/maildev">MailDev</a> to create a development email server.
It provides an SMTP server, which Forgejo connects to, and a web interface for me, the developer.</p>
<ol>
<li><a href="https://docs.docker.com/engine/install">Install Docker</a>.</li>
<li>Run <code>docker run --network host -p 1080:1080 -p 1025:1025 maildev/maildev</code>.</li>
<li>Open <code>http://localhost:1080</code> in a webbrowser.</li>
<li>Shutdown Forgejo and edit it&#x27;s config (in <code>~/forgejo/custom/conf/app.ini</code>).<!-- -->
<pre><code class="language-ini"><span class="pl-en">[mailer]</span>
<span class="pl-k">ENABLED</span> = true
<span class="pl-k">PROTOCOL</span> = smtp
<span class="pl-k">SMTP_ADDR</span> = localhost
<span class="pl-k">SMTP_PORT</span> = 1025
<span class="pl-k">FROM</span> = forgejo@localhost

<span class="pl-c"># make sure this is true</span>
<span class="pl-en">[service]</span>
<span class="pl-k">ENABLE_NOTIFY_MAIL</span> = true
</code></pre>
</li>
<li>Now, when the workflow fails you should receive a mail in the MailDev web interface.</li>
</ol>
<h3 id="webhook"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#webhook"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webhook</h3>
<p>Furthermore, we want to test webhooks.</p>
<ol>
<li>I&#x27;m using <a href="https://stackoverflow.com/a/46787467">this node script</a> as a test webhook:
<code>webhook_tester.js</code>:<!-- -->
<pre><code class="language-js"><span class="pl-c">#!/usr/bin/env node</span>

<span class="pl-k">const</span> <span class="pl-c1">http</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>http<span class="pl-pds">&quot;</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">hostname</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>0.0.0.0<span class="pl-pds">&quot;</span></span>;
<span class="pl-k">const</span> <span class="pl-c1">port</span> <span class="pl-k">=</span> <span class="pl-c1">8001</span>;

<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-smi">http</span>.<span class="pl-en">createServer</span>((<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) <span class="pl-k">=&gt;</span> {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">`</span><span class="pl-cce">\n</span><span class="pl-pse"><span class="pl-s1">${</span></span><span class="pl-smi">req</span><span class="pl-s1">.</span><span class="pl-c1">method</span><span class="pl-pse"><span class="pl-s1">}</span></span> <span class="pl-pse"><span class="pl-s1">${</span></span><span class="pl-smi">req</span><span class="pl-s1">.</span><span class="pl-smi">url</span><span class="pl-pse"><span class="pl-s1">}</span></span><span class="pl-pds">`</span></span>);
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">req</span>.<span class="pl-c1">headers</span>);

  <span class="pl-smi">req</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>data<span class="pl-pds">&quot;</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">chunk</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>BODY: <span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> chunk);
  });

  <span class="pl-smi">res</span>.<span class="pl-smi">statusCode</span> <span class="pl-k">=</span> <span class="pl-c1">200</span>;
  <span class="pl-smi">res</span>.<span class="pl-en">setHeader</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Content-Type<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>text/plain<span class="pl-pds">&quot;</span></span>);
  <span class="pl-smi">res</span>.<span class="pl-en">end</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Hello World<span class="pl-cce">\n</span><span class="pl-pds">&quot;</span></span>);
});

<span class="pl-smi">server</span>.<span class="pl-en">listen</span>(port, hostname, () <span class="pl-k">=&gt;</span> {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">`</span>Server running at http://localhost:<span class="pl-pse"><span class="pl-s1">${</span></span><span class="pl-s1">port</span><span class="pl-pse"><span class="pl-s1">}</span></span>/<span class="pl-pds">`</span></span>);
});
</code></pre>
</li>
<li>Run <code>./webhook_tester.js</code>.</li>
<li>Shutdown Forgejo and edit it&#x27;s config (in <code>~/forgejo/custom/conf/app.ini</code>).
For Forgejo to accept <code>http://localhost:8001</code> as a webhook target you need to add this:<!-- -->
<pre><code class="language-ini"><span class="pl-en">[webhook]</span>
<span class="pl-k">ALLOWED_HOST_LIST</span> = *
<span class="pl-k">SKIP_TLS_VERIFY</span> = true
</code></pre>
</li>
<li>Create a new webhook in the Repo Settings and use the target URL <code>http://localhost:8001</code>.
Enable either <em>All events</em> or <em>Custom events</em>, selecting the <em>Action Run events</em>.</li>
<li>Start the workflow, let it fail and watch the sent webhook in the node terminal.</li>
</ol>
<p>Now we have everything to play with the features I implemented.
Notice that many of the settings I showed you are awfully insecure for a productive deployment.
They just make things easier for development.</p>
<h2 id="running-tests"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#running-tests"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Tests</h2>
<p>Forgejo has many different types of tests.
I was concerned with these types.</p>
<ul>
<li>Run all unit tests with <code>TAGS=&#x27;sqlite sqlite_unlock_notify&#x27; USE_GOTESTSUM=yes make test</code>.</li>
<li>Run all integration tests with <code>TAGS=&#x27;sqlite sqlite_unlock_notify&#x27; USE_GOTESTSUM=yes make test-sqlite</code>.</li>
</ul>
<p>Say you only want to run this unit test in <code>~/forgejo/models/actions/run_test.go</code>:</p>
<pre><code class="language-go"><span class="pl-k">func</span> <span class="pl-en">TestGetRunBefore</span>(<span class="pl-v">t</span> *<span class="pl-v">testing</span>.<span class="pl-v">T</span>) {
  <span class="pl-c">// --snip--</span>
}
</code></pre>
<p>Then you can execute <code>USE_GOTESTSUM=yes TAGS=&#x27;sqlite sqlite_unlock_notify&#x27; GO_TEST_PACKAGES=&#x27;forgejo.org/models/actions&#x27; make &#x27;test#TestGetRunBefore&#x27;</code>.
But what if, instead, you are concerned with this integration test in <code>~/forgejo/tests/integration/actions_notifications_test.go</code>:</p>
<pre><code class="language-go"><span class="pl-k">func</span> <span class="pl-en">TestActionNotifications</span>(<span class="pl-v">t</span> *<span class="pl-v">testing</span>.<span class="pl-v">T</span>) {
  <span class="pl-c">// --snip--</span>
}
</code></pre>
<p>Then you can run <code>USE_GOTESTSUM=yes TAGS=&#x27;sqlite sqlite_unlock_notify&#x27; make &#x27;test-sqlite#TestActionNotifications&#x27;</code>.
Btw, there are other types of tests, namely frontend tests and the End-to-End tests in a <a href="https://code.forgejo.org/forgejo/end-to-end">special repo</a>.
I didn&#x27;t work with these yet so I direct you to the <a href="https://forgejo.org/docs/latest/contributor/testing">testing docs</a>.</p>
<h2 id="debugging"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#debugging"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging</h2>
<p>I like the terminal and am used to GDB.
Therefore, I&#x27;m using the terminal debugger <a href="https://github.com/go-delve/delve">Delve</a>.
Let&#x27;s set things up for that:</p>
<ol>
<li><a href="https://github.com/go-delve/delve/tree/master/Documentation/installation">Install Delve</a>.</li>
<li>Build Forgejo as described <a href="#development-setup">above</a>.</li>
<li>Run <code>dlv exec ./gitea</code>.</li>
<li>Now we can use the Delve console while Forgejo runs, letting you interact with the web interface.
For example you can do <code>break forgejo.org/services/mailer.(*mailNotifier).ActionRunNowDone</code>, <code>break forgejo.org/services/notify.ActionRunNowDone</code> and <code>continue</code>.
Hit <code>Ctrl+C</code> to enter a Delve command and type <code>quit</code> to exit.</li>
</ol>
<p>Say you want to debug the above unit test.
Then you can use Delve with this command: <code>dlv test --build-flags &quot;-tags=&#x27;sqlite,sqlite_unlock_notify&#x27; -run TestGetRunBefore&quot; forgejo.org/models/actions</code>.
If, instead,  you want to debug the above integration test, run <code>make integrations.sqlite.test generate-ini-sqlite &amp;&amp; GITEA_ROOT=&quot;$(pwd)&quot; GITEA_CONF=tests/sqlite.ini dlv exec ./integrations.sqlite.test -- -test.run TestActionNotifications</code>.
Here you can break on some line number, too: <code>break ./tests/integration/actions_notifications_test.go:22</code>
To debug something else, take a look at Forgejo&#x27;s Makefile and find what command make the things you want to debug run.
Just replace <code>go test</code> with <code>delve</code> and place all <code>go test</code> arguments in the <code>--build_flags</code> Delve argument.
You can break on line numbers, too: <code>break ./models/actions/run_test.go:19</code></p>
<h2 id="conclusion-and-lessons-learned"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#conclusion-and-lessons-learned"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion and Lessons Learned</h2>
<p>We&#x27;ve seen the structure of any Go project, Forgejos layered architecture and pub-sub pattern, how I contributed and with what development setup.
Now I understand better just how valuable a deep understanding of the project you&#x27;re working on is.
This really allows you to make the least invasive change to the code and still implement your feature.
And a smaller change is much easier to understand, review and approve.
We all benefit from that.
Breaking things up into multiple PRs goes along nicely with that, too.
Furthermore and even though I didn&#x27;t go in-depth in this article, I spent a lot of time writing tests.
Those tests are really important and not just a side-gig you slap onto the <em>&quot;real&quot;</em> code.
They enable the maintainers to check things still work as they should when new code comes along and you might have left the project.</p>
<p>And lastly, of course, the Forgejo maintainers are absolutely amazing.
Especially <a href="https://codeberg.org/earl-warren">Earl Warren</a> did a lovely job helping me on my journey.
Thank you!</p>
<h2 id="ps"><a aria-hidden="true" tabindex="-1" class="markdown_heading_a" href="#ps"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>P.S.</h2>
<p>I created the talk <a href="https://present.chris-besch.com/2025_11_21_ibm_forgejo/">Contributing to Forgejo</a> around this article.</p><div class="markdown_spacer"></div></div></div><div class="react_to"><div class="markdown_body"> <a href="/tag/software_development" target="_self">#<!-- -->software_development</a> <a href="/tag/forgejo" target="_self">#<!-- -->forgejo</a> <a href="/tag/go" target="_self">#<!-- -->go</a> <a href="/tag/web" target="_self">#<!-- -->web</a></div><div><button type="button" class="button" onclick="
umami.track(
    'like',
    {
        route: '/articles/forgejo_actions_notification',
    }
).then(()=>{
    this.innerText = 'Thx!';
    this.onclick = null;
    this.style = 'cursor:default;';
});
">👍 I like this!</button></div><div class="react_to_comment"><textarea id="react_to_comment_input" placeholder="Your Comment..."></textarea><div><button type="button" class="button" onclick="
umami.track(
    'comment',
    {
        route: '/articles/forgejo_actions_notification',
        comment: document.getElementById('react_to_comment_input').value,
    }
).then(()=>{
    this.innerText = 'Comment Sent';
    this.onclick = null;
    this.style = 'cursor:default;';
    document.getElementById('react_to_comment_input').disabled = true;
});
">Send Comment</button></div></div></div><div class="title_in_text"><h1>Other Articles</h1><hr/></div><div class="cards_list"><a class="cards_list_card" href="/articles/forgejo_pub_sub_pattern_history" target="_self"><picture class="image_picture"><img srcSet="/images/a7f291280fadb4822ddaf7ed36c95bf8_400_200.webp 400w,/images/a7f291280fadb4822ddaf7ed36c95bf8_800_400.webp 800w,/images/a7f291280fadb4822ddaf7ed36c95bf8_1200_600.webp 1200w,/images/a7f291280fadb4822ddaf7ed36c95bf8_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #fefefe, transparent),radial-gradient(67% 67% at 50% 25%, #fafbfc, transparent),radial-gradient(67% 67% at 75% 25%, #fcfdfd, transparent),radial-gradient(67% 67% at 25% 50%, #fcfcfd, transparent),radial-gradient(67% 67% at 50% 50%, #eff2f5, transparent),radial-gradient(67% 67% at 75% 50%, #f8f9fa, transparent),radial-gradient(67% 67% at 25% 75%, #fefdfe, transparent),radial-gradient(67% 67% at 50% 75%, #f2f4f6, transparent),radial-gradient(67% 67% at 75% 75%, #f3f6f7, transparent),linear-gradient(#f9fbfb);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>The History of Forgejo&#x27;s Pub-Sub Pattern</h1><h2>10min <!-- -->Thursday, 30th October, 2025</h2><hr/><p>I created a tool to visualize Forgejo&#x27;s Pub-Sub pattern. Why not run that tool on all 24 thousand commits in Forgejo&#x27;s history? What could possibly go wrong?</p></a><a class="cards_list_card" href="/articles/ctemsoft" target="_self"><picture class="image_picture"><img srcSet="/images/c5fde5a326c6a0b5e07c470ffda1eb59_400_200.webp 400w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_800_400.webp 800w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_1200_600.webp 1200w,/images/c5fde5a326c6a0b5e07c470ffda1eb59_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #e2e2e2, transparent),radial-gradient(67% 67% at 50% 25%, #e1e1e1, transparent),radial-gradient(67% 67% at 75% 25%, #e3e3e3, transparent),radial-gradient(67% 67% at 25% 50%, #e4e4e4, transparent),radial-gradient(67% 67% at 50% 50%, #d7d7d7, transparent),radial-gradient(67% 67% at 75% 50%, #c0c0c0, transparent),radial-gradient(67% 67% at 25% 75%, #f9f9f9, transparent),radial-gradient(67% 67% at 50% 75%, #d9d9d9, transparent),radial-gradient(67% 67% at 75% 75%, #c1c1c1, transparent),linear-gradient(#dddddd);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>Docker: Breathing Life into Decades old Fortran</h1><h2>4min <!-- -->Sunday, 6th April, 2025</h2><hr/><p>Bringing decades old Fortran code to life with Docker and animating it with Python.
Now you get to see Fig.3.5. from &quot;Introduction to Conventional Transmission Electron Microscopy&quot; by Prof. Marc De Graef at 30 frames a second.</p></a><a class="cards_list_card" href="/articles/photo_abilities" target="_self"><picture class="image_picture"><img srcSet="/images/649107d285c96dd4c9b87ed2f0084b53_400_200.webp 400w,/images/649107d285c96dd4c9b87ed2f0084b53_800_400.webp 800w,/images/649107d285c96dd4c9b87ed2f0084b53_1200_600.webp 1200w,/images/649107d285c96dd4c9b87ed2f0084b53_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #9eb3d8, transparent),radial-gradient(67% 67% at 50% 25%, #a6b8db, transparent),radial-gradient(67% 67% at 75% 25%, #a5b6d7, transparent),radial-gradient(67% 67% at 25% 50%, #a0b0ca, transparent),radial-gradient(67% 67% at 50% 50%, #a9bad3, transparent),radial-gradient(67% 67% at 75% 50%, #a2b4d0, transparent),radial-gradient(67% 67% at 25% 75%, #3b4c59, transparent),radial-gradient(67% 67% at 50% 75%, #394b58, transparent),radial-gradient(67% 67% at 75% 75%, #384754, transparent),linear-gradient(#8091aa);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>When You Don&#x27;t Take the Shot</h1><h2>2min <!-- -->Wednesday, 10th December, 2025</h2><hr/><p>I list the things I realized to improve my photos. There are the technical abilities (equipment, exposure, post processing, ...) and the surrounding conditions (time, location, ...). And sometimes, photography means letting the shutter rest.</p></a><a class="cards_list_card" href="/articles/rt_on_linux.pdf" target="_blank"><picture class="image_picture"><img srcSet="/images/90aa1c30ead3a00608bd83478b9f3b84_400_200.webp 400w,/images/90aa1c30ead3a00608bd83478b9f3b84_800_400.webp 800w,/images/90aa1c30ead3a00608bd83478b9f3b84_1200_600.webp 1200w,/images/90aa1c30ead3a00608bd83478b9f3b84_1280_640.webp 1280w" width="400" height="200" alt="" style="background-image:radial-gradient(67% 67% at 25% 25%, #f6f8f4, transparent),radial-gradient(67% 67% at 50% 25%, #efedf2, transparent),radial-gradient(67% 67% at 75% 25%, #fbfbfc, transparent),radial-gradient(67% 67% at 25% 50%, #dee2e5, transparent),radial-gradient(67% 67% at 50% 50%, #e1e0e8, transparent),radial-gradient(67% 67% at 75% 50%, #fbf9f9, transparent),radial-gradient(67% 67% at 25% 75%, #f2f2f4, transparent),radial-gradient(67% 67% at 50% 75%, #f2f2f3, transparent),radial-gradient(67% 67% at 75% 75%, #f0f0f0, transparent),linear-gradient(#f1f1f3);background-position:0 0, 0 100%;background-size:100% 100%;background-repeat:no-repeat" loading="lazy" fetchPriority="auto"/></picture><h1>Real-Time Application Development on Linux with PREEMPT RT</h1><h2>7min <!-- -->Monday, 29th September, 2025</h2><hr/><p>While Linux is optimized for throughput and efficiency, real-time applications require bounded worst case latencies. However, with the merging of PREEMPT RT, mainline Linux converts to a real-time operating system (RTOS). Through presenting the application developer’s perspective and the changes PREEMPT RT introduces to the kernel, we review Linux’ real-time capabilities. Additionally, we investigate dynamic worst case execution time (WCET) analysis using a StarFive VisionFive 2 as a case study. Finally, we compare Linux to other RTOSes and argue that the lack of static WCET analysis is Linux’ main drawback for real-time applications.</p></a></div><div><a class="button" href="/articles" target="_self">Furthermore Articles</a></div></div></main><footer class="layout_footer" role="contentinfo"><a href="/about">Contact</a><a href="/rss.xml">RSS</a><a href="/articles/privacy">Privacy</a><div>© 2025 | All rights reserved</div></footer></body></html>