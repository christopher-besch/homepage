"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[53],{6433:function(e,t,a){a.r(t),a.d(t,{Head:function(){return j},default:function(){return k}});var o=a(8453),n=a(6540);function r(e){const t=Object.assign({p:"p",a:"a",code:"code",h2:"h2",span:"span",pre:"pre",h3:"h3",em:"em",br:"br"},(0,o.R)(),e.components),{Iframe:a}=t;return a||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Iframe",!0),n.createElement(n.Fragment,null,n.createElement(t.p,null,"I stood before a well and wondered how deep it would go.\nAll I could see was blackness.\nWell, I didn't actually leave my cellar and instead stood before Forgejo's git history.\nBut still, with the 24 thousand commits Forgjeo's history felt just as opaque.",n.createElement("br"),"\nForgejo is a code forge like GitHub or GitLab.\nForgejo is a place to (collaboratively) develop software and is itself fully Open-Source.\nI've already explained at length ",n.createElement(t.a,{href:"https://github.com/christopher-besch/homepage/blob/dev/articles/open_source"},"why we benefit greatly from Open-Source"),".\nWhat I'm interested in is Forgejo's publish-subscribe pattern.\nIt allows packages to publish messages grouped by topics.\nOther packages subscribe to those topics and get called when a message for a topic of interest arrives.\n",n.createElement(t.code,null,"forgejo.org/services/notify.Notify")," is the broker, which facilitating all this.\nI've created a visualization of Forgejo's pub-sub pattern.\nPackages are Forgejo-orange and topics Codeberg-blue.\nEvery arrow goes in the direction messages flow, from sender to receiver."),"\n",n.createElement(a,{src:"https://christopher-besch.github.io/go_observer_pattern_visualizer/viewer",fullscreen:!0}),"\n",n.createElement(t.p,null,"The list on the right shows all commits in Forgejo's history that change something about the pub-sub pattern.\nSelect a commit see how the Forgejo looked like back then.\nOnce you've selected a commit you can use the arrow keys, too."),"\n",n.createElement(t.h2,{id:"go-ast-a-lot-of-bash-and-d3js",style:{position:"relative"}},n.createElement(t.a,{href:"#go-ast-a-lot-of-bash-and-d3js","aria-label":"go ast a lot of bash and d3js permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Go AST, a lot of Bash and D3.js"),"\n",n.createElement(t.p,null,"How did I create this visualization?\nFirstly, let's take a look at how Forgejo's pub-sub pattern works.\nEvery participating package defines a notifier struct like this:"),"\n",n.createElement(t.pre,null,n.createElement(t.code,{className:"language-go"},"// Define the notifier.\ntype actionsNotifier struct {\n\tnotify_service.NullNotifier\n}\n\n// Ensure that this struct fulfills the Notifier interface.\nvar _ notify_service.Notifier = &actionsNotifier{}\n\n// Declare functions for all topics the package is interested in.\nfunc (n *actionsNotifier) NewIssue(/* --snip-- */) {\n// --snip--\n\n// Tell the broker there's a new notifier to be notified.\nnotify_service.RegisterNotifier(&actionsNotifier{})\n\n// send a message to some topic\nnotify_service.PullReviewDismiss(ctx, doer, review, comment)\n")),"\n",n.createElement(t.p,null,"So what I had to do is find these places in Forgejo's source code and compile that data into a usable format.\nI thought about doing this with grep and simple string matching but I figured something more robust wouldn't hurt.\nTherefore, I used Go's abstract syntax tree (AST) directly.\nA part of the Go compiler generates the AST and to my delight, there is the ",n.createElement(t.code,null,"go/ast")," package to walk through the AST and ",n.createElement(t.code,null,"go/types")," for type checking.\nThere even is the convenient ",n.createElement(t.code,null,"golang.org/x/tools/go/packages")," package to tie it all together.\nTake a look at my ",n.createElement(t.a,{href:"https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/parser/main.go"},"parser main.go")," if you're interested in some details.\nThis file spits out a JSON.\nFor the pretty visualization I used ",n.createElement(t.a,{href:"https://d3js.org"},"D3.js"),"'s force simulation.\nIt simulates repelling forces between all nodes and attracting forces between connected nodes.\nTake a look at the ",n.createElement(t.a,{href:"https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/viewer"},"viewer source code")," for more."),"\n",n.createElement(t.h2,{id:"the-well-and-the-light",style:{position:"relative"}},n.createElement(t.a,{href:"#the-well-and-the-light","aria-label":"the well and the light permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"The Well and the Light"),"\n",n.createElement(t.p,null,"Now that I had a way to extract this data for one state of Forgejo's code base a bigger thought appeared.\nWhy not do this for every commit in Forgejo's history?\nHow difficult could it be?\nAs you can see above, that did work out but not without hiccups.\nSo, I invite you to come on a little journey down Forgejo's history:\nLet's throw a light down that well!"),"\n",n.createElement(t.h3,{id:"0000m-2025-10-27-346f87d",style:{position:"relative"}},n.createElement(t.a,{href:"#0000m-2025-10-27-346f87d","aria-label":"0000m 2025 10 27 346f87d permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"0,000m")," 2025-10-27 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/346f87d7a26d7c3678867961c74487e5b759cbf0"},"346f87d"),")"),"\n",n.createElement(t.p,null,"I started in front of the well:\nA few days a go I created ",n.createElement(t.a,{href:"https://codeberg.org/christopher-besch/go_pub_sub_visualizer/src/branch/main/auto_parser.sh"},"a script")," that creates the pub-sub data JSON, checks out the previous commit and repeats the process.\nThis is where I left it off, falling into the darkness below.\nI didn't know if and when my script would encounter some hurdle and crash."),"\n",n.createElement(t.h3,{id:"0780m-2025-06-17-16dbc0e",style:{position:"relative"}},n.createElement(t.a,{href:"#0780m-2025-06-17-16dbc0e","aria-label":"0780m 2025 06 17 16dbc0e permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"0,780m")," 2025-06-17 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/16dbc0efd350cdc15760c2e40346c1e9fbb0bd01"},"16dbc0e"),")"),"\n",n.createElement(t.p,null,"This was my first hiccup; my Go script crashed.\nApparently this commit removed a type of token that my script didn't expect (a SelectorExpr with a Selector that doesn't map to any object).\nSo, all older commits than this crashe my script.\nI added a nil check and sent my script back to the races."),"\n",n.createElement(t.pre,null,n.createElement(t.code,{className:"language-go"},"pkg.TypesInfo.Uses[f.Sel] != nil\n")),"\n",n.createElement(t.h3,{id:"1225m-2025-03-27-2457f5f",style:{position:"relative"}},n.createElement(t.a,{href:"#1225m-2025-03-27-2457f5f","aria-label":"1225m 2025 03 27 2457f5f permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"1,225m")," 2025-03-27 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/2457f5ff2293f69e6de5cc7d608dd210f6b8e27a"},"2457f5f"),")"),"\n",n.createElement(t.p,null,"And I encountered another hiccup; in March Forgejo changed the Go module path from ",n.createElement(t.code,null,"code.gitea.io/gitea")," to ",n.createElement(t.code,null,"forgejo.org"),".\nAfter all, Forgejo is a fork of Gitea.\nI adjusted my Go script and made the viewer remove the ",n.createElement(t.code,null,"forgejo.org")," and ",n.createElement(t.code,null,"code.gitea.io/gitea")," prefixes."),"\n",n.createElement(t.h3,{id:"7568m-2023-09-05-540bf9f",style:{position:"relative"}},n.createElement(t.a,{href:"#7568m-2023-09-05-540bf9f","aria-label":"7568m 2023 09 05 540bf9f permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"7,568m")," 2023-09-05 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/540bf9fa6d0d86297c9d575640798b718767bd9f"},"540bf9f"),")"),"\n",n.createElement(t.p,null,"And whush, I just dropped through to before the Forgejo fork.\nHere the Gitea developers changed the pub-sub broker package from ",n.createElement(t.code,null,"code.gitea.io/gitea/modules/notification/base.Notifier")," to ",n.createElement(t.code,null,"code.gitea.io/gitea/services/notify.Notifier"),".\nAdjust the script and continue."),"\n",n.createElement(t.h3,{id:"10956m-2022-03-16-ed1d95c",style:{position:"relative"}},n.createElement(t.a,{href:"#10956m-2022-03-16-ed1d95c","aria-label":"10956m 2022 03 16 ed1d95c permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"10,956m")," 2022-03-16 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/ed1d95c55dfa91d1c9a486bfb8e00375d4038e29"},"ed1d95c"),")"),"\n",n.createElement(t.p,null,"My script crashed here below this commit, which upgrades from ",n.createElement(t.code,null,"go1.17")," to ",n.createElement(t.code,null,"go1.18"),".\nApparently ",n.createElement(t.code,null,"golang.org/x/tools/go/packages")," requires ",n.createElement(t.code,null,"go mod tidy")," to run on a ",n.createElement(t.code,null,"go1.17")," project.\nI adjusted my script accordingly and let it run for the night.\nWhen I woke up the next morning I noticed that my Nextcloud instance was down.\nAfter quickly logging into my server I realized it entirely ran out of disk space, whups.\nThe ",n.createElement(t.code,null,"~/go")," directory grew so large with Forgejos's many old dependencies it completely crippled my server.\nRunning my script in a Docker container didn't help here."),"\n",n.createElement(t.h3,{id:"12264m-2021-06-23-17030ce",style:{position:"relative"}},n.createElement(t.a,{href:"#12264m-2021-06-23-17030ce","aria-label":"12264m 2021 06 23 17030ce permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"12,264m")," 2021-06-23 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/17030ced75059ec21f6fb1945a751c3ebef29a32"},"17030ce"),")"),"\n",n.createElement(t.p,null,"Here a problem occurred when I re-ran my script with older versions of Go (more info on that below).\nSomehow ",n.createElement(t.code,null,"go1.14")," failed to ",n.createElement(t.code,null,"go1.14 mod tidy")," below this commit.\nThough my up-to-date ",n.createElement(t.code,null,"go1.25.3")," did work so my script now uses the new Go version whenever the old one fails."),"\n",n.createElement(t.h3,{id:"15946m-2019-09-12-3f5cdfe",style:{position:"relative"}},n.createElement(t.a,{href:"#15946m-2019-09-12-3f5cdfe","aria-label":"15946m 2019 09 12 3f5cdfe permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"~",n.createElement(t.em,null,"15,946m")," 2019-09-12 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/3f5cdfe35905730ced41397c6ccd50df3804b5ec"},"3f5cdfe"),")"),"\n",n.createElement(t.p,null,"I forgot\nTODO"),"\n",n.createElement(t.pre,null,n.createElement(t.code,{className:"language-bash"},"2312  vit bisect start\ngit bisect start\ngit bisect old d77176912bccf1dc0ad93366df55f00fee23b498\ngit bisect new forgejo\ncat go.mod | grep -P '^go ' | cut -d ' ' -f2\n# 1.20\ngit bisect new\n# --snip--\n")),"\n",n.createElement(t.h3,{id:"16625m-2019-03-27-d578b71",style:{position:"relative"}},n.createElement(t.a,{href:"#16625m-2019-03-27-d578b71","aria-label":"16625m 2019 03 27 d578b71 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"16,625m")," 2019-03-27 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/d578b71d61ee8131e8abf7f538b93d8c6cc6fe6d"},"d578b71"),")"),"\n",n.createElement(t.p,null,"This commit moves the code base from ",n.createElement(t.code,null,"code.gitea.io/git")," to ",n.createElement(t.code,null,"code.gitea.io/gitea"),".\nUff, okay, I added another rename option."),"\n",n.createElement(t.h3,{id:"16940m-2019-01-13-beab2df",style:{position:"relative"}},n.createElement(t.a,{href:"#16940m-2019-01-13-beab2df","aria-label":"16940m 2019 01 13 beab2df permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"16,940m")," 2019-01-13 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/beab2df1227f9b7e556aa5716d94feb3a3e2088e"},"beab2df"),")"),"\n",n.createElement(t.p,null,"And another rename.\nThis commit moves the broker struct from ",n.createElement(t.code,null,"modules/notification/base/base.go")," to ",n.createElement(t.code,null,"modules/notification/base/notifier.go"),"."),"\n",n.createElement(t.h3,{id:"16141m-2019-07-25-5efd363",style:{position:"relative"}},n.createElement(t.a,{href:"#16141m-2019-07-25-5efd363","aria-label":"16141m 2019 07 25 5efd363 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"16,141m")," 2019-07-25 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/5efd3630bc21d4b0ba6ff492d16d4c7e2814dd1f"},"5efd363"),")"),"\n",n.createElement(t.p,null,"Things get pretty icky down here:\nThere's a problem with the xorm dependency.\nThis commit updates to xorm ",n.createElement(t.code,null,"v0.7.4")," but the old ",n.createElement(t.code,null,"v0.7.3-0.20190620151208-f1b4f8368459")," fails with ",n.createElement(t.code,null,"go mod tidy"),".\nI don't know why but my fix is as hacky as it is simple:"),"\n",n.createElement(t.pre,null,n.createElement(t.code,{className:"language-bash"},"sed -i 's#github.com/go-xorm/xorm v0.7.3-0.20190620151208-f1b4f8368459#github.com/go-xorm/xorm v0.7.3#' go.mod\n")),"\n",n.createElement(t.p,null,"Btw, this is the old xorm repo before it got moved to a Gitea server.\nI'm glad the old repo is only archived and not deleted.\nOtherwise, I'd have to do more work here.",n.createElement("br"),"\nCome to think of it, there are a lot of old dependency versions we rarely care about.\nIf they are lost, we won't be able to build old versions of our software.\nThat might be a real trouble if we want to reproduce some problem with outdated software."),"\n",n.createElement(t.h3,{id:"16624m-2019-03-27-d771769",style:{position:"relative"}},n.createElement(t.a,{href:"#16624m-2019-03-27-d771769","aria-label":"16624m 2019 03 27 d771769 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"16,624m")," 2019-03-27 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/d77176912bccf1dc0ad93366df55f00fee23b498"},"d771769"),")"),"\n",n.createElement(t.p,null,"We are so far below the surface we don't even have a ",n.createElement(t.code,null,"go.mod")," file anymore.\nGitea used ",n.createElement(t.code,null,"Gopkg.lock")," before this commit."),"\n",n.createElement(t.pre,null,n.createElement(t.code,{className:"language-bash"},"if [ ! -f go.mod ]; then\n    go mod init\nfi\n")),"\n",n.createElement(t.h3,{id:"17177m-2018-10-18-ea619b3",style:{position:"relative"}},n.createElement(t.a,{href:"#17177m-2018-10-18-ea619b3","aria-label":"17177m 2018 10 18 ea619b3 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"17,177m")," 2018-10-18 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/ea619b39b2f2a3c1fb5ad28ebd4a269b2f822111"},"ea619b3"),")"),"\n",n.createElement(t.p,null,"Here, my script threw its final error: Empty output.",n.createElement("br"),"\nThere's no more pub-sub pattern to look for below this.\nThis commit is where the pub-sub pattern was created.\nThis commit is the bottom of the well our light just hit.\nThis is the end of our pub-sub journey.\nAlas, we could still check how much rock there is below the well."),"\n",n.createElement(t.h3,{id:"23913m-2014-02-11-475e347",style:{position:"relative"}},n.createElement(t.a,{href:"#23913m-2014-02-11-475e347","aria-label":"23913m 2014 02 11 475e347 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),n.createElement(t.em,null,"23,913m")," 2014-02-11 (",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/475e3471b4e8da8776fe7e66a3390c8a30c19f08"},"475e347"),")"),"\n",n.createElement(t.p,null,"And this is it, the very first commit in Forgejo's history.\nWe are so far back, the isn't named Forgejo or Gitea anymore, down here the project goes by the name Gogs.\nNow there really isn't any deeper to go."),"\n",n.createElement(t.h2,{id:"what-the-visualization-shows",style:{position:"relative"}},n.createElement(t.a,{href:"#what-the-visualization-shows","aria-label":"what the visualization shows permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"What the Visualization Shows"),"\n",n.createElement(t.p,null,"Firstly, there used to be a topic no package ever sent a message to, ",n.createElement(t.code,null,"NotifyPullRevieweDismiss"),".\nIt was removed ",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/d17aa98262480c17051c66353ac4ec300ab8033c"},"in June")," and we can see that in the visualization.",n.createElement("br"),"\nThen there's my contribution to Forgejo: the ",n.createElement(t.code,null,"ActionRunNowDone")," topic.\nThe visualization shows how I implemented the topic without any sending packages at first.\nIn a second commit I attach the ",n.createElement(t.code,null,"services/mailer")," and in a third ",n.createElement(t.code,null,"services/webhook")," package.",n.createElement("br"),"\nLastly, I found some very strange behaviour from December 2022 to September 2023.\n",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/c53f802778c1951e0804507eec995bca37f1b09b"},"c53f802")," removed the ",n.createElement(t.code,null,"Notify")," prefix from all topics.\nOn the very next day ",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/a89b399faa275c28d0ffe9759d492636f67d6da0"},"a89b399")," reverted that.\nThis goes back and forth a lot, which explains the jarring visualization around this time.\nIn the end ",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/540bf9fa6d0d86297c9d575640798b718767bd9f"},"540bf9f")," removed the ",n.createElement(t.code,null,"Notify")," prefix for the last time.\nMaybe this is a broken bit in the Forgejo git history?",n.createElement("br"),"\nAs of ",n.createElement(t.a,{href:"https://codeberg.org/forgejo/forgejo/commit/9524b8c3702e204d9f942090acb39a3549c80ca8"},"9524b8c")," there's still some dead code.\nThe ",n.createElement(t.code,null,"Run")," topic is never sent a message to and no one listens to the ",n.createElement(t.code,null,"DeleteIssue")," topic.\nOne could automate a check like this, maybe in CI."),"\n",n.createElement(t.h2,{id:"conclusion",style:{position:"relative"}},n.createElement(t.a,{href:"#conclusion","aria-label":"conclusion permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Conclusion"),"\n",n.createElement(t.p,null,"This really felt like diving into the abyss.\nI never knew what would be below and when my script failed the next time.\nIt also gave me chills, working with such large code bases, with such history every day.\nThere is so much knowledge"),"\n",n.createElement(t.p,null,"TZ=UTC0 git show --no-patch --date=local '--format=%ci' 346f87d7a26d7c3678867961c74487e5b759cbf0 && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' 2457f5ff2293f69e6de5cc7d608dd210f6b8e27a && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' 540bf9fa6d0d86297c9d575640798b718767bd9f && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' ed1d95c55dfa91d1c9a486bfb8e00375d4038e29 && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' 17030ced75059ec21f6fb1945a751c3ebef29a32 && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' d578b71d61ee8131e8abf7f538b93d8c6cc6fe6d && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' beab2df1227f9b7e556aa5716d94feb3a3e2088e && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' 5efd3630bc21d4b0ba6ff492d16d4c7e2814dd1f && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' d77176912bccf1dc0ad93366df55f00fee23b498 && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' ea619b39b2f2a3c1fb5ad28ebd4a269b2f822111 && ",n.createElement(t.br),"\n","TZ=UTC0 git show --no-patch --date=local '--format=%ci' 475e3471b4e8da8776fe7e66a3390c8a30c19f08"),"\n",n.createElement(t.p,null,"TZ=UTC0 git show --no-patch --date=local '--format=%ci' 16dbc0efd350cdc15760c2e40346c1e9fbb0bd01\ngit rev-list --count 16dbc0efd350cdc15760c2e40346c1e9fbb0bd01..346f87d7a26d7c3678867961c74487e5b759cbf0"),"\n",n.createElement(t.p,null,"2025-10-27 08:34:00 +0100\n2025-03-27 19:40:14 +0000\n2023-09-05 18:37:47 +0000\n2022-03-16 00:08:31 -0400\n2021-06-23 00:14:22 -0400\n2019-03-27 17:33:00 +0800\n2019-01-13 16:42:55 +0200\n2019-07-25 00:39:14 +0300\n2019-03-27 19:15:23 +0800\n2018-10-18 19:23:05 +0800"),"\n",n.createElement(t.h3,{id:"somewhere-are-go112",style:{position:"relative"}},n.createElement(t.a,{href:"#somewhere-are-go112","aria-label":"somewhere are go112 permalink",className:"anchor before"},n.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"somewhere are go1.12"),"\n",n.createElement(t.p,null,"This process took a few days and just like the light falling into the abyss, I didn't know what comes next."))}var l=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,o.R)(),e.components);return t?n.createElement(t,e,n.createElement(r,e)):r(e)};var c=a(5365),i=a(2224),s=a(9121),h=a(4241),d=a(4810),m=a(1244),f=a(5071),u=a(9105),g=a(6897),b=a(7629),p=a(8029),v=a(1042),E=a(5526),w=a(5969);const y={AutoPlayVideo:f.A,HalfImage:u.A,Spacer:g.A,Quote:b.A,Iframe:p.A,CompareView:m.A,pre:e=>{let{children:t}=e;return n.createElement("div",{className:"code-container"}," ",n.createElement("pre",null,t))},code:e=>{let{children:t,className:a}=e;return a?n.createElement(E.A,{className:a},t):n.createElement("code",{className:"language-text"},t)},a:w.A},S=e=>{var t,a,r,l,m,f,u,g,b,p,v,E,w,S;let{data:k,children:j}=e;const H=null===(t=k.mdx)||void 0===t||null===(a=t.frontmatter)||void 0===a?void 0:a.version,T=null===(r=k.mdx)||void 0===r||null===(l=r.frontmatter)||void 0===l?void 0:l.title,I=/^0\./.test(H)?`Draft v${H}`:void 0,_=null===(m=k.mdx)||void 0===m||null===(f=m.frontmatter)||void 0===f?void 0:f.date,x=null!=(null===(u=k.mdx)||void 0===u||null===(g=u.frontmatter)||void 0===g?void 0:g.title_banner),C={"--banner-image-horizontal-position":null===(b=k.mdx)||void 0===b||null===(p=b.frontmatter)||void 0===p?void 0:p.title_banner_horizontal_position,"--banner-image-vertical-position":null===(v=k.mdx)||void 0===v||null===(E=v.frontmatter)||void 0===E?void 0:E.title_banner_vertical_position};return n.createElement(c.A,{heading:T,sub_heading:I,banner_image:x?null===(w=k.mdx)||void 0===w||null===(S=w.frontmatter)||void 0===S?void 0:S.title_banner:void 0,banner_image_style:C,small_banner:!0,banner_content:n.createElement("div",{className:`${i.yu} ${x?i.Lx:void 0}`},n.createElement("span",{className:i.cy},"Written by Christopher Besch, published on "),_)},n.createElement("div",{className:s.xo},n.createElement(o.x,{components:y},j)),n.createElement(d.N_,{className:`${h.om} ${h.nf}`,to:"/articles"},"More Articles"))};function k(e){return n.createElement(S,e,n.createElement(l,e))}const j=e=>{var t,a,o,r,l,c;let{data:i}=e;const s=null===(t=i.mdx)||void 0===t||null===(a=t.frontmatter)||void 0===a?void 0:a.title,h=null===(o=i.mdx)||void 0===o||null===(r=o.frontmatter)||void 0===r?void 0:r.description,d=null===(l=i.mdx)||void 0===l||null===(c=l.frontmatter)||void 0===c?void 0:c.banner,m=d&&"undefined"!=d?d:void 0;return n.createElement(v.A,{heading:s,description:h,banner:m})}}}]);
//# sourceMappingURL=component---src-templates-article-tsx-content-file-path-src-articles-19-forgejo-pub-sub-pattern-history-forgejo-pub-sub-pattern-history-md-8c4d0ca42abb6ef1254e.js.map