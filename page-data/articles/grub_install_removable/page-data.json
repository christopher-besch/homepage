{"componentChunkName":"component---src-templates-article-tsx-content-file-path-src-articles-08-grub-install-removable-grub-install-removable-md","path":"/articles/grub_install_removable/","result":{"data":{"mdx":{"body":"\nOn my quest of ridding my family from Windows I was faced with a particularly interesting Debian 12 installation.\nWhat's so *interesting* about this one?\n\nApart from the dog slow HDD the Debian installer chugs along just fine—until...`grub-install dummy`.\nIt doesn't fail, it just hangs.\n\nMaybe get some cake and check on it afterwards...\nNo, still hanging there.\nBattery-disconnect it is—click.\n\nReboot, hit up the live-USB's shell and see what the hell happened.\nLet's chroot into the broken install:\n```bash\n# from: https://unix.stackexchange.com/questions/541489/grub-fails-to-install-during-debian-10-installer-re-uefi-supermicro-motherboa\nmkdir /target\nmount /dev/sdX2 /target\nmount /dev/sdX1 /target/boot/efi\nmount -o rbind /dev /target/dev \nmount -t proc proc /target/proc \nmount -t sysfs sys /target/sys \nmount -t efivarfs efivarfs /target/sys/firmware/efi/efivars \nchroot /target/ \n```\n\nEverything looks fine so let's fix that GRUB2 installation.\n```bash\ngrub-install --verbose /dev/sdX\n```\nAnd...drum roll...it hangs—at trying to `modprobe efivars`.\nHuh, why's that?\n\nLet's try something:\n```\ngrub-install --verbose --no-nvram /dev/sdX\n```\nAnd...it works—in that it finishes without errors.\nBut now the laptop fails to find the new Debian installation and only let's me boot back into the live-USB.\n\nWith the `--no-nvram` option we at least get through the GRUB2 installation.\nIt appears the cheapo laptop's UEFI is bugged causing Linux trouble with editing the motherboard's NVRAM.\nCool, why is that bad?\n\n`grub-install` wants to make the UEFI aware of the new bootloader.\nIt does so by storing the bootloader's location in non-volatile RAM of the motherboard.\nThen your shiny-new bootloader appears in the UEFI boot options and you can boot.\n\nThat doesn't work here, so what now?\n\n## `--removable` to the Rescue\n\nThing is, not all installation can rely on the NVRAM—for example a live-USB.\nWhen plugging in a live-USB the UEFI needs to be able to boot from it even though it has never seen it before.\nThat's what the fallback bootloader path (`EFI/boot/bootx64.efi`) is for.\nThe UEFI doesn't just look in it's NVRAM for bootloaders but also checks that path on all attached drives.\n\nSo let's do that instead:\n```bash\ngrub-install --removable /dev/sdX\ngrub-update\n```\nAnd after a reboot we're greeted with the GRUB2 shell.\nWhoho!\nProgress!\nThe GRUB2 shell is nice, but we need more.\nApparently GRUB2 is missing something so let's again check with the live-USB.\nReboot, chroot and run:\n```bash\napt-get install grub-efi-amd64\n```\nSo the installation was interrupted—makes sense I did disconnect the battery.\nLet's fix that:\n```bash\n# from: https://askubuntu.com/questions/425502/how-do-i-continue-configuration-if-apt-get-was-interrupted\napt-get clean\napt-get -f install\ndpkg-reconfigure -a\n```\nNow GRUB2 installs correctly and appears to remember my wish to use `--removable`.\nReboot and we actually boot into the new Debian installation.\nWe just can't login yet because there's something missing still.\n\n## Finishing the Installation\nAs we interrupted the Debian installer there's one step left to do, the \"Finish the installation\" step.\nIt appears the user is created by this step so skipping it leaves us without a user to login with.\nFix that with:\n```bash\nuseradd my_user\nuseradd sudo my_user\nuseradd netdev my_user\n```\n\nI also had to [set the network to managed](https://askubuntu.com/questions/71159/network-manager-says-device-not-managed) and remove the live-USB package repository from `/etc/apt/sources.list`.\n\nIf I had to do this again, I'd use the expert install mode and simply skip the automated GRUB2 installation step.\nThat should allow me to run the original \"Finish the installation\" step before installing GRUB2 manually.\n\nPS: The cheapo laptop was an Acer Aspire es 17 (aspire es1-732).\n","frontmatter":{"date":"Friday, 8th November, 2024","title":"grub-install --removable for buggy UEFI","description":" Install Debian on a device with a broken NVRAM. ","banner":"/social_banner/debian_grub.png","title_banner":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABRyLrJkGX/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAECERID/9oACAEBAAEFAtEm2R6SS0XZqj//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGI/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQIBAT8BpT//xAAWEAEBAQAAAAAAAAAAAAAAAAAAMSD/2gAIAQEABj8CVcf/xAAZEAADAQEBAAAAAAAAAAAAAAAAARFBYYH/2gAIAQEAAT8h5ZpGs4QqnwTSlhu0R//aAAwDAQACAAMAAAAQ78//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QksP/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QttP/xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFhgf/aAAgBAQABPxDFBK3ccLK0WBzScBBpZW/kxFssO6jSyj2f/9k="},"images":{"fallback":{"src":"/static/1b10ddadbd8493dd34ecb82578bb460f/5267c/alpha_sierra.jpg","srcSet":"/static/1b10ddadbd8493dd34ecb82578bb460f/fa695/alpha_sierra.jpg 480w,\n/static/1b10ddadbd8493dd34ecb82578bb460f/a0d3e/alpha_sierra.jpg 960w,\n/static/1b10ddadbd8493dd34ecb82578bb460f/5267c/alpha_sierra.jpg 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/1b10ddadbd8493dd34ecb82578bb460f/95a23/alpha_sierra.webp 480w,\n/static/1b10ddadbd8493dd34ecb82578bb460f/5bdbe/alpha_sierra.webp 960w,\n/static/1b10ddadbd8493dd34ecb82578bb460f/9c00f/alpha_sierra.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1280}}},"title_banner_horizontal_position":"40%","title_banner_vertical_position":"60%","version":"1.0.0"}}},"pageContext":{"id":"00d37985-84f9-5fcf-85d0-050f715459f8","frontmatter":{"type":"article","title":"grub-install --removable for buggy UEFI","description":" Install Debian on a device with a broken NVRAM. ","banner":"/social_banner/debian_grub.png","thumb":"../../../static/social_banner/debian_grub.png","title_banner":"../../images/photography/alpha_sierra.jpg","title_banner_horizontal_position":"40%","title_banner_vertical_position":"60%","slug":"grub_install_removable","date":"2024-11-08T00:00:00.000Z","listed":true,"version":"1.0.0"}}},"staticQueryHashes":["1754054404","1995789189","475732191"],"slicesMap":{}}