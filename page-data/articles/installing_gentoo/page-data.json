{"componentChunkName":"component---src-templates-article-tsx-content-file-path-src-articles-03-installing-gentoo-installing-gentoo-md","path":"/articles/installing_gentoo/","result":{"data":{"mdx":{"body":"import cpu_usage from \"./cpu_usage.png\";\nimport pavucontrol from \"./pavucontrol.png\";\nimport xfce_system_defaults_keyboard_layout from \"./xfce_system_defaults_keyboard_layout.png\";\nimport firefox_keyword_enabled from \"./firefox_keyword_enabled.png\";\nimport firefox_search_bar from \"./firefox_search_bar.png\";\nimport stage3_download from \"./stage3_download.png\";\nimport my_desktop from \"./my_desktop.png\";\nimport unixporn from \"./unixporn.png\";\nimport bash_completion from \"./bash_completion.mp4\";\nimport vm_snapshots from \"./vm_snapshots.png\";\n\nGentoo is a Linux distribution that offers as many options as possible.\nWhile its package manager Portage leverages the heavy lifting, you have to deal with the choosing such freedom entails:\nWhat init system causes the least amount of pain with the software you intend to run, what desktop suits your personal style and which display manager goes best with that?\n\nI've setup Gentoo countless times with different decisions along the way.\nWhile dysfunctional combinations butchered some of those installations beyond repair, others became my daily driver for weeks and months.\nIn the end I might not have become an expert but I surely did learn a lot during this endeavour.\nSo this opinionated article documents said endeavour, all choices I made, any problems I encountered and their subsequent solutions.\n\n<HalfImage src={vm_snapshots} />\n\nIf you decide to try Gentoo for yourself, I'd recommend doing so in a virtual machine instead of directly on your hardware.\nVMs allow you to save snapshots before each step.\nThus when you screw something up—and trust me you will—you can simply go back.\nPlease don't write me any angry emails after you accidentally deleted your family photos lacking a backup ;)\n\n### Table of Contents\n{\n<ul>\n<li><a href=\"#choices-along-the-way\">Choices Along the Way</a></li>\n<li><a href=\"#installing-gentoo\">Installing Gentoo</a>\n<ul>\n<li><a href=\"#gpt-uefi-vs-mbr-legacy-bios\">GPT, UEFI vs. MBR, Legacy BIOS</a>\n<ul>\n<li><a href=\"#fstab\">fstab</a></li>\n</ul>\n</li>\n<li><a href=\"#systemd\">systemd</a></li>\n<li><a href=\"#genkernel-and-grub-2\">genkernel and GRUB 2</a>\n<ul>\n<li><a href=\"#os-prober\">os-prober</a></li>\n</ul>\n</li>\n<li><a href=\"#interjection-installing-with-portage\">Interjection: Installing with Portage</a></li>\n<li><a href=\"#xfce\">Xfce</a>\n<ul>\n<li><a href=\"#sddm\">SDDM</a></li>\n</ul>\n</li>\n<li><a href=\"#wi-fi\">Wi-Fi</a></li>\n<li><a href=\"#programs-i-use\">Programs I Use</a>\n<ul>\n<li><a href=\"#kitty\">Kitty</a></li>\n<li><a href=\"#lunarvim\">Lunarvim</a></li>\n<li><a href=\"#noisetorch\">Noisetorch</a></li>\n<li><a href=\"#git\">Git</a></li>\n<li><a href=\"#latex\">LaTeX</a></li>\n<li><a href=\"#ocrmypdf\">OCRmyPDF</a></li>\n<li><a href=\"#obs-studio\">OBS Studio</a></li>\n<li><a href=\"#firefox\">Firefox</a></li>\n<li><a href=\"#qemu-and-virt-manager\">QEMU and Virt-manager</a></li>\n<li><a href=\"#nodejs\">Node.js</a></li>\n</ul>\n</li>\n<li><a href=\"#disabling-the-pc-speaker\">Disabling the PC Speaker</a></li>\n</ul>\n</li>\n<li><a href=\"#wrapping-up\">Wrapping Up</a>\n<ul>\n<li><a href=\"#config-collection\">Config Collection</a></li>\n<li><a href=\"#cheat-sheet\">Cheat Sheet</a></li>\n<li><a href=\"#what-remains\">What Remains</a></li>\n</ul>\n</li>\n</ul>\n}\n\n<Spacer />\n\n# Choices Along the Way\nThe [Gentoo Handbook (AMD64)](https://wiki.gentoo.org/wiki/Handbook:AMD64) is such a great tutorial that there is basically nothing left for me to add.\nInstead I'll go through the decisions leading to a system of my liking.\nIf a choice is not explained, I chose the default or non-extra option as explained in the handbook.\nWhen you stumble upon some concepts you are unfamiliar with, you should take a look at the handbook or [Gentoo wiki](https://wiki.gentoo.org).\nI should also add that the choices available to you and my opinion change with time.\nIn a few years this article may very well mostly consist of outdated information, so make sure to always consult up-to-date references, like the Gentoo Handbook.\n\n# Installing Gentoo\n\n## GPT, UEFI vs. MBR, Legacy BIOS\nThere are two different ways of partitioning your disk, GPT and MBR.\nThey are closely tied to the two boot process types, UEFI and legacy BIOS.\n[The handbook](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Disks) explains the differences more closely so I'll leave it at stating that I used the modern GPT, UEFI option.\n\n### fstab\nThe `/etc/fstab` file defines what partitions should be mounted where and how.\nThis is explained in [later chapters of the handbook](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/System).\n\nTo address a partition you can choose between filesystem labels and UUIDs.\nWhile labels like `/dev/sdb3` are easier to comprehend than UUIDs (e.g. `0b04fdcc-6d7f-4a88-bf57-1c2965bf8ceb`), UUIDs are a lot less risky.\nThis is because labels are defined by the order the devices get detected by the kernel.\nAnd this order can change, for example when adding or replacing disks.\nUUIDs on the other hand don't change.\n\nTo convert labels to UUIDs you can use the `blkid` command like this:\n```bash\n~ λ blkid\n/dev/sdb1: UUID=\"A76D-24D1\" [...]\n/dev/sdb2: UUID=\"c8211424-0c21-4eec-aa92-9cc4a9c043bf\" [...]\n/dev/sdb3: UUID=\"0b04fdcc-6d7f-4a88-bf57-1c2965bf8ceb\" [...]\n[...]\n```\n\nSo my fstab looks like this:\n```bash\nUUID=A76D-24D1                            /boot vfat defaults,noatime 0 2\nUUID=c8211424-0c21-4eec-aa92-9cc4a9c043bf none  swap sw               0 0\nUUID=0b04fdcc-6d7f-4a88-bf57-1c2965bf8ceb /     ext4 noatime          0 1\n```\n\n## systemd\nTo install the operating system, a few tools need to be available.\nThese are the first things your soon to be Linux installation gets to consist out of, or in other words its primordial soup.\nThis primordial soup, correctly called stage 3, comes in a few varieties:\n<HalfImage src={stage3_download} />\n\nI want a system with a desktop, so I chose the appropriate desktop profile.\nAnd then there's the matter of the init system.\n\nOn Linux the init system is the first program that starts once the kernel has booted up.\nWith Gentoo you can use whatever init system you like but the usual options are OpenRC and systemd.\nOpenRC is Gentoo's default.\nWhen you choose to use systemd, you should read the [systemd article](https://wiki.gentoo.org/wiki/Systemd).\n\nI'm used to systemd and wanted to try something non-default so I went with that on my final installation.\nIn my experience the handbook makes a good job at explaining what you have to do differently when using systemd.\nThe only thing I noticed to be missing was [the NTP to synchronize your clock `sudo timedatectl set-ntp true`](https://wiki.gentoo.org/wiki/Systemd#Time_and_date)—something you realize very quickly when daylight saving starts.\nSo you should nevertheless refer to the systemd article.\n\n<Spacer />\n\n## genkernel and GRUB 2\nAt some point you have to decide how you intend to install the Linux kernel.\nMy first attempts used the [manual configuration](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Manual_configuration), which always caused trouble but would theoretically result in a very clean build.\nOn my final installation I ended up using the much simpler to use [genkernel](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Alternative:_Using_genkernel), with which I had no problems whatsoever.\n\nOnce the kernel is installed and a few other steps in the handbook have been traversed, you get to the stage of choosing a bootloader.\nThe bootloader is the piece of software starting the kernel after the power button has been pressed.\nAs described in the [systemd article](https://wiki.gentoo.org/wiki/Systemd#GRUB_2) it is crucial to edit `/etc/default/grub` and add this line:\n```bash\n[...]\n# Append parameters to the linux kernel command line\nGRUB_CMDLINE_LINUX=\"init=/lib/systemd/systemd\"\n[...]\n```\nOtherwise the kernel wouldn't launch systemd and leave you stranded on a black screen with a kernel panic.\n\nI also have to add this to my `/etc/portage/make.conf` before emerging `sys-boot/grub` because I'm using the UEFI boot process.\n```bash\n[...]\nGRUB_PLATFORMS=\"efi-64\"\n[...]\n```\n\n### os-prober\nBecause I enjoy playing games from time to time, Windows still does a better job at that and I like separating work and play, I'm running a Gentoo-Windows dual boot.\nTo be prompted at every boot which OS you want to endure at the moment, you need os-prober.\nYou can install it with `emerge --ask sys-boot/os-prober` and have to enable it in `/etc/default/grub`:\n```bash\n[...]\nGRUB_DISABLE_OS_PROBER=false\n[...]\n```\nos-prober doesn't run at every boot, instead it only looks for any other bootable partitions when you `grub-mkconfig -o /boot/grub/grub.cfg` and makes grub aware of them.\n\n## Interjection: Installing with Portage\nOn Gentoo the Portage package manager takes care of compiling, installing, cataloging, uninstalling of programs and much much more.\nThe slang word for installing something with Portage is to `emerge` that package.\nYou can emerge a package with `emerge --ask [package name]`.\nPackage names look like this: `media-gfx/gimp`, a category and the name of the program.\nSometimes this command prompts you to set some USE flags.\nThese can either be set in `/etc/portage/make.conf` [to affect all packages](https://wiki.gentoo.org/wiki//etc/portage/make.conf#USE) or in `/etc/portage/package.use` [to not alter the global USE flags](https://wiki.gentoo.org/wiki//etc/portage/package.use).\nMy `make.conf` and `package.use` can be found in my [config collection](https://github.com/christopher-besch/configs) under the Gentoo section.\n\n## Xfce\nI use the terminal emulator for **everything**.\nUsually nothing graphical, besides it and Firefox, is running.\nSo my focus lies entirely on making the terminal as pleasant and efficient to use as possible.\nTherefore I'm using the most lightweight and least painful desktop environment I could find, Xfce.\nOut of the box it doesn't look as fancy as your average [r/unixporn](https://www.reddit.com/r/unixporn) post but you can tailor it to your liking—which I promptly didn't do.\n\nSo my desktop looks as basic as you can get:\n<HalfImage src={my_desktop} full={true} />\n\nBut if pretty graphics are your cup of tee, take a look at what [u/linuxscoop](https://www.reddit.com/user/linuxscoop) managed to do with Xfce:\n<HalfImage src={unixporn} full={true} />\n\n<Spacer />\n\nComing back to Gentoo, there's an article on [installing Xfce](https://wiki.gentoo.org/wiki/Xfce) you should follow.\nThis most notably includes selecting an appropriate profile when [installing the base system](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base#Choosing_the_right_profile).\n\nThere are a few extra packages I like to complement Xfce with.\n- `xfce-extra/xfce4-screenshooter`: A simple screenshot tool.\n<HalfImage src={cpu_usage} />\n- `xfce-extra/xfce4-cpugraph-plugin`: Show your current CPU usage in the task bar.\n- `xfce-extra/xfce4-notifyd`: Enable notifications.\n<HalfImage src={pavucontrol} />\n- `media-sound/pavucontrol`: Allow for more fine grained control over your audio devices.\n- `media-fonts/fonts-meta`: Install non-Latin character set.\n- `media-fonts/noto-emoji`: Install emojis.\n\nSince I use VI as my editor, which requires pressing Escape very often and I never understood why anyone would want to use Caps Lock, I bind my Caps Lock key to Escape.\nOn a system using Xorg, which mine is, this can be achieved using an `.Xmodmap` file in your home directory:\n```bash\n! make caps key perform escape action\nremove Lock = Caps_Lock\nkeysym Caps_Lock = Escape\n```\nIt is part of my [config collection](https://github.com/christopher-besch/configs).\n\n<Spacer />\n\n### SDDM\nWithout a display manager your newly booted up system presents you only with a terminal—even when Xfce is installed.\nTo give you a graphical login prompt and launch Xfce, you need something like [SDDM](https://wiki.gentoo.org/wiki/SDDM).\nIt is one of many [display managers](https://wiki.gentoo.org/wiki/Display_manager) out there.\nFeel free to play around with other options, SDDM is only the first one I tried and that fulfills all my simple needs.\n(Don't forget to activate its daemon with `systemctl enable sddm.service`.)\n\nTo set the keyboard layout for the login screen—what Xfce calls it's \"system defaults\"—you have to create the `/usr/share/sddm/scripts/Xsetup` script.\n<HalfImage src={xfce_system_defaults_keyboard_layout} />\n\nThis sets it to the UK keyboard layout:\n```bash\n#!/bin/sh\n# Xsetup - run as root before the login dialog appears\nsetxkbmap \"gb\"\n```\n`setxkbmap` is a command you have to install first with `emerge --ask x11-apps/setxkbmap`.\n\n<Spacer />\n\n## Wi-Fi\nWhen you only use Ethernet, you can simply [install dhcpcd](https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/System#DHCP_via_dhcpcd_.28any_init_system.29) (among other).\nIf you instead rely on Wi-Fi, you should use NetworkManager.\n\nThe installation is described [here](https://wiki.gentoo.org/wiki/NetworkManager);\nthis paragraph only summarizes the most important steps.\nYou have to enable the `networkmanager` and `wifi` USE flags, update your system using `emerge --ask --changed-use --deep @world` and install NetworkManager `emerge --ask net-misc/networkmanager`.\nA really useful but not mandatory addition is `gnome-extra/nm-applet`.\nIt offers a graphical interface for connecting to networks.\n\n## Programs I Use\nInstalling software on Gentoo is often as simple as emerging the appropriate package.\nFor me this means installing:\n\n- `app-admin/keepass`: A local password manager.\n- `net-im/discord-bin`: A chat program everyone uses and hates at the same time.\n- `app-text/tree`: A convenient way of displaying folder structures in the terminal.\n- `app-text/pdftk`: A **T**ool**K**it for handling **PDF**s in the terminal.\n- `media-gfx/gimp`: The **G**NU **I**mage **M**anipulation **P**rogram.\n- `app-text/pdfgrep`: Searching in PDFs with the familiar GREP syntax.\n- `sys-apps/exa`: A colourful replacement for `ls`.\n- `app-editors/vim`: Quite useful when you don't want to go through the hassle of [installing Lunarvim](#lunarvim) during setup.\n- `app-portage/gentoolkit`: A few useful tools for working with Portage.\n- `app-portage/genlop`: Estimate compilation time with Portage.\n- `media-video/vlc`: You've got some obscure media format to play? VLC can handle it.\n- `sys-process/time`: Display resources used by a program.\n\nWhat follows are a few more programs with more complicated installations.\n\n### Kitty\nMy terminal emulator of choice is Kitty, mainly because it supports displaying images directly in the terminal.\nUnfortunately you have to jump through a few hoops to install it on Gentoo, because it's still in the testing branch.\nRefer to the [Kitty on Gentoo article](https://wiki.gentoo.org/wiki/Kitty) for installation instructions.\nTo be able to show images in the terminal, you also have to install `media-gfx/imagemagick`.\nMy kitty config is also part of my [config collection](https://github.com/christopher-besch/configs).\n\n### Lunarvim\nLunarvim forms a configuration layer on top of Neovim and is the text editor I used for writing this article.\nNeovim, in turn, is a fork of vim, which is the **i**mproved of version of **vi**.\n\nLunarvim has a few requirements:\n- `sys-apps/fd`\n- `x11-misc/xclip`\n- Neovim latest\n\nThe last one is a problem since the version Portage supplies is too old so you have to [compile Neovim yourself](https://github.com/neovim/neovim/wiki/Building-Neovim#building).\nAfter Lunarvim has been installed, you can copy my config, which, again, can be found in my [config collection](https://github.com/christopher-besch/configs).\n\n### Noisetorch\nI spend a lot of time in voice calls so good noise suppression is absolutely vital.\nNoisetorch does a good job at that and filters out my hammering on the keyboard while leaving my voice untouched.\nTo install it you have to extract a tarball in your home directory.\nThis is explained [here](https://github.com/lawl/NoiseTorch#download--install).\n\n### Git\n<AutoPlayVideo src={bash_completion} width={600} height={280} />\n\nTo make git work the way you're used to, you need two packages:\n- `dev-vcs/git`\n- `app-shells/bash-completion`\n\nThe second one is required to give bash the ability to autocomplete, as you can see in the video.\n\n### LaTeX\nOn Gentoo, the TeX Live compiler lives in the `app-text/texlive` package.\nYou should take a look at [its USE flags](https://wiki.gentoo.org/wiki/TeX_Live) as you might need some of them for your particular document.\nI simply include them all with line `app-text/texlive *` in my `package.use`.\n\n### OCRmyPDF\n[OCRmyPDF](https://ocrmypdf.readthedocs.io/en/latest/) is a Python program that uses Tesseract to convert scanned PDFs to text and make them searchable with Ctrl+F.\nOn Gentoo you need these two packages\n- `app-text/tesseract`\n- `media-gfx/pngquant`\n\nand have to install OCRmyPDF itself using `python3 -m pip install`\n\nTesseract comes with only the English language pack by default.\nAs described [here](https://ocrmypdf.readthedocs.io/en/latest/languages.html#gentoo-users) you have to set the [`L10N` use extension](https://wiki.gentoo.org/wiki//etc/portage/make.conf#L10N) in your `make.conf` to install more.\nThis for example lets you convert German and English PDFs.\n\n```bash\nL10N=\"en de\"\n```\n\nThis use extension is respected by many packages to install language specific features, not just by Tesseract.\n\n### OBS Studio\nOBS Studio is a very convenient way of recording your screen.\nIt can be installed using Portage, but similar to Kitty, OBS Studio is as of writing this article in the testing branch.\nSo you have to install it using `emerge --ask --autounmask=y --autounmask-write media-video/obs-studio`.\n\n### Firefox\nYou have two main ways of [installing Firefox](https://wiki.gentoo.org/wiki/Firefox), `www-client/firefox` to compile it from source and the precompiled `www-client/firefox-bin`.\nI chose the latter, binary version as Firefox receives very frequent updates and compiling a browser always takes a lot of time.\nIncidentally this is the only program I don't compile from source.\n\nI like using these extensions:\n- [Unhook](https://addons.mozilla.org/en-US/firefox/addon/youtube-recommended-videos): Remove YouTube recommended videos.\n- [Sponser Block](https://addons.mozilla.org/en-US/firefox/addon/sponsorblock): Skip sponsorships on YouTube.\n- [Adblock Plus](https://addons.mozilla.org/en-US/firefox/addon/adblock-plus): Block ads.\n- [Kee](https://addons.mozilla.org/en-US/firefox/addon/keefox): Firefox integration for Keepass.\n- [Google Lighthouse](https://addons.mozilla.org/en-US/firefox/addon/google-lighthouse): Create performance and accessibility reports for any webpage.\n- [Dark Reader](https://addons.mozilla.org/en-US/firefox/addon/darkreader): Add dark mode to every website.\n- [Stylus](https://addons.mozilla.org/en-US/firefox/addon/styl-us): Add prettier dark mode to GitHub with [this StylishTheme](https://github.com/StylishThemes/Github-Dark).\n\nWhat I also like doing is splitting the address and search bar.\n<HalfImage src={firefox_search_bar} />\n\nThen you can remove search results from the address bar and not leak any urls to your search provider.\nYou can do so in the `about:config` page.\n<HalfImage src={firefox_keyword_enabled} />\n\n### QEMU and Virt-manager\nAfter [a friend](https://github.com/RaafatTurki) made me aware of the huge performance increase KVM (**K**ernel-based **V**irtual **M**achine) entails, I switched to QEMU with the Virt-manager frontend.\nAnd I can confirm, it is much faster than VirtualBox, which I've used before—something around 85% native performance with my crude benchmarks.\nTo install it you should read the [QEMU](https://wiki.gentoo.org/wiki/QEMU) and [Virt-manager](https://wiki.gentoo.org/wiki/Virt-manager) articles for Gentoo.\nOnly make sure to add this to your `make.conf`:\n```bash\nUSE=\"spice usb usbredir\"\nQEMU_SOFTMMU_TARGETS=\"x86_64\"\n```\n\n### Node.js\n\nI need Node.js for my homepage but ran into an error message complaining about the node-inspector being missing (`ERR_INSPECTOR_NOT_AVAILABLE`).\nTo fix this, you have to add the `inspector` USE flag for the `net-libs/nodejs` package.\n\n<Spacer />\n\n## Disabling the PC Speaker\nI ran into the weird problem that my pc speaker, that squeaky little piezo thing, just didn't shut up and constantly annoyed me when I mistyped a command or hit some unbound key in Firefox.\nA sustainable solution to this problem is to disable the appropriate kernel module by creating the file `/etc/modprobe.d/blacklist.conf` and writing this line:\n```bash\nblacklist pcspkr\n```\n\n# Wrapping Up\n\n## Config Collection\nAs you might have noticed I very often referred to my [config collection](https://github.com/christopher-besch/configs).\nWhile I won't always keep this article up-to-date, this GitHub repository will always reflect the configs I'm using at the time.\nWhat exactly it contains is listed in its `README.md`.\n\n## Cheat Sheet\nTake a look at the [official cheat sheet](https://wiki.gentoo.org/wiki/Gentoo_Cheat_Sheet).\n- install package: `emerge --ask [package name]`\n- update system repository: `emerge --sync`\n- propagate USE flag changes: `emerge --ask --update --changed-use --deep @world`, `emerge --ask --depclean`\n- uninstall package: `emerge --deselect [package name]`, `emerge --ask --depclean`\n\n## What Remains\nThere are quite a few more things I would have liked to try but didn't get to.\nThis includes Bluetooth support and compiling packages on multiple machines using distcc.\nBut this article already took long enough so I'll leave it at that.\n\nEven though installing Gentoo was incredibly tiresome and painful, I learned a lot about Linux and am more content with my current operating system than ever before.\nSometimes you just have to endure some pain to reach heaven.\n\nThanks for sticking around and I wish you a splendid day!\n\n{ /* # Still Unsolved Problems */ }\n{ /* - xfce-extra/xfce4-pulseaudio-plugin doesn't work */ }\n{ /* - xfce-extra/xfce4-netload-plugin doesn't work */ }\n{ /* - fstab doesn't mount smb drives on boot */ }\n{ /* - getsby develop not working */ }\n\n","frontmatter":{"date":"Tuesday, 26th April, 2022","title":"Installing Gentoo To My Liking","description":" Gentoo is a Linux distribution that offers as many options as possible. This article leads you through the decisions I took to end up with a system that best suits my needs. ","banner":"/social_banner/installing_gentoo.png","title_banner":null,"title_banner_horizontal_position":null,"title_banner_vertical_position":null,"version":"1.2.1"}}},"pageContext":{"id":"f775d6b1-a11a-53ba-85c6-52a19e5c39d4","frontmatter":{"type":"article","title":"Installing Gentoo To My Liking","description":" Gentoo is a Linux distribution that offers as many options as possible. This article leads you through the decisions I took to end up with a system that best suits my needs. ","banner":"/social_banner/installing_gentoo.png","thumb":"../../../static/social_banner/installing_gentoo.png","slug":"installing_gentoo","date":"2022-04-26T00:00:00.000Z","listed":true,"version":"1.2.1"}}},"staticQueryHashes":["1995789189","2480137602","475732191"],"slicesMap":{}}